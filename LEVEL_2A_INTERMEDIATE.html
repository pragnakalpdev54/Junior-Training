
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://pragnakalpdev54.github.io/DRF/LEVEL_2A_INTERMEDIATE.html">
      
      
        <link rel="prev" href="LEVEL_1_FOUNDATIONS.html">
      
      
        <link rel="next" href="LEVEL_2B_INTERMEDIATE.html">
      
      
        
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>Part A – Core Concepts - DRF Training Guide</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.618322db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#level-2a-intermediate-authentication-permissions-throttling" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="DRF Training Guide" class="md-header__button md-logo" aria-label="DRF Training Guide" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            DRF Training Guide
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Part A – Core Concepts
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="DRF Training Guide" class="md-nav__button md-logo" aria-label="DRF Training Guide" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    DRF Training Guide
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Course Levels
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Course Levels
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="LEVEL_0_BEGINNER.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Level 0 – Beginner
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="LEVEL_1_FOUNDATIONS.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Level 1 – Foundations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" checked>
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Level 2 – Intermediate
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Level 2 – Intermediate
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Part A – Core Concepts
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="LEVEL_2A_INTERMEDIATE.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Part A – Core Concepts
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#goal" class="md-nav__link">
    <span class="md-ellipsis">
      
        Goal
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#note-on-examples" class="md-nav__link">
    <span class="md-ellipsis">
      
        Note on Examples
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#class-based-views-cbv-approach" class="md-nav__link">
    <span class="md-ellipsis">
      
        Class-Based Views (CBV) Approach
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-of-contents" class="md-nav__link">
    <span class="md-ellipsis">
      
        Table of Contents
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#django-authentication-system" class="md-nav__link">
    <span class="md-ellipsis">
      
        Django Authentication System
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Django Authentication System">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#why-authentication" class="md-nav__link">
    <span class="md-ellipsis">
      
        Why Authentication?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#understanding-django-users" class="md-nav__link">
    <span class="md-ellipsis">
      
        Understanding Django Users
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-users" class="md-nav__link">
    <span class="md-ellipsis">
      
        Creating Users
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-user-model" class="md-nav__link">
    <span class="md-ellipsis">
      
        Custom User Model
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#django-abstract-models" class="md-nav__link">
    <span class="md-ellipsis">
      
        Django Abstract Models
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Django Abstract Models">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-are-abstract-models" class="md-nav__link">
    <span class="md-ellipsis">
      
        What are Abstract Models?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-abstract-base-models" class="md-nav__link">
    <span class="md-ellipsis">
      
        Creating Abstract Base Models
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inheriting-from-abstract-models" class="md-nav__link">
    <span class="md-ellipsis">
      
        Inheriting from Abstract Models
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#common-abstract-model-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Common Abstract Model Patterns
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Common Abstract Model Patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pattern-1-timestampedmodel-most-common" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern 1: TimestampedModel (Most Common)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pattern-2-soft-delete-model" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern 2: Soft Delete Model
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pattern-3-basemodel-combining-multiple-features" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern 3: BaseModel (Combining Multiple Features)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multiple-inheritance-from-abstract-models" class="md-nav__link">
    <span class="md-ellipsis">
      
        Multiple Inheritance from Abstract Models
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      
        Best Practices
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#when-to-use-abstract-models" class="md-nav__link">
    <span class="md-ellipsis">
      
        When to Use Abstract Models
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-by-step-adding-abstract-models-to-existing-project" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step-by-Step: Adding Abstract Models to Existing Project
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#common-abstract-model-examples" class="md-nav__link">
    <span class="md-ellipsis">
      
        Common Abstract Model Examples
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        Summary
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#drf-authentication-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        DRF Authentication Classes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DRF Authentication Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#authentication-vs-authorization" class="md-nav__link">
    <span class="md-ellipsis">
      
        Authentication vs Authorization
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#drf-authentication-types" class="md-nav__link">
    <span class="md-ellipsis">
      
        DRF Authentication Types
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DRF Authentication Types">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-session-authentication" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Session Authentication
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-token-authentication" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Token Authentication
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-jwt-authentication-recommended" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. JWT Authentication (Recommended)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#jwt-authentication-setup" class="md-nav__link">
    <span class="md-ellipsis">
      
        JWT Authentication Setup
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="JWT Authentication Setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-install-package" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 1: Install Package
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-add-to-installed_apps" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 2: Add to INSTALLED_APPS
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-configure-jwt-settings" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 3: Configure JWT Settings
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-5-create-user-registration-view" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 5: Create User Registration View
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-6-test-jwt-authentication" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 6: Test JWT Authentication
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#permissions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Permissions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Permissions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-are-permissions" class="md-nav__link">
    <span class="md-ellipsis">
      
        What are Permissions?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#built-in-permission-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Built-in Permission Classes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Built-in Permission Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-allowany" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. AllowAny
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-isauthenticated" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. IsAuthenticated
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-isadminuser" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. IsAdminUser
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-isauthenticatedorreadonly" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. IsAuthenticatedOrReadOnly
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-permissions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Custom Permissions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Custom Permissions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#isownerorreadonly" class="md-nav__link">
    <span class="md-ellipsis">
      
        IsOwnerOrReadOnly
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#permission-at-view-level" class="md-nav__link">
    <span class="md-ellipsis">
      
        Permission at View Level
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-by-step-secure-book-api" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step-by-Step: Secure Book API
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step-by-Step: Secure Book API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-update-book-model" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 1: Update Book Model
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-update-book-serializer" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 2: Update Book Serializer
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-update-book-viewset" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 3: Update Book ViewSet
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-5-test-secure-book-api" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 5: Test Secure Book API
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-by-step-secure-task-api" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step-by-Step: Secure Task API
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step-by-Step: Secure Task API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-update-task-model" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 1: Update Task Model
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-update-task-serializer" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 2: Update Task Serializer
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-update-task-viewset" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 3: Update Task ViewSet
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-5-test-secure-task-api" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 5: Test Secure Task API
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#userprofile-api" class="md-nav__link">
    <span class="md-ellipsis">
      
        UserProfile API
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="UserProfile API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-create-userprofile-model" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 1: Create UserProfile Model
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-create-userprofile-serializer" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 2: Create UserProfile Serializer
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-create-userprofile-viewset" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 3: Create UserProfile ViewSet
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#throttling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Throttling
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Throttling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-is-throttling" class="md-nav__link">
    <span class="md-ellipsis">
      
        What is Throttling?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-throttling-is-determined" class="md-nav__link">
    <span class="md-ellipsis">
      
        How Throttling is Determined
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setting-the-throttling-policy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Setting the Throttling Policy
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Setting the Throttling Policy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#global-throttling-policy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Global Throttling Policy
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#per-view-throttling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Per-View Throttling
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#per-viewset-throttling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Per-ViewSet Throttling
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#per-action-throttling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Per-Action Throttling
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-clients-are-identified" class="md-nav__link">
    <span class="md-ellipsis">
      
        How Clients are Identified
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setting-up-the-cache" class="md-nav__link">
    <span class="md-ellipsis">
      
        Setting up the Cache
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-note-on-concurrency" class="md-nav__link">
    <span class="md-ellipsis">
      
        A Note on Concurrency
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#api-reference" class="md-nav__link">
    <span class="md-ellipsis">
      
        API Reference
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="API Reference">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#anonratethrottle" class="md-nav__link">
    <span class="md-ellipsis">
      
        AnonRateThrottle
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#userratethrottle" class="md-nav__link">
    <span class="md-ellipsis">
      
        UserRateThrottle
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scopedratethrottle" class="md-nav__link">
    <span class="md-ellipsis">
      
        ScopedRateThrottle
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-throttles" class="md-nav__link">
    <span class="md-ellipsis">
      
        Custom Throttles
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-throttling-example" class="md-nav__link">
    <span class="md-ellipsis">
      
        Custom Throttling Example
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercises" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exercises
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Exercises">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercise-1-complete-secure-book-api-authentication-permissions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exercise 1: Complete Secure Book API (Authentication &amp; Permissions)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exercise-2-userprofile-api" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exercise 2: UserProfile API
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exercise-3-custom-throttling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exercise 3: Custom Throttling
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exercise-4-abstract-models" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exercise 4: Abstract Models
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#common-errors-and-solutions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Common Errors and Solutions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Common Errors and Solutions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#error-1-rest_frameworkexceptionsauthenticationfailed-given-token-not-valid-for-any-token-type" class="md-nav__link">
    <span class="md-ellipsis">
      
        Error 1: rest_framework.exceptions.AuthenticationFailed: Given token not valid for any token type
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-2-rest_frameworkexceptionspermissiondenied-you-do-not-have-permission-to-perform-this-action" class="md-nav__link">
    <span class="md-ellipsis">
      
        Error 2: rest_framework.exceptions.PermissionDenied: You do not have permission to perform this action
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-3-djangocontribauthmodelsuserdoesnotexist-user-matching-query-does-not-exist" class="md-nav__link">
    <span class="md-ellipsis">
      
        Error 3: django.contrib.auth.models.User.DoesNotExist: User matching query does not exist
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-4-rest_frameworkexceptionsvalidationerror-refresh-this-field-is-required" class="md-nav__link">
    <span class="md-ellipsis">
      
        Error 4: rest_framework.exceptions.ValidationError: {'refresh': ['This field is required.']}
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-5-djangodbutilsintegrityerror-not-null-constraint-failed-api_taskowner_id" class="md-nav__link">
    <span class="md-ellipsis">
      
        Error 5: django.db.utils.IntegrityError: NOT NULL constraint failed: api_task.owner_id
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#general-debugging-tips-for-level-2a" class="md-nav__link">
    <span class="md-ellipsis">
      
        General Debugging Tips for Level 2A
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-steps" class="md-nav__link">
    <span class="md-ellipsis">
      
        Next Steps
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="LEVEL_2B_INTERMEDIATE.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Part B – Applied DRF
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Level 3 – Advanced
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Level 3 – Advanced
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="LEVEL_3A_ADVANCED.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Part A – Internals & Optimization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="LEVEL_3B_ADVANCED.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Part B – Security & Performance
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="LEVEL_4_SCALABLE.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Level 4 – Scalable Systems
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="LEVEL_5_EXPERT.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Level 5 – Expert Level
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Tools & Extras
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Tools & Extras
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="POSTGRESQL_SETUP.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    PostgreSQL Setup
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Postman Guide
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Postman Guide
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="POSTMAN_GUIDE_PART1_BASICS.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Part 1 – Basics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="POSTMAN_GUIDE_PART2_ADVANCED.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Part 2 – Advanced
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="CURL_GUIDE.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    cURL Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="level-2a-intermediate-authentication-permissions-throttling">Level 2A: Intermediate - Authentication, Permissions &amp; Throttling<a class="headerlink" href="#level-2a-intermediate-authentication-permissions-throttling" title="Permanent link">&para;</a></h1>
<h2 id="goal">Goal<a class="headerlink" href="#goal" title="Permanent link">&para;</a></h2>
<p>Build secure APIs with robust authentication, permissions, and rate limiting. By the end of this level, you'll be able to create secure REST APIs with user authentication, access control, and protection against API abuse.</p>
<h2 id="note-on-examples">Note on Examples<a class="headerlink" href="#note-on-examples" title="Permanent link">&para;</a></h2>
<p>This guide uses <strong>Task API</strong> as the primary example throughout explanation sections for consistency with Level 1. Complete step-by-step implementations are provided for both <strong>Task API</strong> (user-owned, private data) and <strong>Book API</strong> (can be public or user-owned) to show different use cases:</p>
<ul>
<li><strong>Task API examples</strong>: Used in explanations (authentication, permissions, throttling) - represents private, user-owned data</li>
<li><strong>Book API examples</strong>: Used in complete step-by-step section - represents content that can be public or user-owned</li>
<li><strong>Both examples</strong>: Help you understand different scenarios and patterns</li>
</ul>
<p><strong>Note</strong>: Filtering, searching, ordering, and pagination are covered in <strong>Level 2B</strong>. This level (2A) focuses on authentication, permissions, and throttling.</p>
<p>You can apply all concepts to any model (Task, Book, Product, Post, etc.).</p>
<h2 id="class-based-views-cbv-approach">Class-Based Views (CBV) Approach<a class="headerlink" href="#class-based-views-cbv-approach" title="Permanent link">&para;</a></h2>
<p><strong>This guide follows the Class-Based Views (CBV) approach</strong> throughout, which is the recommended and modern way to build DRF APIs:</p>
<ul>
<li>✅ <strong>ViewSets</strong> (<code>ModelViewSet</code>, <code>ReadOnlyViewSet</code>) - For CRUD operations</li>
<li>✅ <strong>Generic Views</strong> (<code>CreateAPIView</code>, <code>ListAPIView</code>, etc.) - For specific operations</li>
<li>✅ <strong>APIView</strong> - For custom logic when needed</li>
<li>❌ <strong>Function-based views</strong> (<code>@api_view</code>) - Only used when absolutely necessary</li>
</ul>
<p><strong>Why Class-Based Views?</strong>
- <strong>Reusable</strong>: Easy to extend and customize
- <strong>DRY</strong>: Less code duplication
- <strong>Built-in features</strong>: Authentication, permissions, filtering work automatically
- <strong>Industry standard</strong>: Most DRF projects use CBV
- <strong>Better organization</strong>: Clear separation of concerns</p>
<p>All examples in this guide use class-based views unless explicitly noted otherwise.</p>
<h2 id="table-of-contents">Table of Contents<a class="headerlink" href="#table-of-contents" title="Permanent link">&para;</a></h2>
<ol>
<li><a href="#class-based-views-cbv-approach">Class-Based Views (CBV) Approach</a></li>
<li><a href="#django-authentication-system">Django Authentication System</a></li>
<li><a href="#django-abstract-models">Django Abstract Models</a></li>
<li><a href="#drf-authentication-classes">DRF Authentication Classes</a></li>
<li><a href="#jwt-authentication-setup">JWT Authentication Setup</a></li>
<li><a href="#permissions">Permissions</a></li>
<li><a href="#step-by-step-secure-book-api">Step-by-Step: Secure Book API</a></li>
<li><a href="#step-by-step-secure-task-api">Step-by-Step: Secure Task API</a></li>
<li><a href="#userprofile-api">UserProfile API</a></li>
<li><a href="#throttling">Throttling</a><ul>
<li><a href="#what-is-throttling">What is Throttling?</a></li>
<li><a href="#how-throttling-is-determined">How Throttling is Determined</a></li>
<li><a href="#setting-the-throttling-policy">Setting the Throttling Policy</a></li>
<li><a href="#how-clients-are-identified">How Clients are Identified</a></li>
<li><a href="#setting-up-the-cache">Setting up the Cache</a></li>
<li><a href="#a-note-on-concurrency">A Note on Concurrency</a></li>
<li><a href="#api-reference">API Reference</a></li>
<li><a href="#custom-throttles">Custom Throttles</a></li>
</ul>
</li>
<li><a href="#exercises">Exercises</a></li>
<li><a href="#common-errors-and-solutions">Common Errors and Solutions</a></li>
<li><a href="#add-ons">Add-ons</a></li>
</ol>
<h2 id="django-authentication-system">Django Authentication System<a class="headerlink" href="#django-authentication-system" title="Permanent link">&para;</a></h2>
<h3 id="why-authentication">Why Authentication?<a class="headerlink" href="#why-authentication" title="Permanent link">&para;</a></h3>
<p><strong>The Problem</strong>: Without authentication, anyone can access your API and modify data. This is a security risk!</p>
<p><strong>Real-world analogy</strong>: 
- <strong>No authentication</strong> = House with no locks (anyone can enter)
- <strong>With authentication</strong> = House with keys (only authorized people enter)</p>
<p><strong>Why it matters</strong>:
- <strong>Security</strong>: Protect user data
- <strong>Personalization</strong>: Show users only their data
- <strong>Accountability</strong>: Track who did what
- <strong>Access control</strong>: Limit what users can do</p>
<h3 id="understanding-django-users">Understanding Django Users<a class="headerlink" href="#understanding-django-users" title="Permanent link">&para;</a></h3>
<p>Django comes with a built-in User model that handles user accounts:</p>
<p><strong>What is a User model?</strong>
- Represents a person using your application
- Stores login credentials (username, password)
- Tracks user information (email, name)
- Manages permissions and access levels</p>
<p><strong>Why use Django's User model?</strong>
- <strong>Ready-made</strong>: No need to build from scratch
- <strong>Secure</strong>: Password hashing built-in
- <strong>Tested</strong>: Used by millions of applications
- <strong>Flexible</strong>: Can be extended for custom needs</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.auth.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">User</span>

<span class="c1"># User fields</span>
<span class="n">user</span><span class="o">.</span><span class="n">username</span>      <span class="c1"># Username</span>
<span class="n">user</span><span class="o">.</span><span class="n">email</span>         <span class="c1"># Email address</span>
<span class="n">user</span><span class="o">.</span><span class="n">password</span>      <span class="c1"># Hashed password (never access directly)</span>
<span class="n">user</span><span class="o">.</span><span class="n">first_name</span>    <span class="c1"># First name</span>
<span class="n">user</span><span class="o">.</span><span class="n">last_name</span>     <span class="c1"># Last name</span>
<span class="n">user</span><span class="o">.</span><span class="n">is_staff</span>      <span class="c1"># Admin access (can access Django admin)</span>
<span class="n">user</span><span class="o">.</span><span class="n">is_active</span>     <span class="c1"># Account status (False = disabled account)</span>
<span class="n">user</span><span class="o">.</span><span class="n">is_superuser</span>  <span class="c1"># Superuser (all permissions)</span>
<span class="n">user</span><span class="o">.</span><span class="n">date_joined</span>   <span class="c1"># When user account was created</span>
</code></pre></div>

<p><strong>Explanation of key fields</strong>:
- <strong><code>username</code></strong>: Unique identifier for login
- <strong><code>email</code></strong>: User's email address
- <strong><code>password</code></strong>: Stored as hash (never plain text)
- <strong><code>is_staff</code></strong>: Can access Django admin panel
- <strong><code>is_active</code></strong>: If False, user cannot login
- <strong><code>is_superuser</code></strong>: Has all permissions automatically</p>
<h3 id="creating-users">Creating Users<a class="headerlink" href="#creating-users" title="Permanent link">&para;</a></h3>
<p><strong>Why multiple methods?</strong>
- Different methods serve different purposes
- Some hash passwords (secure), others don't (insecure)
- Always use methods that hash passwords!</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># In Django shell: python manage.py shell</span>
<span class="c1"># Open Django shell: python manage.py shell</span>

<span class="c1"># Import Django&#39;s built-in User model</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.auth.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">User</span>

<span class="c1"># Method 1: create_user (recommended - hashes password automatically)</span>
<span class="c1"># This is the SECURE way to create users</span>
<span class="c1"># create_user() automatically:</span>
<span class="c1">#   - Hashes the password (converts to secure hash)</span>
<span class="c1">#   - Validates username/email format</span>
<span class="c1">#   - Sets is_active=True by default</span>
<span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span>
    <span class="n">username</span><span class="o">=</span><span class="s1">&#39;john&#39;</span><span class="p">,</span>  <span class="c1"># Unique username for login</span>
    <span class="n">email</span><span class="o">=</span><span class="s1">&#39;john@example.com&#39;</span><span class="p">,</span>  <span class="c1"># User&#39;s email address</span>
    <span class="n">password</span><span class="o">=</span><span class="s1">&#39;securepassword123&#39;</span>  <span class="c1"># Password will be hashed automatically</span>
<span class="p">)</span>
<span class="c1"># After this, user.password contains a hash like &quot;pbkdf2_sha256$...&quot; (not plain text!)</span>
</code></pre></div>

<p><strong>Why <code>create_user</code>?</strong>
- <strong>Password hashing</strong>: Converts password to secure hash (can't be reversed)
- <strong>Validation</strong>: Checks username/email format
- <strong>Default values</strong>: Sets sensible defaults (is_active=True)
- <strong>Security</strong>: Never store plain text passwords!</p>
<p><strong>What is password hashing?</strong>
- Plain password: <code>"mypassword123"</code> ❌ (stored as-is, anyone can read)
- Hashed password: <code>"pbkdf2_sha256$..."</code> ✅ (one-way encryption, can't be reversed)
- When user logs in, Django hashes their input and compares with stored hash</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Method 2: create_superuser</span>
<span class="c1"># Creates a user with admin privileges</span>
<span class="c1"># Use this for site administrators who need full access</span>
<span class="n">admin</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_superuser</span><span class="p">(</span>
    <span class="n">username</span><span class="o">=</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span>  <span class="c1"># Admin username</span>
    <span class="n">email</span><span class="o">=</span><span class="s1">&#39;admin@example.com&#39;</span><span class="p">,</span>  <span class="c1"># Admin email</span>
    <span class="n">password</span><span class="o">=</span><span class="s1">&#39;admin123&#39;</span>  <span class="c1"># Admin password (will be hashed)</span>
<span class="p">)</span>
<span class="c1"># After this, admin has:</span>
<span class="c1">#   - is_staff=True (can access Django admin panel)</span>
<span class="c1">#   - is_superuser=True (has all permissions automatically)</span>
<span class="c1">#   - Password is hashed (secure)</span>
</code></pre></div>

<p><strong>Why <code>create_superuser</code>?</strong>
- Creates user with admin privileges (<code>is_staff=True</code>, <code>is_superuser=True</code>)
- Can access Django admin panel
- Has all permissions by default
- Use for site administrators</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Method 3: Using User.objects.create (not recommended - password not hashed)</span>
</code></pre></div>

<p><strong>Why NOT use <code>User.objects.create</code>?</strong>
- <strong>Security risk</strong>: Password stored in plain text!
- No validation
- No password hashing
- <strong>Never use this for passwords!</strong></p>
<h3 id="custom-user-model">Custom User Model<a class="headerlink" href="#custom-user-model" title="Permanent link">&para;</a></h3>
<p><strong>Why create a custom user model?</strong></p>
<p><strong>The Problem</strong>: Django's default User model has limited fields (username, email, password). What if you need:
- Phone numbers
- Profile pictures
- Bio/description
- Custom fields</p>
<p><strong>The Solution</strong>: Extend Django's User model with your own fields.</p>
<p><strong>When to use custom user model?</strong>
- <strong>Production apps</strong>: Almost always
- <strong>Need extra fields</strong>: Phone, avatar, bio, etc.
- <strong>Different login</strong>: Email instead of username
- <strong>Before first migration</strong>: Must set before creating database</p>
<p><strong>Why before first migration?</strong>
- Changing user model after migration is very difficult
- Requires database restructuring
- Can cause data loss
- <strong>Always decide early!</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># api/models.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.auth.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">AbstractUser</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.db</span><span class="w"> </span><span class="kn">import</span> <span class="n">models</span>

<span class="k">class</span><span class="w"> </span><span class="nc">CustomUser</span><span class="p">(</span><span class="n">AbstractUser</span><span class="p">):</span>
    <span class="n">phone_number</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">bio</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">avatar</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ImageField</span><span class="p">(</span><span class="n">upload_to</span><span class="o">=</span><span class="s1">&#39;avatars/&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">created_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">username</span>
</code></pre></div>

<p><strong>Explanation</strong>:
- <strong><code>AbstractUser</code></strong>: Base class with all default User fields (username, email, password, etc.)
- <strong>Extend it</strong>: Add your custom fields
- <strong>Inherits everything</strong>: All User functionality still works
- <strong>Add custom fields</strong>: Phone, bio, avatar, etc.</p>
<p><strong>Update settings.py:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># core/settings.py</span>
<span class="n">AUTH_USER_MODEL</span> <span class="o">=</span> <span class="s1">&#39;api.CustomUser&#39;</span>
</code></pre></div>

<p><strong>What this does</strong>:
- Tells Django to use your custom user model
- Replaces default User model everywhere
- Must be set before first migration!</p>
<p><strong>Important</strong>: Set this before your first migration! Once migrations are created, changing is very difficult.</p>
<h2 id="django-abstract-models">Django Abstract Models<a class="headerlink" href="#django-abstract-models" title="Permanent link">&para;</a></h2>
<h3 id="what-are-abstract-models">What are Abstract Models?<a class="headerlink" href="#what-are-abstract-models" title="Permanent link">&para;</a></h3>
<p><strong>Abstract Models</strong> are base model classes that are not created as database tables themselves. Instead, they serve as templates that other models can inherit from to share common fields and methods.</p>
<p><strong>Why use Abstract Models?</strong>
- <strong>DRY Principle</strong>: Don't Repeat Yourself - define common fields once
- <strong>Consistency</strong>: All models have the same timestamp fields, soft delete, etc.
- <strong>Maintainability</strong>: Update common fields in one place
- <strong>Reusability</strong>: Share common functionality across multiple models</p>
<p><strong>Real-world analogy</strong>:
- <strong>Abstract Model</strong> = Blueprint template (not a real house)
- <strong>Regular Model</strong> = Actual house built from blueprint
- <strong>Inheritance</strong> = Multiple houses can use the same blueprint</p>
<h3 id="creating-abstract-base-models">Creating Abstract Base Models<a class="headerlink" href="#creating-abstract-base-models" title="Permanent link">&para;</a></h3>
<p><strong>Key Point</strong>: Set <code>abstract = True</code> in the <code>Meta</code> class. This tells Django: "Don't create a database table for this model, it's just a template."</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># api/models.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.db</span><span class="w"> </span><span class="kn">import</span> <span class="n">models</span>

<span class="c1"># Abstract model - won&#39;t create a database table</span>
<span class="c1"># This is just a template for other models to inherit from</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TimestampedModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Abstract base model that provides created_at and updated_at fields.</span>
<span class="sd">    Any model that inherits from this will automatically get these fields.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Auto-set when object is first created (never changes)</span>
    <span class="n">created_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Auto-updated every time object is saved</span>
    <span class="n">updated_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="c1"># This makes it abstract - no database table will be created</span>
        <span class="n">abstract</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># This means: &quot;This is a template, not a real model&quot;</span>
</code></pre></div>

<p><strong>What <code>abstract = True</code> does</strong>:
- Django will NOT create a database table for this model
- Other models can inherit from it
- All fields and methods are inherited by child models</p>
<h3 id="inheriting-from-abstract-models">Inheriting from Abstract Models<a class="headerlink" href="#inheriting-from-abstract-models" title="Permanent link">&para;</a></h3>
<p><strong>How to use</strong>: Simply inherit from the abstract model instead of <code>models.Model</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># api/models.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.db</span><span class="w"> </span><span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.auth.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">User</span>

<span class="c1"># Inherit from TimestampedModel instead of models.Model</span>
<span class="c1"># This automatically gives us created_at and updated_at fields</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Task</span><span class="p">(</span><span class="n">TimestampedModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Task model that automatically has created_at and updated_at fields</span>
<span class="sd">    thanks to inheriting from TimestampedModel.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Regular fields specific to Task</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">desc</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">completed</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">owner</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;tasks&#39;</span><span class="p">)</span>

    <span class="c1"># No need to define created_at and updated_at here!</span>
    <span class="c1"># They&#39;re inherited from TimestampedModel automatically</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-created_at&#39;</span><span class="p">]</span>
        <span class="c1"># Note: We don&#39;t need abstract = True here</span>
        <span class="c1"># This is a real model that will create a database table</span>
</code></pre></div>

<p><strong>What happens</strong>:
- <code>Task</code> model gets all fields from <code>TimestampedModel</code> (created_at, updated_at)
- Database table <code>api_task</code> will have: id, title, desc, completed, owner_id, created_at, updated_at
- No separate table for <code>TimestampedModel</code> (because it's abstract)</p>
<h3 id="common-abstract-model-patterns">Common Abstract Model Patterns<a class="headerlink" href="#common-abstract-model-patterns" title="Permanent link">&para;</a></h3>
<h4 id="pattern-1-timestampedmodel-most-common">Pattern 1: TimestampedModel (Most Common)<a class="headerlink" href="#pattern-1-timestampedmodel-most-common" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># api/models.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.db</span><span class="w"> </span><span class="kn">import</span> <span class="n">models</span>

<span class="k">class</span><span class="w"> </span><span class="nc">TimestampedModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Provides created_at and updated_at timestamps to all models.</span>
<span class="sd">    Use this when you want to track when objects are created/modified.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">created_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">updated_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">abstract</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># Usage in any model:</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Book</span><span class="p">(</span><span class="n">TimestampedModel</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="c1"># Automatically has created_at and updated_at</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Post</span><span class="p">(</span><span class="n">TimestampedModel</span><span class="p">):</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
    <span class="c1"># Automatically has created_at and updated_at</span>
</code></pre></div>

<h4 id="pattern-2-soft-delete-model">Pattern 2: Soft Delete Model<a class="headerlink" href="#pattern-2-soft-delete-model" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># api/models.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.db</span><span class="w"> </span><span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">timezone</span>

<span class="k">class</span><span class="w"> </span><span class="nc">SoftDeleteModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Provides soft delete functionality.</span>
<span class="sd">    Instead of actually deleting, sets deleted_at timestamp.</span>
<span class="sd">    Objects can be &quot;restored&quot; by setting deleted_at to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># When object was deleted (None = not deleted)</span>
    <span class="n">deleted_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">abstract</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">using</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">keep_parents</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Override delete() to do soft delete instead of hard delete.</span>
<span class="sd">        Instead of removing from database, just mark as deleted.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deleted_at</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">restore</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Restore a soft-deleted object&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deleted_at</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_deleted</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if object is soft-deleted&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">deleted_at</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

<span class="c1"># Usage:</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Task</span><span class="p">(</span><span class="n">SoftDeleteModel</span><span class="p">,</span> <span class="n">TimestampedModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Task model with both soft delete and timestamps.</span>
<span class="sd">    Can inherit from multiple abstract models!</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="c1"># Has: created_at, updated_at, deleted_at, and all methods above</span>
</code></pre></div>

<h4 id="pattern-3-basemodel-combining-multiple-features">Pattern 3: BaseModel (Combining Multiple Features)<a class="headerlink" href="#pattern-3-basemodel-combining-multiple-features" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># api/models.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.db</span><span class="w"> </span><span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">timezone</span>

<span class="k">class</span><span class="w"> </span><span class="nc">BaseModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Comprehensive base model with timestamps and soft delete.</span>
<span class="sd">    Use this as the foundation for most of your models.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Timestamp fields</span>
    <span class="n">created_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">updated_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Soft delete field</span>
    <span class="n">deleted_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">abstract</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># Default ordering: newest first</span>
        <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-created_at&#39;</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">using</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">keep_parents</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Soft delete instead of hard delete&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deleted_at</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">restore</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Restore soft-deleted object&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deleted_at</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_deleted</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if object is soft-deleted&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">deleted_at</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

<span class="c1"># Usage:</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Task</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Task model inheriting from BaseModel.</span>
<span class="sd">    Gets timestamps, soft delete, and default ordering automatically.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">desc</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Automatically has: created_at, updated_at, deleted_at</span>
    <span class="c1"># Plus: delete(), restore(), is_deleted property</span>
</code></pre></div>

<h3 id="multiple-inheritance-from-abstract-models">Multiple Inheritance from Abstract Models<a class="headerlink" href="#multiple-inheritance-from-abstract-models" title="Permanent link">&para;</a></h3>
<p><strong>You can inherit from multiple abstract models</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># api/models.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.db</span><span class="w"> </span><span class="kn">import</span> <span class="n">models</span>

<span class="k">class</span><span class="w"> </span><span class="nc">TimestampedModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">created_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">updated_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">abstract</span> <span class="o">=</span> <span class="kc">True</span>

<span class="k">class</span><span class="w"> </span><span class="nc">SlugModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Abstract model that provides slug field and auto-generation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">slug</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">SlugField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">abstract</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Auto-generate slug from title if not provided&quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">django.utils.text</span><span class="w"> </span><span class="kn">import</span> <span class="n">slugify</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">slug</span><span class="p">:</span>
            <span class="c1"># Generate slug from title (if model has title field)</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">slug</span> <span class="o">=</span> <span class="n">slugify</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="c1"># Inherit from multiple abstract models</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Post</span><span class="p">(</span><span class="n">TimestampedModel</span><span class="p">,</span> <span class="n">SlugModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Post model with timestamps AND slug functionality.</span>
<span class="sd">    Inherits from both abstract models.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
    <span class="c1"># Has: created_at, updated_at, slug (all inherited)</span>
</code></pre></div>

<h3 id="best-practices">Best Practices<a class="headerlink" href="#best-practices" title="Permanent link">&para;</a></h3>
<p><strong>1. Use Abstract Models for Common Fields</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># ✅ GOOD: Use abstract model for common fields</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TimestampedModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">created_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">updated_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">abstract</span> <span class="o">=</span> <span class="kc">True</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Task</span><span class="p">(</span><span class="n">TimestampedModel</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="c1"># created_at and updated_at inherited</span>

<span class="c1"># ❌ BAD: Repeating fields in every model</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Task</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">created_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># Repeated</span>
    <span class="n">updated_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># Repeated</span>
</code></pre></div>

<p><strong>2. Keep Abstract Models Simple</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># ✅ GOOD: Simple, focused abstract model</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TimestampedModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">created_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">updated_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">abstract</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># ❌ BAD: Too complex, mixing concerns</span>
<span class="k">class</span><span class="w"> </span><span class="nc">EverythingModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">created_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">updated_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">deleted_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">slug</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">SlugField</span><span class="p">()</span>
    <span class="c1"># ... too many things</span>
    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">abstract</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div>

<p><strong>3. Document Your Abstract Models</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># ✅ GOOD: Well-documented abstract model</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TimestampedModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Abstract base model providing created_at and updated_at timestamps.</span>

<span class="sd">    Usage:</span>
<span class="sd">        class MyModel(TimestampedModel):</span>
<span class="sd">            name = models.CharField(max_length=100)</span>
<span class="sd">            # Automatically gets created_at and updated_at</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">created_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">updated_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">abstract</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div>

<h3 id="when-to-use-abstract-models">When to Use Abstract Models<a class="headerlink" href="#when-to-use-abstract-models" title="Permanent link">&para;</a></h3>
<p><strong>Use Abstract Models when</strong>:
- ✅ Multiple models need the same fields (timestamps, soft delete, etc.)
- ✅ You want to ensure consistency across models
- ✅ You want to reduce code duplication
- ✅ You want to share common methods/properties</p>
<p><strong>Don't use Abstract Models when</strong>:
- ❌ Only one model needs the fields (just add them directly)
- ❌ The fields are model-specific (not shared)
- ❌ You need a database table for the base model (use regular inheritance)</p>
<h3 id="step-by-step-adding-abstract-models-to-existing-project">Step-by-Step: Adding Abstract Models to Existing Project<a class="headerlink" href="#step-by-step-adding-abstract-models-to-existing-project" title="Permanent link">&para;</a></h3>
<p><strong>Step 1: Create Abstract Model</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># api/models.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.db</span><span class="w"> </span><span class="kn">import</span> <span class="n">models</span>

<span class="c1"># Create abstract model</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TimestampedModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base model with timestamp fields&quot;&quot;&quot;</span>
    <span class="n">created_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">updated_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">abstract</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Important: makes it abstract</span>
</code></pre></div>

<p><strong>Step 2: Update Existing Models</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># api/models.py</span>
<span class="c1"># Before:</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Task</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">created_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># Remove this</span>
    <span class="n">updated_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># Remove this</span>

<span class="c1"># After:</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Task</span><span class="p">(</span><span class="n">TimestampedModel</span><span class="p">):</span>  <span class="c1"># Inherit from TimestampedModel</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="c1"># created_at and updated_at are inherited automatically</span>
</code></pre></div>

<p><strong>Step 3: Create and Run Migrations</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Create migration for the changes</span>
python<span class="w"> </span>manage.py<span class="w"> </span>makemigrations

<span class="c1"># Review the migration (it should remove created_at/updated_at from Task</span>
<span class="c1"># and add them back via inheritance - but database structure stays same)</span>

<span class="c1"># Apply migration</span>
python<span class="w"> </span>manage.py<span class="w"> </span>migrate
</code></pre></div>

<p><strong>Note</strong>: If your models already have <code>created_at</code> and <code>updated_at</code> fields, Django will handle this in migrations. The database structure won't change, but your code becomes cleaner.</p>
<h3 id="common-abstract-model-examples">Common Abstract Model Examples<a class="headerlink" href="#common-abstract-model-examples" title="Permanent link">&para;</a></h3>
<p><strong>Example 1: UUID Primary Key Model</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># api/models.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">uuid</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.db</span><span class="w"> </span><span class="kn">import</span> <span class="n">models</span>

<span class="k">class</span><span class="w"> </span><span class="nc">UUIDModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Abstract model that uses UUID instead of auto-incrementing integer ID.</span>
<span class="sd">    Useful for security (can&#39;t guess IDs) and distributed systems.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Use UUID as primary key instead of auto-incrementing integer</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">UUIDField</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">,</span> <span class="n">editable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">abstract</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># Usage:</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Task</span><span class="p">(</span><span class="n">UUIDModel</span><span class="p">,</span> <span class="n">TimestampedModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Task with UUID primary key and timestamps.</span>
<span class="sd">    ID will be something like: &#39;a1b2c3d4-e5f6-7890-abcd-ef1234567890&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="c1"># Has: UUID id, created_at, updated_at</span>
</code></pre></div>

<p><strong>Example 2: Owner Model (User Ownership)</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># api/models.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.db</span><span class="w"> </span><span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.auth.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">User</span>

<span class="k">class</span><span class="w"> </span><span class="nc">OwnedModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Abstract model that adds owner field to track who created the object.</span>
<span class="sd">    Useful for user-owned resources (tasks, posts, etc.).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># ForeignKey to User - tracks who owns this object</span>
    <span class="n">owner</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%(class)s</span><span class="s1">_set&#39;</span><span class="p">)</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">abstract</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># Usage:</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Task</span><span class="p">(</span><span class="n">OwnedModel</span><span class="p">,</span> <span class="n">TimestampedModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Task model with owner and timestamps.</span>
<span class="sd">    Every task automatically has an owner field.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="c1"># Has: owner, created_at, updated_at</span>
</code></pre></div>

<h3 id="summary">Summary<a class="headerlink" href="#summary" title="Permanent link">&para;</a></h3>
<p><strong>Key Takeaways</strong>:
- Abstract models are templates, not real database tables
- Set <code>abstract = True</code> in <code>Meta</code> class
- Inherit from abstract models to get their fields/methods
- Use for common fields like timestamps, soft delete, etc.
- Follows DRY principle - define once, use everywhere
- Can inherit from multiple abstract models</p>
<p><strong>Next</strong>: Now that you understand abstract models, you can create reusable base models for your project!</p>
<h2 id="drf-authentication-classes">DRF Authentication Classes<a class="headerlink" href="#drf-authentication-classes" title="Permanent link">&para;</a></h2>
<h3 id="authentication-vs-authorization">Authentication vs Authorization<a class="headerlink" href="#authentication-vs-authorization" title="Permanent link">&para;</a></h3>
<p><strong>These are two different but related concepts:</strong></p>
<ul>
<li><strong>Authentication</strong>: Who are you? (Identity)</li>
<li>Verifies user's identity</li>
<li>"Are you really John?"</li>
<li>
<p>Examples: Login, password check, token verification</p>
</li>
<li>
<p><strong>Authorization</strong>: What can you do? (Permissions)</p>
</li>
<li>Determines what user can access</li>
<li>"Can John edit this book?"</li>
<li>Examples: Admin only, owner only, read-only</li>
</ul>
<p><strong>Real-world analogy</strong>:
- <strong>Authentication</strong> = Showing ID at entrance (proving who you are)
- <strong>Authorization</strong> = Security guard checking if you have access to VIP area (what you can do)</p>
<p><strong>Why both?</strong>
- Authentication without authorization = Everyone can do everything
- Authorization without authentication = Can't identify users
- <strong>Need both</strong> for secure APIs!</p>
<p><strong>The Flow</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="mf">1.</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="n">sends</span><span class="w"> </span><span class="n">credentials</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="n">Authentication</span><span class="w"> </span><span class="p">(</span><span class="n">who</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">you</span><span class="err">?</span><span class="p">)</span>
<span class="mf">2.</span><span class="w"> </span><span class="kr">If</span><span class="w"> </span><span class="n">authenticated</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="n">Check</span><span class="w"> </span><span class="n">permissions</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="n">Authorization</span><span class="w"> </span><span class="p">(</span><span class="n">what</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">do</span><span class="err">?</span><span class="p">)</span>
<span class="mf">3.</span><span class="w"> </span><span class="kr">If</span><span class="w"> </span><span class="n">authorized</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="n">Allow</span><span class="w"> </span><span class="n">access</span>
<span class="mf">4.</span><span class="w"> </span><span class="kr">If</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">authorized</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="n">Deny</span><span class="w"> </span><span class="n">access</span><span class="w"> </span><span class="p">(</span><span class="mf">403</span><span class="w"> </span><span class="kr">For</span><span class="n">bidden</span><span class="p">)</span>
</code></pre></div>

<h3 id="drf-authentication-types">DRF Authentication Types<a class="headerlink" href="#drf-authentication-types" title="Permanent link">&para;</a></h3>
<h4 id="1-session-authentication">1. Session Authentication<a class="headerlink" href="#1-session-authentication" title="Permanent link">&para;</a></h4>
<p><strong>What is Session Authentication?</strong></p>
<p>Uses Django's session framework. Stores authentication state on the server.</p>
<p><strong>How it works</strong>:
1. User logs in with username/password
2. Server creates a session (stored in database/cache)
3. Server sends session ID in cookie to browser
4. Browser sends cookie with each request
5. Server checks session to identify user</p>
<p><strong>Why use it?</strong>
- <strong>Simple</strong>: Built into Django
- <strong>Secure</strong>: Session stored server-side
- <strong>Good for</strong>: Web apps (same domain)
- <strong>Automatic</strong>: Browser handles cookies</p>
<p><strong>Limitations</strong>:
- <strong>Same-origin only</strong>: Doesn't work well with mobile apps
- <strong>Cookie-based</strong>: Requires browser cookie support
- <strong>Server storage</strong>: Needs database/cache for sessions</p>
<p><strong>When to use</strong>:
- Web applications (React, Vue on same domain)
- Traditional web apps
- When you control both frontend and backend</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># core/settings.py</span>
<span class="n">REST_FRAMEWORK</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;DEFAULT_AUTHENTICATION_CLASSES&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s1">&#39;rest_framework.authentication.SessionAuthentication&#39;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Why this configuration?</strong>
- Sets default authentication for all views
- Can override per-view if needed
- Multiple authentication classes can be used (tries each until one works)</p>
<h4 id="2-token-authentication">2. Token Authentication<a class="headerlink" href="#2-token-authentication" title="Permanent link">&para;</a></h4>
<p>Simple token-based authentication. Good for client-server setups.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Install</span>
pip<span class="w"> </span>install<span class="w"> </span>djangorestframework-simplejwt
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1"># core/settings.py</span>
<span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># ...</span>
    <span class="s1">&#39;rest_framework&#39;</span><span class="p">,</span>
    <span class="s1">&#39;rest_framework_simplejwt&#39;</span><span class="p">,</span>  <span class="c1"># Add this</span>
<span class="p">]</span>

<span class="n">REST_FRAMEWORK</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;DEFAULT_AUTHENTICATION_CLASSES&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s1">&#39;rest_framework_simplejwt.authentication.JWTAuthentication&#39;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="3-jwt-authentication-recommended">3. JWT Authentication (Recommended)<a class="headerlink" href="#3-jwt-authentication-recommended" title="Permanent link">&para;</a></h4>
<p><strong>What is JWT?</strong></p>
<p><strong>JWT</strong> = JSON Web Token</p>
<p><strong>How it works</strong>:
1. User logs in with username/password
2. Server creates a JWT token (contains user info)
3. Server sends token to client
4. Client stores token (localStorage, memory)
5. Client sends token with each request in header
6. Server verifies token and extracts user info</p>
<p><strong>Why JWT is popular</strong>:
- <strong>Stateless</strong>: No server-side storage needed
- <strong>Scalable</strong>: Works across multiple servers
- <strong>Mobile-friendly</strong>: Works with mobile apps
- <strong>Industry standard</strong>: Used by major companies
- <strong>Self-contained</strong>: Token has all user info</p>
<p><strong>JWT Structure</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="n">Header</span><span class="o">.</span><span class="n">Payload</span><span class="o">.</span><span class="n">Signature</span>

<span class="n">Example</span><span class="p">:</span>
<span class="n">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9</span><span class="o">.</span><span class="n">eyJ1c2VyX2lkIjoxfQ</span><span class="o">.</span><span class="n">signature</span>
</code></pre></div>

<p><strong>Parts</strong>:
- <strong>Header</strong>: Algorithm and token type
- <strong>Payload</strong>: User data (ID, username, etc.)
- <strong>Signature</strong>: Ensures token wasn't tampered with</p>
<p><strong>Why stateless matters</strong>:
- <strong>Session auth</strong>: Server stores session → needs database lookup
- <strong>JWT auth</strong>: Token contains info → no database lookup needed
- <strong>Result</strong>: Faster, more scalable</p>
<p><strong>Security considerations</strong>:
- Tokens expire (access token: 1 hour, refresh token: 1 day)
- Tokens can be blacklisted if compromised
- Always use HTTPS in production (tokens in headers)</p>
<p><strong>When to use JWT</strong>:
- ✅ Mobile apps (iOS, Android)
- ✅ Single Page Applications (SPA)
- ✅ Microservices
- ✅ APIs used by multiple clients
- ❌ Not ideal for traditional server-rendered apps</p>
<h2 id="jwt-authentication-setup">JWT Authentication Setup<a class="headerlink" href="#jwt-authentication-setup" title="Permanent link">&para;</a></h2>
<h3 id="step-1-install-package">Step 1: Install Package<a class="headerlink" href="#step-1-install-package" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code>pip<span class="w"> </span>install<span class="w"> </span>djangorestframework-simplejwt
pip<span class="w"> </span>freeze<span class="w"> </span>&gt;<span class="w"> </span>requirements.txt
</code></pre></div>

<h3 id="step-2-add-to-installed_apps">Step 2: Add to INSTALLED_APPS<a class="headerlink" href="#step-2-add-to-installed_apps" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># core/settings.py</span>
<span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># ...</span>
    <span class="s1">&#39;rest_framework&#39;</span><span class="p">,</span>
    <span class="s1">&#39;rest_framework_simplejwt&#39;</span><span class="p">,</span>
    <span class="s1">&#39;api&#39;</span><span class="p">,</span>
<span class="p">]</span>
</code></pre></div>

<h3 id="step-3-configure-jwt-settings">Step 3: Configure JWT Settings<a class="headerlink" href="#step-3-configure-jwt-settings" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># core/settings.py</span>
<span class="c1"># Import timedelta to specify token expiration times</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">timedelta</span>

<span class="c1"># DRF configuration - applies to all views unless overridden</span>
<span class="n">REST_FRAMEWORK</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># Authentication: How users prove their identity</span>
    <span class="c1"># JWT Authentication uses tokens instead of sessions</span>
    <span class="s1">&#39;DEFAULT_AUTHENTICATION_CLASSES&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s1">&#39;rest_framework_simplejwt.authentication.JWTAuthentication&#39;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="c1"># Permissions: What authenticated users can do</span>
    <span class="c1"># IsAuthenticated = Must be logged in to access (default for all views)</span>
    <span class="s1">&#39;DEFAULT_PERMISSION_CLASSES&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s1">&#39;rest_framework.permissions.IsAuthenticated&#39;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">}</span>

<span class="c1"># JWT-specific settings - controls token behavior</span>
<span class="n">SIMPLE_JWT</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># How long access token is valid (short = more secure, but users need to refresh more often)</span>
    <span class="s1">&#39;ACCESS_TOKEN_LIFETIME&#39;</span><span class="p">:</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="mi">60</span><span class="p">),</span>

    <span class="c1"># How long refresh token is valid (longer = users stay logged in longer)</span>
    <span class="s1">&#39;REFRESH_TOKEN_LIFETIME&#39;</span><span class="p">:</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>

    <span class="c1"># Security: Issue new refresh token when old one is used (prevents token reuse)</span>
    <span class="s1">&#39;ROTATE_REFRESH_TOKENS&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>

    <span class="c1"># Security: Add old refresh token to blacklist after rotation (prevents reuse)</span>
    <span class="s1">&#39;BLACKLIST_AFTER_ROTATION&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>

    <span class="c1"># Track when user last logged in (useful for security monitoring)</span>
    <span class="s1">&#39;UPDATE_LAST_LOGIN&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>

    <span class="c1"># Algorithm to sign tokens (HS256 = HMAC SHA-256, fast and secure)</span>
    <span class="s1">&#39;ALGORITHM&#39;</span><span class="p">:</span> <span class="s1">&#39;HS256&#39;</span><span class="p">,</span>

    <span class="c1"># Secret key to sign tokens (use Django&#39;s SECRET_KEY for security)</span>
    <span class="s1">&#39;SIGNING_KEY&#39;</span><span class="p">:</span> <span class="n">SECRET_KEY</span><span class="p">,</span>

    <span class="c1"># Token type in Authorization header (Bearer is standard OAuth2 format)</span>
    <span class="s1">&#39;AUTH_HEADER_TYPES&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Bearer&#39;</span><span class="p">,),</span>

    <span class="c1"># Header name where token is sent (HTTP_AUTHORIZATION = &quot;Authorization: Bearer &lt;token&gt;&quot;)</span>
    <span class="s1">&#39;AUTH_HEADER_NAME&#39;</span><span class="p">:</span> <span class="s1">&#39;HTTP_AUTHORIZATION&#39;</span><span class="p">,</span>

    <span class="c1"># Which User model field to use as user ID (usually &#39;id&#39;)</span>
    <span class="s1">&#39;USER_ID_FIELD&#39;</span><span class="p">:</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span>

    <span class="c1"># Where to store user ID in token payload (used when decoding token)</span>
    <span class="s1">&#39;USER_ID_CLAIM&#39;</span><span class="p">:</span> <span class="s1">&#39;user_id&#39;</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Explanation of JWT Settings</strong>:</p>
<ul>
<li><strong><code>ACCESS_TOKEN_LIFETIME</code></strong>: How long access token is valid (60 minutes)</li>
<li><strong>Why short?</strong>: If stolen, expires quickly</li>
<li>
<p><strong>Trade-off</strong>: Security vs convenience</p>
</li>
<li>
<p><strong><code>REFRESH_TOKEN_LIFETIME</code></strong>: How long refresh token is valid (1 day)</p>
</li>
<li><strong>Why longer?</strong>: Used to get new access tokens</li>
<li>
<p><strong>More secure</strong>: Stored more securely, used less often</p>
</li>
<li>
<p><strong><code>ROTATE_REFRESH_TOKENS</code></strong>: Issue new refresh token when used</p>
</li>
<li><strong>Why?</strong>: If old token stolen, it becomes invalid</li>
<li>
<p><strong>Security</strong>: Limits damage from token theft</p>
</li>
<li>
<p><strong><code>BLACKLIST_AFTER_ROTATION</code></strong>: Add old refresh token to blacklist</p>
</li>
<li><strong>Why?</strong>: Prevents reuse of old tokens</li>
<li>
<p><strong>Security</strong>: One-time use tokens</p>
</li>
<li>
<p><strong><code>UPDATE_LAST_LOGIN</code></strong>: Update user's last login time</p>
</li>
<li>
<p><strong>Why?</strong>: Track user activity, security monitoring</p>
</li>
<li>
<p><strong><code>ALGORITHM</code></strong>: How token is signed ('HS256' = HMAC SHA-256)</p>
</li>
<li><strong>Why HS256?</strong>: Fast, secure, widely supported</li>
<li>
<p><strong>Alternative</strong>: RS256 (asymmetric, more secure but slower)</p>
</li>
<li>
<p><strong><code>SIGNING_KEY</code></strong>: Secret key to sign tokens (use Django SECRET_KEY)</p>
</li>
<li><strong>Why secret?</strong>: Anyone with key can create valid tokens</li>
<li>
<p><strong>Security</strong>: Never expose this key!</p>
</li>
<li>
<p><strong><code>AUTH_HEADER_TYPES</code></strong>: Token type in header ('Bearer')</p>
</li>
<li><strong>Why Bearer?</strong>: Standard OAuth2 format</li>
<li>
<p><strong>Usage</strong>: <code>Authorization: Bearer &lt;token&gt;</code></p>
</li>
<li>
<p><strong><code>USER_ID_FIELD</code></strong>: Which User model field to use ('id')</p>
</li>
<li><strong><code>USER_ID_CLAIM</code></strong>: Where to store user ID in token ('user_id')</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="c1">### Step 4: Add JWT URLs</span>

<span class="err">```</span><span class="n">python</span>
<span class="c1"># core/urls.py</span>
<span class="c1"># Import Django admin and URL routing</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib</span><span class="w"> </span><span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.urls</span><span class="w"> </span><span class="kn">import</span> <span class="n">path</span><span class="p">,</span> <span class="n">include</span>
<span class="c1"># Import JWT view classes for token management</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework_simplejwt.views</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">TokenObtainPairView</span><span class="p">,</span>  <span class="c1"># POST /api/token/ - Get tokens (login)</span>
    <span class="n">TokenRefreshView</span><span class="p">,</span>     <span class="c1"># POST /api/token/refresh/ - Get new access token</span>
    <span class="n">TokenVerifyView</span><span class="p">,</span>      <span class="c1"># POST /api/token/verify/ - Check if token is valid</span>
<span class="p">)</span>

<span class="c1"># URL patterns - maps URLs to views</span>
<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># Django admin interface</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;admin/&#39;</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>
    <span class="c1"># Include API URLs from api app</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;api/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s1">&#39;api.urls&#39;</span><span class="p">)),</span>

    <span class="c1"># JWT authentication endpoints</span>
    <span class="c1"># POST /api/token/ - Login: Send username/password, get access+refresh tokens</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;api/token/&#39;</span><span class="p">,</span> <span class="n">TokenObtainPairView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;token_obtain_pair&#39;</span><span class="p">),</span>

    <span class="c1"># POST /api/token/refresh/ - Refresh: Send refresh token, get new access token</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;api/token/refresh/&#39;</span><span class="p">,</span> <span class="n">TokenRefreshView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;token_refresh&#39;</span><span class="p">),</span>

    <span class="c1"># POST /api/token/verify/ - Verify: Send token, check if it&#39;s valid</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;api/token/verify/&#39;</span><span class="p">,</span> <span class="n">TokenVerifyView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;token_verify&#39;</span><span class="p">),</span>
<span class="p">]</span>
</code></pre></div>

<h3 id="step-5-create-user-registration-view">Step 5: Create User Registration View<a class="headerlink" href="#step-5-create-user-registration-view" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># api/serializers.py</span>
<span class="c1"># Import DRF serializers for data validation and conversion</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework</span><span class="w"> </span><span class="kn">import</span> <span class="n">serializers</span>
<span class="c1"># Import Django&#39;s built-in User model</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.auth.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">User</span>

<span class="c1"># Serializer for user registration</span>
<span class="c1"># ModelSerializer automatically creates fields based on User model</span>
<span class="k">class</span><span class="w"> </span><span class="nc">UserRegistrationSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
    <span class="c1"># Password field: write_only means it&#39;s only used when creating (not returned in response)</span>
    <span class="c1"># min_length=8 enforces minimum password length</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">write_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">min_length</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

    <span class="c1"># Password confirmation field: also write_only, used to verify passwords match</span>
    <span class="n">password_confirm</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">write_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="c1"># Base serializer on User model</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">User</span>
        <span class="c1"># Fields to include in registration form</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="s1">&#39;password_confirm&#39;</span><span class="p">,</span> <span class="s1">&#39;first_name&#39;</span><span class="p">,</span> <span class="s1">&#39;last_name&#39;</span><span class="p">]</span>

    <span class="c1"># Object-level validation: Check if passwords match</span>
    <span class="c1"># This method is called after field-level validation</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="c1"># Compare password and password_confirm</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;password_confirm&#39;</span><span class="p">]:</span>
            <span class="c1"># Raise validation error if they don&#39;t match</span>
            <span class="k">raise</span> <span class="n">serializers</span><span class="o">.</span><span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Passwords don&#39;t match&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span>

    <span class="c1"># Override create() to handle password hashing</span>
    <span class="c1"># This is called when serializer.save() is called</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">validated_data</span><span class="p">):</span>
        <span class="c1"># Remove password_confirm (not a User model field, just for validation)</span>
        <span class="n">validated_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;password_confirm&#39;</span><span class="p">)</span>
        <span class="c1"># Use create_user() instead of create() - this hashes the password automatically</span>
        <span class="c1"># create_user() is secure, create() would store plain text password (BAD!)</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="o">**</span><span class="n">validated_data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">user</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1"># api/views.py</span>
<span class="c1"># Import generic views - CreateAPIView provides POST endpoint automatically</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework</span><span class="w"> </span><span class="kn">import</span> <span class="n">generics</span><span class="p">,</span> <span class="n">status</span>
<span class="c1"># Import Response to return custom JSON responses</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework.response</span><span class="w"> </span><span class="kn">import</span> <span class="n">Response</span>
<span class="c1"># Import JWT token classes to generate tokens for new users</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework_simplejwt.tokens</span><span class="w"> </span><span class="kn">import</span> <span class="n">RefreshToken</span>
<span class="c1"># Import User model</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.auth.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">User</span>
<span class="c1"># Import our registration serializer</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.serializers</span><span class="w"> </span><span class="kn">import</span> <span class="n">UserRegistrationSerializer</span>

<span class="c1"># CreateAPIView automatically creates a POST endpoint</span>
<span class="c1"># Users can POST to this endpoint to register</span>
<span class="k">class</span><span class="w"> </span><span class="nc">UserRegistrationView</span><span class="p">(</span><span class="n">generics</span><span class="o">.</span><span class="n">CreateAPIView</span><span class="p">):</span>
    <span class="c1"># Base queryset (not really used for creation, but required)</span>
    <span class="n">queryset</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="c1"># Serializer to validate and create user</span>
    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">UserRegistrationSerializer</span>

    <span class="c1"># Empty permission_classes = Allow anyone to register (public endpoint)</span>
    <span class="c1"># No authentication required to create an account</span>
    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Override create() to return tokens after registration</span>
    <span class="c1"># This method is called when POST request is made</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># Get serializer instance with request data</span>
        <span class="n">serializer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_serializer</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

        <span class="c1"># Validate data - raise_exception=True returns 400 error if invalid</span>
        <span class="n">serializer</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(</span><span class="n">raise_exception</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Save user to database (calls serializer.create() which hashes password)</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">serializer</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="c1"># Generate JWT tokens for the newly created user</span>
        <span class="c1"># RefreshToken contains both refresh and access tokens</span>
        <span class="n">refresh</span> <span class="o">=</span> <span class="n">RefreshToken</span><span class="o">.</span><span class="n">for_user</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>

        <span class="c1"># Return user data and tokens in response</span>
        <span class="c1"># User gets tokens immediately after registration (auto-login)</span>
        <span class="k">return</span> <span class="n">Response</span><span class="p">({</span>
            <span class="s1">&#39;user&#39;</span><span class="p">:</span> <span class="n">serializer</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>  <span class="c1"># User information (username, email, etc.)</span>
            <span class="s1">&#39;refresh&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">refresh</span><span class="p">),</span>  <span class="c1"># Refresh token (long-lived, used to get new access tokens)</span>
            <span class="s1">&#39;access&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">refresh</span><span class="o">.</span><span class="n">access_token</span><span class="p">),</span>  <span class="c1"># Access token (short-lived, used for API requests)</span>
        <span class="p">},</span> <span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_201_CREATED</span><span class="p">)</span>  <span class="c1"># 201 = Created (successful resource creation)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1"># api/urls.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.urls</span><span class="w"> </span><span class="kn">import</span> <span class="n">path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># ... other URLs ...</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;register/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">UserRegistrationView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;register&#39;</span><span class="p">),</span>
<span class="p">]</span>
</code></pre></div>

<h3 id="step-6-test-jwt-authentication">Step 6: Test JWT Authentication<a class="headerlink" href="#step-6-test-jwt-authentication" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Register user</span>
curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:8000/api/register/<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{</span>
<span class="s1">    &quot;username&quot;: &quot;testuser&quot;,</span>
<span class="s1">    &quot;email&quot;: &quot;test@example.com&quot;,</span>
<span class="s1">    &quot;password&quot;: &quot;testpass123&quot;,</span>
<span class="s1">    &quot;password_confirm&quot;: &quot;testpass123&quot;</span>
<span class="s1">  }&#39;</span>

<span class="c1"># Get token</span>
<span class="c1"># Note: By default, JWT uses &#39;username&#39; for authentication. </span>
<span class="c1"># The example below shows username (default). If you&#39;ve configured JWT to use email, </span>
<span class="c1"># replace &#39;username&#39; with &#39;email&#39; in the request body.</span>

curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:8000/api/token/<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{&quot;username&quot;: &quot;testuser&quot;, &quot;password&quot;: &quot;testpass123&quot;}&#39;</span>

<span class="c1"># Alternative: If using email-based authentication (requires custom JWT serializer)</span>
<span class="c1"># curl -X POST http://localhost:8000/api/token/ \</span>
<span class="c1">#   -H &quot;Content-Type: application/json&quot; \</span>
<span class="c1">#   -d &#39;{&quot;email&quot;: &quot;test@example.com&quot;, &quot;password&quot;: &quot;testpass123&quot;}&#39;</span>

<span class="c1"># Use token</span>
<span class="nv">TOKEN</span><span class="o">=</span><span class="s2">&quot;your_access_token_here&quot;</span>
curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>http://localhost:8000/api/tasks/
</code></pre></div>

<h2 id="permissions">Permissions<a class="headerlink" href="#permissions" title="Permanent link">&para;</a></h2>
<h3 id="what-are-permissions">What are Permissions?<a class="headerlink" href="#what-are-permissions" title="Permanent link">&para;</a></h3>
<p><strong>Permissions</strong> determine what authenticated users can do.</p>
<p><strong>Why Permissions?</strong>
- <strong>Security</strong>: Not all users should do everything
- <strong>Data protection</strong>: Users should only see/edit their own data
- <strong>Role-based access</strong>: Admins can do more than regular users
- <strong>Compliance</strong>: Meet security requirements</p>
<p><strong>Real-world analogy</strong>:
- <strong>No permissions</strong> = Everyone has master key (bad!)
- <strong>With permissions</strong> = Different keys for different access levels (good!)</p>
<p><strong>Permission Levels</strong>:
1. <strong>Public</strong>: Anyone can access (AllowAny)
2. <strong>Authenticated</strong>: Must be logged in (IsAuthenticated)
3. <strong>Owner</strong>: Can only access own data (IsOwnerOrReadOnly)
4. <strong>Admin</strong>: Only staff can access (IsAdminUser)</p>
<h3 id="built-in-permission-classes">Built-in Permission Classes<a class="headerlink" href="#built-in-permission-classes" title="Permanent link">&para;</a></h3>
<h4 id="1-allowany">1. AllowAny<a class="headerlink" href="#1-allowany" title="Permanent link">&para;</a></h4>
<p><strong>What it does</strong>: Anyone can access, no authentication required.</p>
<p><strong>Why use it?</strong>
- Public data (blog posts, product listings)
- Registration/login endpoints
- Public APIs
- When you want maximum accessibility</p>
<p><strong>Security note</strong>: Use carefully! Only for truly public data.</p>
<p><strong>When to use</strong>:
- ✅ Public blog posts
- ✅ Product catalogs
- ✅ Public user profiles
- ❌ User data
- ❌ Admin functions</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework.permissions</span><span class="w"> </span><span class="kn">import</span> <span class="n">AllowAny</span>

<span class="k">class</span><span class="w"> </span><span class="nc">TaskViewSet</span><span class="p">(</span><span class="n">viewsets</span><span class="o">.</span><span class="n">ModelViewSet</span><span class="p">):</span>
    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">AllowAny</span><span class="p">]</span>
    <span class="c1"># ...</span>
</code></pre></div>

<p><strong>Note</strong>: In this example, we use <code>TaskViewSet</code>, but the same pattern applies to any ViewSet (Book, Product, etc.).</p>
<h4 id="2-isauthenticated">2. IsAuthenticated<a class="headerlink" href="#2-isauthenticated" title="Permanent link">&para;</a></h4>
<p><strong>What it does</strong>: User must be logged in (authenticated) to access.</p>
<p><strong>Why use it?</strong>
- <strong>Protect data</strong>: Only logged-in users can access
- <strong>User-specific content</strong>: Show personalized data
- <strong>Account required</strong>: Force users to create accounts
- <strong>Security</strong>: Basic protection for most endpoints</p>
<p><strong>When to use</strong>:
- ✅ User's own tasks/books
- ✅ User profiles
- ✅ Private data
- ✅ Any endpoint requiring user identity</p>
<p><strong>What happens if not authenticated?</strong>
- Returns <code>401 Unauthorized</code>
- Client must login first
- Token/session required</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework.permissions</span><span class="w"> </span><span class="kn">import</span> <span class="n">IsAuthenticated</span>

<span class="k">class</span><span class="w"> </span><span class="nc">TaskViewSet</span><span class="p">(</span><span class="n">viewsets</span><span class="o">.</span><span class="n">ModelViewSet</span><span class="p">):</span>
    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">IsAuthenticated</span><span class="p">]</span>
    <span class="c1"># ...</span>
</code></pre></div>

<p><strong>Why this configuration?</strong>
- Applies to all actions (list, create, retrieve, update, delete)
- Can override per-action if needed
- Most common permission for user data</p>
<p><strong>Note</strong>: This is the most common permission for user-owned resources like tasks, where users should only see their own data.</p>
<h4 id="3-isadminuser">3. IsAdminUser<a class="headerlink" href="#3-isadminuser" title="Permanent link">&para;</a></h4>
<p>User must be staff/admin.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework.permissions</span><span class="w"> </span><span class="kn">import</span> <span class="n">IsAdminUser</span>

<span class="k">class</span><span class="w"> </span><span class="nc">TaskViewSet</span><span class="p">(</span><span class="n">viewsets</span><span class="o">.</span><span class="n">ModelViewSet</span><span class="p">):</span>
    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">IsAdminUser</span><span class="p">]</span>
    <span class="c1"># ...</span>
</code></pre></div>

<p><strong>Note</strong>: Use this for admin-only endpoints. For user data like tasks, you typically want <code>IsAuthenticated</code> instead.</p>
<h4 id="4-isauthenticatedorreadonly">4. IsAuthenticatedOrReadOnly<a class="headerlink" href="#4-isauthenticatedorreadonly" title="Permanent link">&para;</a></h4>
<p><strong>What it does</strong>: 
- <strong>Authenticated users</strong>: Can do everything (read, create, update, delete)
- <strong>Unauthenticated users</strong>: Can only read (GET requests)</p>
<p><strong>Why use it?</strong>
- <strong>Public viewing</strong>: Anyone can see data
- <strong>Protected editing</strong>: Only logged-in users can modify
- <strong>Common pattern</strong>: Blog posts, comments, products
- <strong>User engagement</strong>: Encourage registration to participate</p>
<p><strong>Real-world example</strong>:
- Blog: Anyone can read posts, only logged-in users can comment
- Products: Anyone can browse, only logged-in users can add to cart
- Comments: Anyone can read, only logged-in users can post</p>
<p><strong>When to use</strong>:
- ✅ Public content with user contributions
- ✅ Read-mostly APIs
- ✅ When you want public access but protected writes
- ❌ Private/sensitive data</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework.permissions</span><span class="w"> </span><span class="kn">import</span> <span class="n">IsAuthenticatedOrReadOnly</span>

<span class="k">class</span><span class="w"> </span><span class="nc">TaskViewSet</span><span class="p">(</span><span class="n">viewsets</span><span class="o">.</span><span class="n">ModelViewSet</span><span class="p">):</span>
    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">IsAuthenticatedOrReadOnly</span><span class="p">]</span>
    <span class="c1"># ...</span>
</code></pre></div>

<p><strong>What this means</strong>:
- <code>GET /api/tasks/</code> → Anyone can access ✅
- <code>POST /api/tasks/</code> → Must be authenticated ✅
- <code>PUT /api/tasks/1/</code> → Must be authenticated ✅
- <code>DELETE /api/tasks/1/</code> → Must be authenticated ✅</p>
<p><strong>Note</strong>: For private user data like personal tasks, you'd typically use <code>IsAuthenticated</code> instead. This permission is better for public content.</p>
<h3 id="custom-permissions">Custom Permissions<a class="headerlink" href="#custom-permissions" title="Permanent link">&para;</a></h3>
<h4 id="isownerorreadonly">IsOwnerOrReadOnly<a class="headerlink" href="#isownerorreadonly" title="Permanent link">&para;</a></h4>
<p>Only the owner can edit/delete, others can read.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># api/permissions.py</span>
<span class="c1"># Import DRF permissions module</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework</span><span class="w"> </span><span class="kn">import</span> <span class="n">permissions</span>

<span class="c1"># Custom permission class - inherits from BasePermission</span>
<span class="c1"># BasePermission is the base class for all permission classes</span>
<span class="k">class</span><span class="w"> </span><span class="nc">IsOwnerOrReadOnly</span><span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">BasePermission</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Custom permission to only allow owners to edit/delete objects.</span>
<span class="sd">    Anyone can read (GET), but only the owner can modify (POST, PUT, PATCH, DELETE).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># This method is called for object-level permissions (detail views)</span>
    <span class="c1"># For list views, use has_permission() instead</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">has_object_permission</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">view</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="c1"># SAFE_METHODS = GET, HEAD, OPTIONS (read-only operations)</span>
        <span class="c1"># If it&#39;s a read operation, allow it for everyone</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="ow">in</span> <span class="n">permissions</span><span class="o">.</span><span class="n">SAFE_METHODS</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>  <span class="c1"># Allow read access to anyone</span>

        <span class="c1"># For write operations (POST, PUT, PATCH, DELETE), check ownership</span>
        <span class="c1"># obj.owner = the user who owns this object (from model&#39;s owner field)</span>
        <span class="c1"># request.user = the currently logged-in user (from authentication)</span>
        <span class="c1"># Only allow if they match</span>
        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">owner</span> <span class="o">==</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
</code></pre></div>

<p><strong>Use in views:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># api/views.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework.permissions</span><span class="w"> </span><span class="kn">import</span> <span class="n">IsAuthenticated</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.permissions</span><span class="w"> </span><span class="kn">import</span> <span class="n">IsOwnerOrReadOnly</span>

<span class="k">class</span><span class="w"> </span><span class="nc">TaskViewSet</span><span class="p">(</span><span class="n">viewsets</span><span class="o">.</span><span class="n">ModelViewSet</span><span class="p">):</span>
    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">IsAuthenticated</span><span class="p">,</span> <span class="n">IsOwnerOrReadOnly</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">perform_create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">serializer</span><span class="p">):</span>
        <span class="n">serializer</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">owner</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
</code></pre></div>

<p><strong>Why this works for tasks:</strong>
- Users can read all tasks (or filter to their own in <code>get_queryset()</code>)
- Users can only edit/delete their own tasks
- Perfect for user-owned resources like tasks, notes, etc.</p>
<h3 id="permission-at-view-level">Permission at View Level<a class="headerlink" href="#permission-at-view-level" title="Permanent link">&para;</a></h3>
<p><strong>Why different permissions per action?</strong>
- <strong>List/Retrieve</strong>: Maybe public (AllowAny) or authenticated (IsAuthenticated)
- <strong>Create</strong>: Usually requires authentication
- <strong>Update/Delete</strong>: Usually requires ownership (IsOwnerOrReadOnly)</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Different permissions for different actions</span>
<span class="c1"># Import permission classes</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework.permissions</span><span class="w"> </span><span class="kn">import</span> <span class="n">IsAuthenticated</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.permissions</span><span class="w"> </span><span class="kn">import</span> <span class="n">IsOwnerOrReadOnly</span>

<span class="k">class</span><span class="w"> </span><span class="nc">TaskViewSet</span><span class="p">(</span><span class="n">viewsets</span><span class="o">.</span><span class="n">ModelViewSet</span><span class="p">):</span>
    <span class="c1"># Override get_permissions() to set different permissions per action</span>
    <span class="c1"># This method is called by DRF to determine which permissions to check</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_permissions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># self.action = current action: &#39;list&#39;, &#39;create&#39;, &#39;retrieve&#39;, &#39;update&#39;, &#39;destroy&#39;, etc.</span>

        <span class="c1"># For create action (POST /api/tasks/)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">action</span> <span class="o">==</span> <span class="s1">&#39;create&#39;</span><span class="p">:</span>
            <span class="c1"># Anyone authenticated can create tasks</span>
            <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">IsAuthenticated</span><span class="p">]</span>

        <span class="c1"># For update/delete actions (PUT, PATCH, DELETE /api/tasks/1/)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">action</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="s1">&#39;partial_update&#39;</span><span class="p">,</span> <span class="s1">&#39;destroy&#39;</span><span class="p">]:</span>
            <span class="c1"># Must be authenticated AND must be the owner</span>
            <span class="c1"># IsAuthenticated checks if user is logged in</span>
            <span class="c1"># IsOwnerOrReadOnly checks if user owns the task</span>
            <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">IsAuthenticated</span><span class="p">,</span> <span class="n">IsOwnerOrReadOnly</span><span class="p">]</span>

        <span class="c1"># For list/retrieve actions (GET /api/tasks/ or GET /api/tasks/1/)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Must be logged in to view tasks</span>
            <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">IsAuthenticated</span><span class="p">]</span>

        <span class="c1"># Return list of permission instances</span>
        <span class="c1"># DRF will check all permissions - all must pass for access to be granted</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">permission</span><span class="p">()</span> <span class="k">for</span> <span class="n">permission</span> <span class="ow">in</span> <span class="n">permission_classes</span><span class="p">]</span>
</code></pre></div>

<p><strong>Explanation</strong>:
- <strong><code>create</code></strong>: Anyone authenticated can create tasks
- <strong><code>update/delete</code></strong>: Only task owner can modify
- <strong><code>list/retrieve</code></strong>: Authenticated users can view (you might filter to own tasks in <code>get_queryset()</code>)</p>
<p><strong>Alternative for private tasks</strong> (users only see their own):</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">TaskViewSet</span><span class="p">(</span><span class="n">viewsets</span><span class="o">.</span><span class="n">ModelViewSet</span><span class="p">):</span>
    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">IsAuthenticated</span><span class="p">]</span>  <span class="c1"># Same for all actions</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Users only see their own tasks</span>
        <span class="k">return</span> <span class="n">Task</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">owner</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
</code></pre></div>

<h2 id="step-by-step-secure-book-api">Step-by-Step: Secure Book API<a class="headerlink" href="#step-by-step-secure-book-api" title="Permanent link">&para;</a></h2>
<p><strong>Note</strong>: This section uses Book API as an example of content that can be public or user-owned. The same patterns apply to Task API or any other model.</p>
<p>Let's upgrade the Book API with authentication and permissions. (Filtering, searching, and pagination will be covered in Level 2B.)</p>
<h3 id="step-1-update-book-model">Step 1: Update Book Model<a class="headerlink" href="#step-1-update-book-model" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># api/models.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.db</span><span class="w"> </span><span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.auth.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">User</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Book</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">author</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">published_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">()</span>
    <span class="n">isbn</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">13</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">owner</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;books&#39;</span><span class="p">)</span>
    <span class="n">created_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">updated_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="si">}</span><span class="s2"> by </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">author</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-created_at&#39;</span><span class="p">]</span>
</code></pre></div>

<p><strong>Create migration:</strong></p>
<div class="codehilite"><pre><span></span><code>python<span class="w"> </span>manage.py<span class="w"> </span>makemigrations
python<span class="w"> </span>manage.py<span class="w"> </span>migrate
</code></pre></div>

<h3 id="step-2-update-book-serializer">Step 2: Update Book Serializer<a class="headerlink" href="#step-2-update-book-serializer" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># api/serializers.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework</span><span class="w"> </span><span class="kn">import</span> <span class="n">serializers</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Book</span>

<span class="k">class</span><span class="w"> </span><span class="nc">BookSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
    <span class="n">owner_username</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="s1">&#39;owner.username&#39;</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Book</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;author&#39;</span><span class="p">,</span> <span class="s1">&#39;published_date&#39;</span><span class="p">,</span> <span class="s1">&#39;isbn&#39;</span><span class="p">,</span> <span class="s1">&#39;description&#39;</span><span class="p">,</span> 
                  <span class="s1">&#39;owner&#39;</span><span class="p">,</span> <span class="s1">&#39;owner_username&#39;</span><span class="p">,</span> <span class="s1">&#39;created_at&#39;</span><span class="p">,</span> <span class="s1">&#39;updated_at&#39;</span><span class="p">]</span>
        <span class="n">read_only_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;owner&#39;</span><span class="p">,</span> <span class="s1">&#39;created_at&#39;</span><span class="p">,</span> <span class="s1">&#39;updated_at&#39;</span><span class="p">]</span>
</code></pre></div>

<h3 id="step-3-update-book-viewset">Step 3: Update Book ViewSet<a class="headerlink" href="#step-3-update-book-viewset" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># api/views.py</span>
<span class="c1"># Import DRF viewsets for CRUD operations</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework</span><span class="w"> </span><span class="kn">import</span> <span class="n">viewsets</span>
<span class="c1"># Import permission classes to control access</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework.permissions</span><span class="w"> </span><span class="kn">import</span> <span class="n">IsAuthenticatedOrReadOnly</span>
<span class="c1"># Import models and serializers</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Book</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.serializers</span><span class="w"> </span><span class="kn">import</span> <span class="n">BookSerializer</span>
<span class="c1"># Import custom permission class (we&#39;ll create this)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.permissions</span><span class="w"> </span><span class="kn">import</span> <span class="n">IsOwnerOrReadOnly</span>

<span class="c1"># ViewSet provides all CRUD operations automatically</span>
<span class="c1"># ModelViewSet = List, Create, Retrieve, Update, Delete</span>
<span class="k">class</span><span class="w"> </span><span class="nc">BookViewSet</span><span class="p">(</span><span class="n">viewsets</span><span class="o">.</span><span class="n">ModelViewSet</span><span class="p">):</span>
    <span class="c1"># Base queryset - all books in database</span>
    <span class="c1"># We&#39;ll filter this in get_queryset() if needed</span>
    <span class="n">queryset</span> <span class="o">=</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="c1"># Serializer converts Book objects to/from JSON</span>
    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">BookSerializer</span>

    <span class="c1"># Permission classes control who can access this endpoint</span>
    <span class="c1"># IsAuthenticatedOrReadOnly = Anyone can read, only authenticated users can write</span>
    <span class="c1"># IsOwnerOrReadOnly = Only owner can edit/delete (custom permission)</span>
    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">IsAuthenticatedOrReadOnly</span><span class="p">,</span> <span class="n">IsOwnerOrReadOnly</span><span class="p">]</span>

    <span class="c1"># Note: Filtering, searching, and ordering will be added in Level 2B</span>

    <span class="c1"># Override perform_create to automatically set the owner</span>
    <span class="c1"># This is called when a new book is created via POST</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">perform_create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">serializer</span><span class="p">):</span>
        <span class="c1"># Set owner to the currently logged-in user</span>
        <span class="c1"># self.request.user is automatically set by authentication</span>
        <span class="n">serializer</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">owner</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
</code></pre></div>

<h3 id="step-5-test-secure-book-api">Step 5: Test Secure Book API<a class="headerlink" href="#step-5-test-secure-book-api" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get token</span>
<span class="c1"># Note: By default, JWT uses &#39;username&#39; for authentication.</span>
<span class="c1"># If you&#39;ve configured JWT to use email, replace &#39;username&#39; with &#39;email&#39; below.</span>

<span class="nv">TOKEN</span><span class="o">=</span><span class="k">$(</span>curl<span class="w"> </span>-s<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:8000/api/token/<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{&quot;username&quot;: &quot;testuser&quot;, &quot;password&quot;: &quot;testpass123&quot;}&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span><span class="p">|</span><span class="w"> </span>python<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;import sys, json; print(json.load(sys.stdin)[&#39;access&#39;])&quot;</span><span class="k">)</span>

<span class="c1"># Alternative: If using email-based authentication (requires custom JWT serializer)</span>
<span class="c1"># TOKEN=$(curl -s -X POST http://localhost:8000/api/token/ \</span>
<span class="c1">#   -H &quot;Content-Type: application/json&quot; \</span>
<span class="c1">#   -d &#39;{&quot;email&quot;: &quot;test@example.com&quot;, &quot;password&quot;: &quot;testpass123&quot;}&#39; \</span>
<span class="c1">#   | python -c &quot;import sys, json; print(json.load(sys.stdin)[&#39;access&#39;])&quot;)</span>

<span class="c1"># Create book (authenticated)</span>
curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:8000/api/books/<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{</span>
<span class="s1">    &quot;title&quot;: &quot;Django for Beginners&quot;,</span>
<span class="s1">    &quot;author&quot;: &quot;John Doe&quot;,</span>
<span class="s1">    &quot;published_date&quot;: &quot;2023-01-15&quot;,</span>
<span class="s1">    &quot;description&quot;: &quot;Learn Django step by step&quot;</span>
<span class="s1">  }&#39;</span>

<span class="c1"># List books (anyone can read - public endpoint)</span>
curl<span class="w"> </span>http://localhost:8000/api/books/

<span class="c1"># Get specific book (anyone can read)</span>
curl<span class="w"> </span>http://localhost:8000/api/books/1/

<span class="c1"># Update book (must be authenticated and owner)</span>
curl<span class="w"> </span>-X<span class="w"> </span>PATCH<span class="w"> </span>http://localhost:8000/api/books/1/<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{&quot;title&quot;: &quot;Updated Title&quot;}&#39;</span>

<span class="c1"># Delete book (must be authenticated and owner)</span>
curl<span class="w"> </span>-X<span class="w"> </span>DELETE<span class="w"> </span>http://localhost:8000/api/books/1/<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span>

<span class="c1"># Note: Filtering, searching, and ordering will be covered in Level 2B</span>
</code></pre></div>

<h2 id="step-by-step-secure-task-api">Step-by-Step: Secure Task API<a class="headerlink" href="#step-by-step-secure-task-api" title="Permanent link">&para;</a></h2>
<p><strong>Note</strong>: This section focuses on Task API as the primary example (consistent with Level 1). Tasks are typically private, user-owned data, making them perfect for demonstrating authentication and permissions.</p>
<h3 id="step-1-update-task-model">Step 1: Update Task Model<a class="headerlink" href="#step-1-update-task-model" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># api/models.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.db</span><span class="w"> </span><span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.auth.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">User</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Task</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">desc</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">completed</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">owner</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;tasks&#39;</span><span class="p">)</span>
    <span class="n">created_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">updated_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-created_at&#39;</span><span class="p">]</span>
</code></pre></div>

<p><strong>Create migration:</strong></p>
<div class="codehilite"><pre><span></span><code>python<span class="w"> </span>manage.py<span class="w"> </span>makemigrations
python<span class="w"> </span>manage.py<span class="w"> </span>migrate
</code></pre></div>

<h3 id="step-2-update-task-serializer">Step 2: Update Task Serializer<a class="headerlink" href="#step-2-update-task-serializer" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># api/serializers.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework</span><span class="w"> </span><span class="kn">import</span> <span class="n">serializers</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Task</span>

<span class="k">class</span><span class="w"> </span><span class="nc">TaskSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
    <span class="n">owner_username</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="s1">&#39;owner.username&#39;</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Task</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;desc&#39;</span><span class="p">,</span> <span class="s1">&#39;completed&#39;</span><span class="p">,</span> <span class="s1">&#39;owner&#39;</span><span class="p">,</span> <span class="s1">&#39;owner_username&#39;</span><span class="p">,</span> 
                  <span class="s1">&#39;created_at&#39;</span><span class="p">,</span> <span class="s1">&#39;updated_at&#39;</span><span class="p">]</span>
        <span class="n">read_only_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;owner&#39;</span><span class="p">,</span> <span class="s1">&#39;created_at&#39;</span><span class="p">,</span> <span class="s1">&#39;updated_at&#39;</span><span class="p">]</span>
</code></pre></div>

<h3 id="step-3-update-task-viewset">Step 3: Update Task ViewSet<a class="headerlink" href="#step-3-update-task-viewset" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># api/views.py</span>
<span class="c1"># Import DRF viewsets for CRUD operations</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework</span><span class="w"> </span><span class="kn">import</span> <span class="n">viewsets</span>
<span class="c1"># Import permission class - users must be authenticated</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework.permissions</span><span class="w"> </span><span class="kn">import</span> <span class="n">IsAuthenticated</span>
<span class="c1"># Import models and serializers</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Task</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.serializers</span><span class="w"> </span><span class="kn">import</span> <span class="n">TaskSerializer</span>

<span class="c1"># ViewSet provides all CRUD operations automatically</span>
<span class="c1"># ModelViewSet = List, Create, Retrieve, Update, Delete</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TaskViewSet</span><span class="p">(</span><span class="n">viewsets</span><span class="o">.</span><span class="n">ModelViewSet</span><span class="p">):</span>
    <span class="c1"># Serializer converts Task objects to/from JSON</span>
    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">TaskSerializer</span>

    <span class="c1"># Permission class: Only authenticated users can access</span>
    <span class="c1"># Unauthenticated requests will get 401 Unauthorized</span>
    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">IsAuthenticated</span><span class="p">]</span>

    <span class="c1"># Note: Filtering, searching, and ordering will be added in Level 2B</span>

    <span class="c1"># Override get_queryset to filter tasks by owner</span>
    <span class="c1"># This ensures users only see their own tasks</span>
    <span class="c1"># Called for list and retrieve operations</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Filter tasks where owner matches the current logged-in user</span>
        <span class="c1"># self.request.user is automatically set by authentication</span>
        <span class="k">return</span> <span class="n">Task</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">owner</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>

    <span class="c1"># Override perform_create to automatically set the owner</span>
    <span class="c1"># This is called when a new task is created via POST</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">perform_create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">serializer</span><span class="p">):</span>
        <span class="c1"># Set owner to the currently logged-in user</span>
        <span class="c1"># self.request.user is automatically set by authentication</span>
        <span class="n">serializer</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">owner</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
</code></pre></div>

<h3 id="step-5-test-secure-task-api">Step 5: Test Secure Task API<a class="headerlink" href="#step-5-test-secure-task-api" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Create task (authenticated)</span>
curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:8000/api/tasks/<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{</span>
<span class="s1">    &quot;title&quot;: &quot;Learn DRF Level 2&quot;,</span>
<span class="s1">    &quot;desc&quot;: &quot;Complete authentication and permissions&quot;,</span>
<span class="s1">    &quot;completed&quot;: false</span>
<span class="s1">  }&#39;</span>

<span class="c1"># List my tasks (only shows tasks owned by authenticated user)</span>
curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>http://localhost:8000/api/tasks/

<span class="c1"># Get specific task (must be owner)</span>
curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>http://localhost:8000/api/tasks/1/

<span class="c1"># Update task (must be authenticated and owner)</span>
curl<span class="w"> </span>-X<span class="w"> </span>PATCH<span class="w"> </span>http://localhost:8000/api/tasks/1/<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{&quot;completed&quot;: true}&#39;</span>

<span class="c1"># Delete task (must be authenticated and owner)</span>
curl<span class="w"> </span>-X<span class="w"> </span>DELETE<span class="w"> </span>http://localhost:8000/api/tasks/1/<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span>

<span class="c1"># Try to access without token (should get 401 Unauthorized)</span>
curl<span class="w"> </span>http://localhost:8000/api/tasks/

<span class="c1"># Note: Filtering, searching, and ordering will be covered in Level 2B</span>
</code></pre></div>

<h2 id="userprofile-api">UserProfile API<a class="headerlink" href="#userprofile-api" title="Permanent link">&para;</a></h2>
<h3 id="step-1-create-userprofile-model">Step 1: Create UserProfile Model<a class="headerlink" href="#step-1-create-userprofile-model" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># api/models.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.db</span><span class="w"> </span><span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.auth.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">User</span>

<span class="k">class</span><span class="w"> </span><span class="nc">UserProfile</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">OneToOneField</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;profile&#39;</span><span class="p">)</span>
    <span class="n">bio</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">phone_number</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">avatar</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ImageField</span><span class="p">(</span><span class="n">upload_to</span><span class="o">=</span><span class="s1">&#39;avatars/&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">website</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">URLField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">created_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">updated_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">username</span><span class="si">}</span><span class="s2">&#39;s Profile&quot;</span>
</code></pre></div>

<h3 id="step-2-create-userprofile-serializer">Step 2: Create UserProfile Serializer<a class="headerlink" href="#step-2-create-userprofile-serializer" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># api/serializers.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework</span><span class="w"> </span><span class="kn">import</span> <span class="n">serializers</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">UserProfile</span>

<span class="k">class</span><span class="w"> </span><span class="nc">UserProfileSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="s1">&#39;user.username&#39;</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">EmailField</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="s1">&#39;user.email&#39;</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">UserProfile</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="s1">&#39;bio&#39;</span><span class="p">,</span> <span class="s1">&#39;phone_number&#39;</span><span class="p">,</span> 
                  <span class="s1">&#39;avatar&#39;</span><span class="p">,</span> <span class="s1">&#39;website&#39;</span><span class="p">,</span> <span class="s1">&#39;created_at&#39;</span><span class="p">,</span> <span class="s1">&#39;updated_at&#39;</span><span class="p">]</span>
        <span class="n">read_only_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;created_at&#39;</span><span class="p">,</span> <span class="s1">&#39;updated_at&#39;</span><span class="p">]</span>
</code></pre></div>

<h3 id="step-3-create-userprofile-viewset">Step 3: Create UserProfile ViewSet<a class="headerlink" href="#step-3-create-userprofile-viewset" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># api/views.py</span>
<span class="c1"># Import viewsets for CRUD operations</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework</span><span class="w"> </span><span class="kn">import</span> <span class="n">viewsets</span>
<span class="c1"># Import permission class - users must be authenticated</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework.permissions</span><span class="w"> </span><span class="kn">import</span> <span class="n">IsAuthenticated</span>
<span class="c1"># Import models and serializers</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">UserProfile</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.serializers</span><span class="w"> </span><span class="kn">import</span> <span class="n">UserProfileSerializer</span>

<span class="c1"># ViewSet provides all CRUD operations automatically</span>
<span class="k">class</span><span class="w"> </span><span class="nc">UserProfileViewSet</span><span class="p">(</span><span class="n">viewsets</span><span class="o">.</span><span class="n">ModelViewSet</span><span class="p">):</span>
    <span class="c1"># Serializer converts UserProfile objects to/from JSON</span>
    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">UserProfileSerializer</span>

    <span class="c1"># Permission: Only authenticated users can access</span>
    <span class="c1"># Unauthenticated requests will get 401 Unauthorized</span>
    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">IsAuthenticated</span><span class="p">]</span>

    <span class="c1"># Override get_queryset to filter profiles by user</span>
    <span class="c1"># This ensures users only see their own profile</span>
    <span class="c1"># Called for list and retrieve operations</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Filter profiles where user matches the current logged-in user</span>
        <span class="c1"># self.request.user is automatically set by authentication</span>
        <span class="k">return</span> <span class="n">UserProfile</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>

    <span class="c1"># Override perform_create to automatically set the user</span>
    <span class="c1"># This is called when a new profile is created via POST</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">perform_create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">serializer</span><span class="p">):</span>
        <span class="c1"># Set user to the currently logged-in user</span>
        <span class="c1"># self.request.user is automatically set by authentication</span>
        <span class="n">serializer</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
</code></pre></div>

<h2 id="throttling">Throttling<a class="headerlink" href="#throttling" title="Permanent link">&para;</a></h2>
<h3 id="what-is-throttling">What is Throttling?<a class="headerlink" href="#what-is-throttling" title="Permanent link">&para;</a></h3>
<p><strong>Throttling</strong> is similar to permissions, in that it determines if a request should be authorized. However, throttles indicate a <strong>temporary state</strong>, and are used to control the <strong>rate of requests</strong> that clients can make to an API.</p>
<p><strong>Why Throttling?</strong>
- <strong>Rate limiting</strong>: Prevent API abuse and overuse
- <strong>Resource protection</strong>: Protect server resources from being overwhelmed
- <strong>Fair usage</strong>: Ensure fair distribution of API access
- <strong>Cost control</strong>: Limit expensive operations
- <strong>Business tiers</strong>: Implement different rate limits for different user tiers</p>
<p><strong>Real-world analogy</strong>:
- <strong>No throttling</strong> = Unlimited free samples (everyone takes everything)
- <strong>With throttling</strong> = Limited samples per person (fair distribution)</p>
<p><strong>Important Security Note</strong>: 
The application-level throttling that REST framework provides should <strong>not</strong> be considered a security measure or protection against brute forcing or denial-of-service attacks. Deliberately malicious actors will always be able to spoof IP origins. The built-in throttling implementations use Django's cache framework and non-atomic operations, which may sometimes result in some fuzziness.</p>
<p><strong>The application-level throttling provided by REST framework is intended for:</strong>
- Implementing policies such as different business tiers
- Basic protections against service over-use
- Fair usage policies</p>
<h3 id="how-throttling-is-determined">How Throttling is Determined<a class="headerlink" href="#how-throttling-is-determined" title="Permanent link">&para;</a></h3>
<p>As with permissions and authentication, throttling in REST framework is always defined as a <strong>list of classes</strong>.</p>
<p><strong>The Process</strong>:
1. Before running the main body of the view, each throttle in the list is checked
2. If any throttle check fails, an <code>exceptions.Throttled</code> exception will be raised
3. The main body of the view will not run
4. A <code>429 Too Many Requests</code> response is returned</p>
<p><strong>Why multiple throttles?</strong>
- Different limits for authenticated vs unauthenticated users
- Different constraints on different parts of the API
- Both burst throttling rates and sustained throttling rates
- Example: Limit user to 60 requests per minute AND 1000 requests per day</p>
<h3 id="setting-the-throttling-policy">Setting the Throttling Policy<a class="headerlink" href="#setting-the-throttling-policy" title="Permanent link">&para;</a></h3>
<h4 id="global-throttling-policy">Global Throttling Policy<a class="headerlink" href="#global-throttling-policy" title="Permanent link">&para;</a></h4>
<p>Set default throttling policy globally using <code>DEFAULT_THROTTLE_CLASSES</code> and <code>DEFAULT_THROTTLE_RATES</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># core/settings.py</span>
<span class="c1"># DRF configuration - applies to all views unless overridden</span>
<span class="n">REST_FRAMEWORK</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># Throttle classes to use globally (applies to all views)</span>
    <span class="c1"># DRF will check all throttles - if any fails, request is throttled</span>
    <span class="s1">&#39;DEFAULT_THROTTLE_CLASSES&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="c1"># AnonRateThrottle: Throttles unauthenticated users by IP address</span>
        <span class="s1">&#39;rest_framework.throttling.AnonRateThrottle&#39;</span><span class="p">,</span>
        <span class="c1"># UserRateThrottle: Throttles authenticated users by user ID</span>
        <span class="s1">&#39;rest_framework.throttling.UserRateThrottle&#39;</span>
    <span class="p">],</span>
    <span class="c1"># Rate limits for each throttle class</span>
    <span class="c1"># Keys must match the &#39;scope&#39; of throttle classes</span>
    <span class="s1">&#39;DEFAULT_THROTTLE_RATES&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="c1"># &#39;anon&#39; = scope for AnonRateThrottle</span>
        <span class="c1"># 100 requests per hour for anonymous (unauthenticated) users</span>
        <span class="s1">&#39;anon&#39;</span><span class="p">:</span> <span class="s1">&#39;100/hour&#39;</span><span class="p">,</span>
        <span class="c1"># &#39;user&#39; = scope for UserRateThrottle</span>
        <span class="c1"># 1000 requests per hour for authenticated users</span>
        <span class="s1">&#39;user&#39;</span><span class="p">:</span> <span class="s1">&#39;1000/hour&#39;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Rate Format</strong>:
- The rates can be specified over a period of second, minute, hour or day
- The period must be specified after the <code>/</code> separator using <code>s</code>, <code>m</code>, <code>h</code> or <code>d</code>
- Examples: <code>'100/second'</code>, <code>'60/minute'</code>, <code>'1000/hour'</code>, <code>'10000/day'</code>
- Extended units are also allowed: <code>'second'</code>, <code>'minute'</code>, <code>'hour'</code>, <code>'day'</code>
- Abbreviations work too: <code>'sec'</code>, <code>'min'</code>, <code>'hr'</code> (only first character matters)</p>
<h4 id="per-view-throttling">Per-View Throttling<a class="headerlink" href="#per-view-throttling" title="Permanent link">&para;</a></h4>
<p>Set throttling policy on a per-view basis using <code>APIView</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># api/views.py</span>
<span class="c1"># Import Response to return JSON responses</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework.response</span><span class="w"> </span><span class="kn">import</span> <span class="n">Response</span>
<span class="c1"># Import throttle class</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework.throttling</span><span class="w"> </span><span class="kn">import</span> <span class="n">UserRateThrottle</span>
<span class="c1"># Import APIView for class-based views</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework.views</span><span class="w"> </span><span class="kn">import</span> <span class="n">APIView</span>

<span class="c1"># APIView provides basic view functionality</span>
<span class="c1"># Use this when you need custom logic (not using ViewSet)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ExampleView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
    <span class="c1"># Set throttle classes for this specific view</span>
    <span class="c1"># This overrides DEFAULT_THROTTLE_CLASSES from settings</span>
    <span class="c1"># UserRateThrottle will limit requests per user</span>
    <span class="n">throttle_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">UserRateThrottle</span><span class="p">]</span>

    <span class="c1"># Handle GET requests</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># Return simple response</span>
        <span class="n">content</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;request was permitted&#39;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</code></pre></div>

<h4 id="per-viewset-throttling">Per-ViewSet Throttling<a class="headerlink" href="#per-viewset-throttling" title="Permanent link">&para;</a></h4>
<p>Set throttling policy on a per-viewset basis:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># api/views.py</span>
<span class="c1"># Import viewsets for CRUD operations</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework</span><span class="w"> </span><span class="kn">import</span> <span class="n">viewsets</span>
<span class="c1"># Import throttle class</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework.throttling</span><span class="w"> </span><span class="kn">import</span> <span class="n">UserRateThrottle</span>
<span class="c1"># Import models and serializers</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Book</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.serializers</span><span class="w"> </span><span class="kn">import</span> <span class="n">BookSerializer</span>

<span class="c1"># ModelViewSet provides all CRUD operations automatically</span>
<span class="k">class</span><span class="w"> </span><span class="nc">BookViewSet</span><span class="p">(</span><span class="n">viewsets</span><span class="o">.</span><span class="n">ModelViewSet</span><span class="p">):</span>
    <span class="c1"># Base queryset</span>
    <span class="n">queryset</span> <span class="o">=</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="c1"># Serializer for data conversion</span>
    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">BookSerializer</span>

    <span class="c1"># Set throttle classes for this ViewSet</span>
    <span class="c1"># Applies to all actions (list, create, retrieve, update, delete)</span>
    <span class="c1"># UserRateThrottle limits requests per authenticated user</span>
    <span class="n">throttle_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">UserRateThrottle</span><span class="p">]</span>
    <span class="c1"># ...</span>
</code></pre></div>

<h4 id="per-action-throttling">Per-Action Throttling<a class="headerlink" href="#per-action-throttling" title="Permanent link">&para;</a></h4>
<p>Set throttle classes for specific actions using the <code>@action</code> decorator:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># api/views.py</span>
<span class="c1"># Import viewsets for CRUD operations</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework</span><span class="w"> </span><span class="kn">import</span> <span class="n">viewsets</span>
<span class="c1"># Import @action decorator to create custom endpoints</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework.decorators</span><span class="w"> </span><span class="kn">import</span> <span class="n">action</span>
<span class="c1"># Import throttle class</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework.throttling</span><span class="w"> </span><span class="kn">import</span> <span class="n">UserRateThrottle</span>
<span class="c1"># Import Response to return JSON</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework.response</span><span class="w"> </span><span class="kn">import</span> <span class="n">Response</span>

<span class="k">class</span><span class="w"> </span><span class="nc">BookViewSet</span><span class="p">(</span><span class="n">viewsets</span><span class="o">.</span><span class="n">ModelViewSet</span><span class="p">):</span>
    <span class="c1"># ViewSet-level throttling (applies to all default actions)</span>
    <span class="c1"># This throttle applies to: list, create, retrieve, update, delete</span>
    <span class="n">throttle_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">UserRateThrottle</span><span class="p">]</span>

    <span class="c1"># @action decorator creates a custom endpoint</span>
    <span class="c1"># detail=True means it&#39;s for a specific book (POST /api/books/1/upload_cover/)</span>
    <span class="c1"># methods=[&quot;post&quot;] means only POST requests are allowed</span>
    <span class="c1"># throttle_classes overrides the viewset-level throttle for this action only</span>
    <span class="nd">@action</span><span class="p">(</span><span class="n">detail</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;post&quot;</span><span class="p">],</span> <span class="n">throttle_classes</span><span class="o">=</span><span class="p">[</span><span class="n">UserRateThrottle</span><span class="p">])</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">upload_cover</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># This is a custom action (not part of standard CRUD)</span>
        <span class="c1"># It has its own throttle class that overrides viewset-level throttle_classes</span>
        <span class="c1"># Useful when you want different rate limits for different actions</span>
        <span class="n">content</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;upload was permitted&#39;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</code></pre></div>

<p><strong>Note</strong>: Throttle classes set in <code>@action</code> decorator will override any viewset-level class settings.</p>
<h3 id="how-clients-are-identified">How Clients are Identified<a class="headerlink" href="#how-clients-are-identified" title="Permanent link">&para;</a></h3>
<p><strong>IP Address Identification</strong>:
- The <code>X-Forwarded-For</code> HTTP header and <code>REMOTE_ADDR</code> WSGI variable are used to uniquely identify client IP addresses
- If the <code>X-Forwarded-For</code> header is present, it will be used
- Otherwise, the value of the <code>REMOTE_ADDR</code> variable from the WSGI environment will be used</p>
<p><strong>NUM_PROXIES Setting</strong>:
If you need to strictly identify unique client IP addresses, configure the number of application proxies:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># core/settings.py</span>
<span class="n">REST_FRAMEWORK</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;NUM_PROXIES&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># Number of proxies in front of your application</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>How it works</strong>:
- If <code>NUM_PROXIES</code> is set to non-zero, the client IP will be identified as the last IP address in the <code>X-Forwarded-For</code> header, after excluding application proxy IP addresses
- If set to zero, the <code>REMOTE_ADDR</code> value will always be used</p>
<p><strong>Important</strong>: If you configure <code>NUM_PROXIES</code>, all clients behind a unique NAT'd gateway will be treated as a single client.</p>
<h3 id="setting-up-the-cache">Setting up the Cache<a class="headerlink" href="#setting-up-the-cache" title="Permanent link">&para;</a></h3>
<p><strong>Cache Backend Requirements</strong>:
- The throttle classes provided by REST framework use Django's cache backend
- You should make sure you've set appropriate cache settings
- The default value of <code>LocMemCache</code> backend should be okay for simple setups</p>
<p><strong>Custom Cache Backend</strong>:
If you need to use a cache other than <code>'default'</code>, create a custom throttle class:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># api/throttles.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.core.cache</span><span class="w"> </span><span class="kn">import</span> <span class="n">caches</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework.throttling</span><span class="w"> </span><span class="kn">import</span> <span class="n">AnonRateThrottle</span>

<span class="k">class</span><span class="w"> </span><span class="nc">CustomAnonRateThrottle</span><span class="p">(</span><span class="n">AnonRateThrottle</span><span class="p">):</span>
    <span class="n">cache</span> <span class="o">=</span> <span class="n">caches</span><span class="p">[</span><span class="s1">&#39;alternate&#39;</span><span class="p">]</span>  <span class="c1"># Use alternate cache backend</span>
</code></pre></div>

<p><strong>Remember</strong>: Set your custom throttle class in <code>'DEFAULT_THROTTLE_CLASSES'</code> settings key, or using the <code>throttle_classes</code> view attribute.</p>
<h3 id="a-note-on-concurrency">A Note on Concurrency<a class="headerlink" href="#a-note-on-concurrency" title="Permanent link">&para;</a></h3>
<p><strong>Race Conditions</strong>:
- The built-in throttle implementations are open to race conditions
- Under high concurrency, they may allow a few extra requests through
- This is due to non-atomic operations in the cache framework</p>
<p><strong>When to Implement Custom Throttles</strong>:
- If your project relies on guaranteeing the exact number of requests during concurrent requests
- If you need stricter rate limiting
- If you need custom throttling logic beyond what built-in throttles provide</p>
<p><strong>For production applications requiring strict rate limiting</strong>, consider implementing your own throttle class with atomic operations or using external rate limiting services.</p>
<h3 id="api-reference">API Reference<a class="headerlink" href="#api-reference" title="Permanent link">&para;</a></h3>
<h4 id="anonratethrottle">AnonRateThrottle<a class="headerlink" href="#anonratethrottle" title="Permanent link">&para;</a></h4>
<p><strong>What it does</strong>: The <code>AnonRateThrottle</code> will only ever throttle <strong>unauthenticated users</strong>. The IP address of the incoming request is used to generate a unique key to throttle against.</p>
<p><strong>How rate is determined</strong> (in order of preference):
1. The <code>rate</code> property on the class (if you override <code>AnonRateThrottle</code> and set the property)
2. The <code>DEFAULT_THROTTLE_RATES['anon']</code> setting</p>
<p><strong>When to use</strong>:
- Restrict the rate of requests from unknown sources
- Protect against anonymous abuse
- Encourage user registration</p>
<p><strong>Example</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># core/settings.py</span>
<span class="n">REST_FRAMEWORK</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;DEFAULT_THROTTLE_CLASSES&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s1">&#39;rest_framework.throttling.AnonRateThrottle&#39;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="s1">&#39;DEFAULT_THROTTLE_RATES&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;anon&#39;</span><span class="p">:</span> <span class="s1">&#39;100/hour&#39;</span><span class="p">,</span>  <span class="c1"># 100 requests per hour for anonymous users</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="userratethrottle">UserRateThrottle<a class="headerlink" href="#userratethrottle" title="Permanent link">&para;</a></h4>
<p><strong>What it does</strong>: The <code>UserRateThrottle</code> will throttle users to a given rate of requests across the API. The user id is used to generate a unique key to throttle against. Unauthenticated requests will fall back to using the IP address of the incoming request.</p>
<p><strong>How rate is determined</strong> (in order of preference):
1. The <code>rate</code> property on the class (if you override <code>UserRateThrottle</code> and set the property)
2. The <code>DEFAULT_THROTTLE_RATES['user']</code> setting</p>
<p><strong>When to use</strong>:
- Simple global rate restrictions per-user
- Fair usage policies
- Prevent individual users from overusing the API</p>
<p><strong>Example</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># core/settings.py</span>
<span class="n">REST_FRAMEWORK</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;DEFAULT_THROTTLE_CLASSES&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s1">&#39;rest_framework.throttling.UserRateThrottle&#39;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="s1">&#39;DEFAULT_THROTTLE_RATES&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;user&#39;</span><span class="p">:</span> <span class="s1">&#39;1000/hour&#39;</span><span class="p">,</span>  <span class="c1"># 1000 requests per hour for authenticated users</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Multiple User Throttles (Scoped Throttles)</strong>:
An API may have multiple <code>UserRateThrottles</code> in place at the same time. Override <code>UserRateThrottle</code> and set a unique "scope" for each class:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># api/throttles.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework.throttling</span><span class="w"> </span><span class="kn">import</span> <span class="n">UserRateThrottle</span>

<span class="k">class</span><span class="w"> </span><span class="nc">BurstRateThrottle</span><span class="p">(</span><span class="n">UserRateThrottle</span><span class="p">):</span>
    <span class="n">scope</span> <span class="o">=</span> <span class="s1">&#39;burst&#39;</span>

<span class="k">class</span><span class="w"> </span><span class="nc">SustainedRateThrottle</span><span class="p">(</span><span class="n">UserRateThrottle</span><span class="p">):</span>
    <span class="n">scope</span> <span class="o">=</span> <span class="s1">&#39;sustained&#39;</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1"># core/settings.py</span>
<span class="n">REST_FRAMEWORK</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;DEFAULT_THROTTLE_CLASSES&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s1">&#39;api.throttles.BurstRateThrottle&#39;</span><span class="p">,</span>
        <span class="s1">&#39;api.throttles.SustainedRateThrottle&#39;</span>
    <span class="p">],</span>
    <span class="s1">&#39;DEFAULT_THROTTLE_RATES&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;burst&#39;</span><span class="p">:</span> <span class="s1">&#39;60/min&#39;</span><span class="p">,</span>      <span class="c1"># 60 requests per minute</span>
        <span class="s1">&#39;sustained&#39;</span><span class="p">:</span> <span class="s1">&#39;1000/day&#39;</span>  <span class="c1"># 1000 requests per day</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>What this means</strong>:
- Users are limited to 60 requests per minute (burst limit)
- Users are also limited to 1000 requests per day (sustained limit)
- Both limits apply simultaneously
- Useful for preventing both short-term spikes and long-term overuse</p>
<h4 id="scopedratethrottle">ScopedRateThrottle<a class="headerlink" href="#scopedratethrottle" title="Permanent link">&para;</a></h4>
<p><strong>What it does</strong>: The <code>ScopedRateThrottle</code> class can be used to restrict access to <strong>specific parts of the API</strong>. This throttle will only be applied if the view that is being accessed includes a <code>.throttle_scope</code> property.</p>
<p><strong>How it works</strong>:
- The unique throttle key is formed by concatenating the "scope" of the request with the unique user id or IP address
- The allowed request rate is determined by the <code>DEFAULT_THROTTLE_RATES</code> setting using a key from the request "scope"</p>
<p><strong>When to use</strong>:
- Different rate limits for different API endpoints
- Protect resource-intensive endpoints
- Implement tiered access (e.g., read vs write operations)</p>
<p><strong>Example</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># api/views.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework.views</span><span class="w"> </span><span class="kn">import</span> <span class="n">APIView</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ContactListView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
    <span class="n">throttle_scope</span> <span class="o">=</span> <span class="s1">&#39;contacts&#39;</span>
    <span class="c1"># ...</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ContactDetailView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
    <span class="n">throttle_scope</span> <span class="o">=</span> <span class="s1">&#39;contacts&#39;</span>
    <span class="c1"># ...</span>

<span class="k">class</span><span class="w"> </span><span class="nc">UploadView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
    <span class="n">throttle_scope</span> <span class="o">=</span> <span class="s1">&#39;uploads&#39;</span>
    <span class="c1"># ...</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1"># core/settings.py</span>
<span class="n">REST_FRAMEWORK</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;DEFAULT_THROTTLE_CLASSES&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s1">&#39;rest_framework.throttling.ScopedRateThrottle&#39;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="s1">&#39;DEFAULT_THROTTLE_RATES&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;contacts&#39;</span><span class="p">:</span> <span class="s1">&#39;1000/day&#39;</span><span class="p">,</span>  <span class="c1"># 1000 requests per day for contact views</span>
        <span class="s1">&#39;uploads&#39;</span><span class="p">:</span> <span class="s1">&#39;20/day&#39;</span>       <span class="c1"># 20 requests per day for upload views</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>What this means</strong>:
- User requests to either <code>ContactListView</code> or <code>ContactDetailView</code> would be restricted to a total of 1000 requests per day
- User requests to <code>UploadView</code> would be restricted to 20 requests per day
- Different scopes allow different rate limits for different parts of your API</p>
<h3 id="custom-throttles">Custom Throttles<a class="headerlink" href="#custom-throttles" title="Permanent link">&para;</a></h3>
<p><strong>Creating Custom Throttles</strong>:
To create a custom throttle, override <code>BaseThrottle</code> and implement <code>.allow_request(self, request, view)</code>. The method should return <code>True</code> if the request should be allowed, and <code>False</code> otherwise.</p>
<p><strong>Optional <code>.wait()</code> Method</strong>:
You may also override the <code>.wait()</code> method. If implemented, <code>.wait()</code> should return a recommended number of seconds to wait before attempting the next request, or <code>None</code>. The <code>.wait()</code> method will only be called if <code>.allow_request()</code> has previously returned <code>False</code>.</p>
<p><strong>Retry-After Header</strong>:
If the <code>.wait()</code> method is implemented and the request is throttled, then a <code>Retry-After</code> header will be included in the response, telling the client how long to wait.</p>
<p><strong>Example 1: Random Rate Throttle</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># api/throttles.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework</span><span class="w"> </span><span class="kn">import</span> <span class="n">throttling</span>

<span class="k">class</span><span class="w"> </span><span class="nc">RandomRateThrottle</span><span class="p">(</span><span class="n">throttling</span><span class="o">.</span><span class="n">BaseThrottle</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Randomly throttle 1 in every 10 requests.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">allow_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">view</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span>
</code></pre></div>

<p><strong>Example 2: Custom Throttle with Wait Time</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># api/throttles.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework</span><span class="w"> </span><span class="kn">import</span> <span class="n">throttling</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.core.cache</span><span class="w"> </span><span class="kn">import</span> <span class="n">cache</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">timezone</span>

<span class="k">class</span><span class="w"> </span><span class="nc">CustomRateThrottle</span><span class="p">(</span><span class="n">throttling</span><span class="o">.</span><span class="n">BaseThrottle</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Custom throttle that limits to 10 requests per minute per IP.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">allow_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">view</span><span class="p">):</span>
        <span class="c1"># Get client IP</span>
        <span class="n">ip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ident</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

        <span class="c1"># Create cache key</span>
        <span class="n">cache_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;throttle_</span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="s1">&#39;</span>

        <span class="c1"># Get current request count</span>
        <span class="n">request_count</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cache_key</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Check if limit exceeded</span>
        <span class="k">if</span> <span class="n">request_count</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Increment count</span>
        <span class="n">cache</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">cache_key</span><span class="p">,</span> <span class="n">request_count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>  <span class="c1"># Expire in 60 seconds</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">wait</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return number of seconds to wait before next request.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="mi">60</span>  <span class="c1"># Wait 60 seconds</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_ident</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Identify the client by IP address.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x_forwarded_for</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">META</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;HTTP_X_FORWARDED_FOR&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">x_forwarded_for</span><span class="p">:</span>
            <span class="n">ip</span> <span class="o">=</span> <span class="n">x_forwarded_for</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ip</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">META</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;REMOTE_ADDR&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ip</span>
</code></pre></div>

<p><strong>Usage</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># api/views.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework</span><span class="w"> </span><span class="kn">import</span> <span class="n">viewsets</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.throttles</span><span class="w"> </span><span class="kn">import</span> <span class="n">CustomRateThrottle</span>

<span class="k">class</span><span class="w"> </span><span class="nc">BookViewSet</span><span class="p">(</span><span class="n">viewsets</span><span class="o">.</span><span class="n">ModelViewSet</span><span class="p">):</span>
    <span class="n">throttle_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">CustomRateThrottle</span><span class="p">]</span>
    <span class="c1"># ...</span>
</code></pre></div>

<h3 id="custom-throttling-example">Custom Throttling Example<a class="headerlink" href="#custom-throttling-example" title="Permanent link">&para;</a></h3>
<p><strong>Per-Action Custom Throttle</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># api/throttles.py</span>
<span class="c1"># Import base throttle class</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework.throttling</span><span class="w"> </span><span class="kn">import</span> <span class="n">UserRateThrottle</span>

<span class="c1"># Custom throttle that limits book creation</span>
<span class="c1"># Inherits from UserRateThrottle (throttles per user)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">BookCreateThrottle</span><span class="p">(</span><span class="n">UserRateThrottle</span><span class="p">):</span>
    <span class="c1"># Set rate limit: 5 requests per day</span>
    <span class="c1"># Format: &#39;number/period&#39; where period is: second, minute, hour, day</span>
    <span class="n">rate</span> <span class="o">=</span> <span class="s1">&#39;5/day&#39;</span>  <span class="c1"># Limit book creation to 5 per day per user</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1"># api/views.py</span>
<span class="c1"># Import viewsets and custom throttle</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework</span><span class="w"> </span><span class="kn">import</span> <span class="n">viewsets</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.throttles</span><span class="w"> </span><span class="kn">import</span> <span class="n">BookCreateThrottle</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Book</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.serializers</span><span class="w"> </span><span class="kn">import</span> <span class="n">BookSerializer</span>

<span class="k">class</span><span class="w"> </span><span class="nc">BookViewSet</span><span class="p">(</span><span class="n">viewsets</span><span class="o">.</span><span class="n">ModelViewSet</span><span class="p">):</span>
    <span class="n">queryset</span> <span class="o">=</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">BookSerializer</span>

    <span class="c1"># Override get_throttles() to apply different throttles per action</span>
    <span class="c1"># This method is called by DRF to determine which throttles to check</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_throttles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Override to apply different throttles to different actions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># For create action (POST /api/books/), use strict throttle</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">action</span> <span class="o">==</span> <span class="s1">&#39;create&#39;</span><span class="p">:</span>
            <span class="c1"># Return list of throttle instances</span>
            <span class="c1"># BookCreateThrottle will limit to 5 books per day</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">BookCreateThrottle</span><span class="p">()]</span>

        <span class="c1"># For other actions (list, retrieve, update, delete), use default throttles</span>
        <span class="c1"># super().get_throttles() returns throttles from throttle_classes attribute</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_throttles</span><span class="p">()</span>
</code></pre></div>

<p><strong>Alternative: Using throttle_classes attribute</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># api/views.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework</span><span class="w"> </span><span class="kn">import</span> <span class="n">viewsets</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework.decorators</span><span class="w"> </span><span class="kn">import</span> <span class="n">action</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.throttles</span><span class="w"> </span><span class="kn">import</span> <span class="n">BookCreateThrottle</span>

<span class="k">class</span><span class="w"> </span><span class="nc">BookViewSet</span><span class="p">(</span><span class="n">viewsets</span><span class="o">.</span><span class="n">ModelViewSet</span><span class="p">):</span>
    <span class="n">throttle_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">UserRateThrottle</span><span class="p">]</span>  <span class="c1"># Default for all actions</span>

    <span class="nd">@action</span><span class="p">(</span><span class="n">detail</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;post&#39;</span><span class="p">],</span> <span class="n">throttle_classes</span><span class="o">=</span><span class="p">[</span><span class="n">BookCreateThrottle</span><span class="p">])</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">create_book</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="c1"># This action uses BookCreateThrottle</span>
        <span class="c1"># ...</span>
</code></pre></div>

<h2 id="exercises">Exercises<a class="headerlink" href="#exercises" title="Permanent link">&para;</a></h2>
<h3 id="exercise-1-complete-secure-book-api-authentication-permissions">Exercise 1: Complete Secure Book API (Authentication &amp; Permissions)<a class="headerlink" href="#exercise-1-complete-secure-book-api-authentication-permissions" title="Permanent link">&para;</a></h3>
<ol>
<li>Add owner field to Book model</li>
<li>Implement IsOwnerOrReadOnly permission class</li>
<li>Configure JWT authentication</li>
<li>Set up permissions (IsAuthenticatedOrReadOnly for public reading, IsOwnerOrReadOnly for editing)</li>
<li>Test all endpoints with cURL (create, read, update, delete with proper authentication)</li>
</ol>
<h3 id="exercise-2-userprofile-api">Exercise 2: UserProfile API<a class="headerlink" href="#exercise-2-userprofile-api" title="Permanent link">&para;</a></h3>
<ol>
<li>Create UserProfile model with OneToOne relationship to User</li>
<li>Create UserProfileSerializer and UserProfileViewSet</li>
<li>Allow users to view/edit only their own profile</li>
<li>Add authentication and permissions</li>
<li>Test with cURL</li>
</ol>
<h3 id="exercise-3-custom-throttling">Exercise 3: Custom Throttling<a class="headerlink" href="#exercise-3-custom-throttling" title="Permanent link">&para;</a></h3>
<ol>
<li>Create a custom throttle class that limits book creation to 5 per day per user</li>
<li>Apply the throttle to the BookViewSet's create action</li>
<li>Test throttling by making multiple requests</li>
<li>Verify that the 6th request returns 429 Too Many Requests</li>
</ol>
<h3 id="exercise-4-abstract-models">Exercise 4: Abstract Models<a class="headerlink" href="#exercise-4-abstract-models" title="Permanent link">&para;</a></h3>
<ol>
<li>Create a TimestampedModel abstract base class</li>
<li>Update your Task and Book models to inherit from TimestampedModel</li>
<li>Remove duplicate created_at and updated_at fields from models</li>
<li>Create and run migrations</li>
<li>Verify that timestamps still work correctly</li>
</ol>
<h2 id="common-errors-and-solutions">Common Errors and Solutions<a class="headerlink" href="#common-errors-and-solutions" title="Permanent link">&para;</a></h2>
<h3 id="error-1-rest_frameworkexceptionsauthenticationfailed-given-token-not-valid-for-any-token-type">Error 1: <code>rest_framework.exceptions.AuthenticationFailed: Given token not valid for any token type</code><a class="headerlink" href="#error-1-rest_frameworkexceptionsauthenticationfailed-given-token-not-valid-for-any-token-type" title="Permanent link">&para;</a></h3>
<p><strong>Error Message</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nx">rest_framework</span><span class="p">.</span><span class="nx">exceptions</span><span class="p">.</span><span class="nx">AuthenticationFailed</span><span class="p">:</span><span class="w"> </span><span class="nx">Given</span><span class="w"> </span><span class="nx">token</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="nx">valid</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">any</span><span class="w"> </span><span class="nx">token</span><span class="w"> </span><span class="k">type</span>
</code></pre></div>

<p><strong>Why This Happens</strong>:
- Token expired
- Invalid token format
- Token not sent correctly in header
- Wrong token type</p>
<p><strong>How to Fix</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Check token format</span>
<span class="c1"># Should be: Authorization: Bearer &lt;token&gt;</span>
<span class="c1"># NOT: Authorization: &lt;token&gt;</span>
<span class="c1"># NOT: Authorization: Token &lt;token&gt;</span>

<span class="c1"># Correct format</span>
curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>http://localhost:8000/api/tasks/

<span class="c1"># Get new token if expired</span>
curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:8000/api/token/<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{&quot;username&quot;: &quot;user&quot;, &quot;password&quot;: &quot;pass&quot;}&#39;</span>
</code></pre></div>

<p><strong>Prevention</strong>: 
- Always use <code>Bearer</code> prefix for JWT tokens
- Check token expiration
- Refresh token before it expires</p>
<hr />
<h3 id="error-2-rest_frameworkexceptionspermissiondenied-you-do-not-have-permission-to-perform-this-action">Error 2: <code>rest_framework.exceptions.PermissionDenied: You do not have permission to perform this action</code><a class="headerlink" href="#error-2-rest_frameworkexceptionspermissiondenied-you-do-not-have-permission-to-perform-this-action" title="Permanent link">&para;</a></h3>
<p><strong>Error Message</strong>:</p>
<div class="codehilite"><pre><span></span><code>rest_framework.exceptions.PermissionDenied: You do not have permission to perform this action
</code></pre></div>

<p><strong>Why This Happens</strong>:
- User not authenticated (no token/session)
- User authenticated but lacks required permissions
- Permission class too restrictive</p>
<p><strong>How to Fix</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Check if user is authenticated</span>
<span class="c1"># In view, check:</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.auth.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">AnonymousUser</span>

<span class="nb">print</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>  <span class="c1"># Should be User object, not AnonymousUser</span>
<span class="nb">print</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">)</span>  <span class="c1"># Should be True</span>

<span class="c1"># Check permissions</span>
<span class="c1"># Option 1: Make endpoint public (if appropriate)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework.permissions</span><span class="w"> </span><span class="kn">import</span> <span class="n">AllowAny</span>

<span class="k">class</span><span class="w"> </span><span class="nc">TaskViewSet</span><span class="p">(</span><span class="n">viewsets</span><span class="o">.</span><span class="n">ModelViewSet</span><span class="p">):</span>
    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">AllowAny</span><span class="p">]</span>  <span class="c1"># Anyone can access (rare for tasks)</span>

<span class="c1"># Option 2: Require authentication (most common for tasks)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework.permissions</span><span class="w"> </span><span class="kn">import</span> <span class="n">IsAuthenticated</span>

<span class="k">class</span><span class="w"> </span><span class="nc">TaskViewSet</span><span class="p">(</span><span class="n">viewsets</span><span class="o">.</span><span class="n">ModelViewSet</span><span class="p">):</span>
    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">IsAuthenticated</span><span class="p">]</span>  <span class="c1"># Must be logged in</span>

<span class="c1"># Option 3: Custom permission check in class-based view</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework.views</span><span class="w"> </span><span class="kn">import</span> <span class="n">APIView</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework.response</span><span class="w"> </span><span class="kn">import</span> <span class="n">Response</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework</span><span class="w"> </span><span class="kn">import</span> <span class="n">status</span>

<span class="k">class</span><span class="w"> </span><span class="nc">TaskAPIView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">IsAuthenticated</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">patch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">pk</span><span class="p">):</span>
        <span class="c1"># Check custom permission</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">has_perm</span><span class="p">(</span><span class="s1">&#39;api.change_task&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">Response</span><span class="p">(</span>
                <span class="p">{</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Permission denied&#39;</span><span class="p">},</span> 
                <span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_403_FORBIDDEN</span>
            <span class="p">)</span>
        <span class="c1"># ... rest of logic</span>
</code></pre></div>

<p><strong>Prevention</strong>: 
- Check permission classes in view
- Verify user is authenticated before accessing protected endpoints
- Test with different user roles</p>
<hr />
<h3 id="error-3-djangocontribauthmodelsuserdoesnotexist-user-matching-query-does-not-exist">Error 3: <code>django.contrib.auth.models.User.DoesNotExist: User matching query does not exist</code><a class="headerlink" href="#error-3-djangocontribauthmodelsuserdoesnotexist-user-matching-query-does-not-exist" title="Permanent link">&para;</a></h3>
<p><strong>Error Message</strong>:</p>
<div class="codehilite"><pre><span></span><code>django.contrib.auth.models.User.DoesNotExist: User matching query does not exist
</code></pre></div>

<p><strong>Why This Happens</strong>:
- Trying to get user that doesn't exist
- User ID in token doesn't match any user
- User was deleted but token still valid</p>
<p><strong>How to Fix</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Option 1: Check if user exists</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">user_id</span><span class="p">)</span>
<span class="k">except</span> <span class="n">User</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">Response</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;User not found&#39;</span><span class="p">},</span> <span class="n">status</span><span class="o">=</span><span class="mi">404</span><span class="p">)</span>

<span class="c1"># Option 2: Use get_object_or_404</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.shortcuts</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_object_or_404</span>
<span class="n">user</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">user_id</span><span class="p">)</span>

<span class="c1"># Option 3: Handle in JWT token validation</span>
<span class="c1"># In custom token serializer, verify user exists</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrs</span><span class="p">):</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">authenticate</span><span class="p">(</span><span class="o">**</span><span class="n">attrs</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">user</span><span class="o">.</span><span class="n">is_active</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">serializers</span><span class="o">.</span><span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;User not found or inactive&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">attrs</span>
</code></pre></div>

<p><strong>Prevention</strong>: Always verify user exists before using, especially in token validation.</p>
<hr />
<h3 id="error-4-rest_frameworkexceptionsvalidationerror-refresh-this-field-is-required">Error 4: <code>rest_framework.exceptions.ValidationError: {'refresh': ['This field is required.']}</code><a class="headerlink" href="#error-4-rest_frameworkexceptionsvalidationerror-refresh-this-field-is-required" title="Permanent link">&para;</a></h3>
<p><strong>Error Message</strong>:</p>
<div class="codehilite"><pre><span></span><code>rest_framework.exceptions.ValidationError: {&#39;refresh&#39;: [&#39;This field is required.&#39;]}
</code></pre></div>

<p><strong>Why This Happens</strong>:
- Trying to refresh token without providing refresh token
- Sending access token instead of refresh token
- Missing refresh token in request</p>
<p><strong>How to Fix</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># WRONG - Using access token</span>
curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:8000/api/token/refresh/<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{&quot;refresh&quot;: &quot;access_token_here&quot;}&#39;</span><span class="w">  </span><span class="c1"># ❌ Wrong token type</span>

<span class="c1"># CORRECT - Use refresh token</span>
curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:8000/api/token/refresh/<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{&quot;refresh&quot;: &quot;refresh_token_here&quot;}&#39;</span><span class="w">  </span><span class="c1"># ✅ Correct</span>

<span class="c1"># Get tokens first</span>
<span class="nv">TOKENS</span><span class="o">=</span><span class="k">$(</span>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:8000/api/token/<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{&quot;username&quot;: &quot;user&quot;, &quot;password&quot;: &quot;pass&quot;}&#39;</span><span class="k">)</span>

<span class="c1"># Extract refresh token</span>
<span class="nv">REFRESH</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="nv">$TOKENS</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>-r<span class="w"> </span><span class="s1">&#39;.refresh&#39;</span><span class="k">)</span>

<span class="c1"># Use refresh token</span>
curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:8000/api/token/refresh/<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s2">&quot;{\&quot;refresh\&quot;: \&quot;</span><span class="nv">$REFRESH</span><span class="s2">\&quot;}&quot;</span>
</code></pre></div>

<p><strong>Prevention</strong>: 
- Store both access and refresh tokens
- Use refresh token only for refreshing
- Don't confuse access and refresh tokens</p>
<hr />
<h3 id="error-5-djangodbutilsintegrityerror-not-null-constraint-failed-api_taskowner_id">Error 5: <code>django.db.utils.IntegrityError: NOT NULL constraint failed: api_task.owner_id</code><a class="headerlink" href="#error-5-djangodbutilsintegrityerror-not-null-constraint-failed-api_taskowner_id" title="Permanent link">&para;</a></h3>
<p><strong>Error Message</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="n">django</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">IntegrityError</span><span class="p">:</span><span class="w"> </span><span class="n">NOT</span><span class="w"> </span><span class="n">NULL</span><span class="w"> </span><span class="n">constraint</span><span class="w"> </span><span class="n">failed</span><span class="p">:</span><span class="w"> </span><span class="n">api_task</span><span class="o">.</span><span class="n">owner_id</span>
</code></pre></div>

<p><strong>Why This Happens</strong>:
- Trying to create object without required ForeignKey
- Owner not set in serializer
- <code>perform_create</code> not setting owner</p>
<p><strong>How to Fix</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># WRONG - Owner not set</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TaskViewSet</span><span class="p">(</span><span class="n">viewsets</span><span class="o">.</span><span class="n">ModelViewSet</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">serializer</span> <span class="o">=</span> <span class="n">TaskSerializer</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="n">serializer</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>  <span class="c1"># ❌ Owner not set!</span>

<span class="c1"># CORRECT - Set owner in perform_create</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TaskViewSet</span><span class="p">(</span><span class="n">viewsets</span><span class="o">.</span><span class="n">ModelViewSet</span><span class="p">):</span>
    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">TaskSerializer</span>
    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">IsAuthenticated</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">perform_create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">serializer</span><span class="p">):</span>
        <span class="n">serializer</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">owner</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>  <span class="c1"># ✅ Owner set automatically</span>

<span class="c1"># Alternative: Set owner in serializer</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TaskSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">validated_data</span><span class="p">):</span>
        <span class="n">validated_data</span><span class="p">[</span><span class="s1">&#39;owner&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s1">&#39;request&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">user</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">validated_data</span><span class="p">)</span>
</code></pre></div>

<p><strong>Prevention</strong>: Always set owner in <code>perform_create</code> or serializer's <code>create</code> method.</p>
<hr />
<h3 id="general-debugging-tips-for-level-2a">General Debugging Tips for Level 2A<a class="headerlink" href="#general-debugging-tips-for-level-2a" title="Permanent link">&para;</a></h3>
<p><strong>1. Check Authentication</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># In view, verify authentication</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.auth.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">AnonymousUser</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;User:&quot;</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Authenticated:&quot;</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Is anonymous:&quot;</span><span class="p">,</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="n">AnonymousUser</span><span class="p">))</span>
</code></pre></div>

<p><strong>2. Test Permissions</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Check what permissions user has</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Permissions:&quot;</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">get_all_permissions</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Is staff:&quot;</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_staff</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Is superuser:&quot;</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_superuser</span><span class="p">)</span>
</code></pre></div>

<p><strong>3. Verify Token</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Decode JWT token to see contents</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework_simplejwt.tokens</span><span class="w"> </span><span class="kn">import</span> <span class="n">AccessToken</span>

<span class="n">token</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">META</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;HTTP_AUTHORIZATION&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">decoded</span> <span class="o">=</span> <span class="n">AccessToken</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Token payload:&quot;</span><span class="p">,</span> <span class="n">decoded</span><span class="o">.</span><span class="n">payload</span><span class="p">)</span>
</code></pre></div>

<p><strong>4. Common Authentication Issues</strong>
- <strong>Token expired</strong>: Get new token or refresh
- <strong>Wrong header format</strong>: Use <code>Authorization: Bearer &lt;token&gt;</code>
- <strong>Token not sent</strong>: Check request headers
- <strong>User inactive</strong>: Check <code>user.is_active</code></p>
<p><strong>5. Common Permission Issues</strong>
- <strong>Too restrictive</strong>: Check permission classes
- <strong>User not authenticated</strong>: Verify token/session
- <strong>Wrong user</strong>: Check if user owns resource
- <strong>Missing permission</strong>: Verify user has required permission</p>
<h2 id="next-steps">Next Steps<a class="headerlink" href="#next-steps" title="Permanent link">&para;</a></h2>
<p>Congratulations! You've completed Level 2A. You now know:</p>
<ul>
<li>✅ Django authentication system</li>
<li>✅ Django Abstract Models</li>
<li>✅ JWT authentication setup</li>
<li>✅ Permissions (built-in and custom)</li>
<li>✅ Throttling and rate limiting</li>
<li>✅ Building secure APIs with authentication</li>
</ul>
<p><strong>Ready for Level 2B?</strong> Continue to <a href="LEVEL_2B_INTERMEDIATE.html">Level 2B: Intermediate - Filtering, Searching &amp; Advanced Features</a> to learn about filtering, searching, ordering, pagination, exception handling, and testing!</p>
<hr />
<p><strong>Resources:</strong>
- <a href="https://www.django-rest-framework.org/api-guide/authentication/">DRF Authentication</a>
- <a href="https://www.django-rest-framework.org/api-guide/permissions/">DRF Permissions</a>
- <a href="https://github.com/jazzband/djangorestframework-simplejwt">djangorestframework-simplejwt</a></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": ".", "features": ["navigation.sections", "navigation.expand", "navigation.instant", "toc.integrate", "content.code.copy"], "search": "assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.e71a0d61.min.js"></script>
      
    
  </body>
</html>
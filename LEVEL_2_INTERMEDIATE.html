
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://pragnakalpdev54.github.io/DRF/LEVEL_2_INTERMEDIATE.html">
      
      
        <link rel="prev" href="LEVEL_1_FOUNDATIONS.html">
      
      
        <link rel="next" href="LEVEL_3_ADVANCED.html">
      
      
        
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>Level 2 - Intermediate - DRF Training Guide</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.618322db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#level-2-intermediate-authentication-permissions-querysets" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="DRF Training Guide" class="md-header__button md-logo" aria-label="DRF Training Guide" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            DRF Training Guide
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Level 2 - Intermediate
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="DRF Training Guide" class="md-nav__button md-logo" aria-label="DRF Training Guide" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    DRF Training Guide
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Course Levels
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Course Levels
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="LEVEL_0_BEGINNER.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Level 0 - Beginner
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="LEVEL_1_FOUNDATIONS.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Level 1 - Foundations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Level 2 - Intermediate
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="LEVEL_2_INTERMEDIATE.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Level 2 - Intermediate
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#goal" class="md-nav__link">
    <span class="md-ellipsis">
      
        Goal
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#note-on-examples" class="md-nav__link">
    <span class="md-ellipsis">
      
        Note on Examples
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#class-based-views-cbv-approach" class="md-nav__link">
    <span class="md-ellipsis">
      
        Class-Based Views (CBV) Approach
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-of-contents" class="md-nav__link">
    <span class="md-ellipsis">
      
        Table of Contents
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#django-authentication-system" class="md-nav__link">
    <span class="md-ellipsis">
      
        Django Authentication System
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Django Authentication System">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#why-authentication" class="md-nav__link">
    <span class="md-ellipsis">
      
        Why Authentication?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#understanding-django-users" class="md-nav__link">
    <span class="md-ellipsis">
      
        Understanding Django Users
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-users" class="md-nav__link">
    <span class="md-ellipsis">
      
        Creating Users
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-user-model" class="md-nav__link">
    <span class="md-ellipsis">
      
        Custom User Model
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#drf-authentication-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        DRF Authentication Classes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DRF Authentication Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#authentication-vs-authorization" class="md-nav__link">
    <span class="md-ellipsis">
      
        Authentication vs Authorization
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#drf-authentication-types" class="md-nav__link">
    <span class="md-ellipsis">
      
        DRF Authentication Types
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DRF Authentication Types">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-session-authentication" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Session Authentication
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-token-authentication" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Token Authentication
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-jwt-authentication-recommended" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. JWT Authentication (Recommended)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#jwt-authentication-setup" class="md-nav__link">
    <span class="md-ellipsis">
      
        JWT Authentication Setup
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="JWT Authentication Setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-install-package" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 1: Install Package
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-add-to-installed_apps" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 2: Add to INSTALLED_APPS
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-configure-jwt-settings" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 3: Configure JWT Settings
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-5-create-user-registration-view" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 5: Create User Registration View
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-6-test-jwt-authentication" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 6: Test JWT Authentication
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#permissions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Permissions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Permissions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-are-permissions" class="md-nav__link">
    <span class="md-ellipsis">
      
        What are Permissions?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#built-in-permission-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Built-in Permission Classes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Built-in Permission Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-allowany" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. AllowAny
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-isauthenticated" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. IsAuthenticated
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-isadminuser" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. IsAdminUser
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-isauthenticatedorreadonly" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. IsAuthenticatedOrReadOnly
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-permissions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Custom Permissions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Custom Permissions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#isownerorreadonly" class="md-nav__link">
    <span class="md-ellipsis">
      
        IsOwnerOrReadOnly
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#permission-at-view-level" class="md-nav__link">
    <span class="md-ellipsis">
      
        Permission at View Level
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#filtering" class="md-nav__link">
    <span class="md-ellipsis">
      
        Filtering
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Filtering">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-is-filtering" class="md-nav__link">
    <span class="md-ellipsis">
      
        What is Filtering?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-django-filter" class="md-nav__link">
    <span class="md-ellipsis">
      
        Install django-filter
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-in-settingspy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configure in settings.py
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#basic-filtering" class="md-nav__link">
    <span class="md-ellipsis">
      
        Basic Filtering
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#advanced-filtering-with-filterset" class="md-nav__link">
    <span class="md-ellipsis">
      
        Advanced Filtering with FilterSet
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#searching" class="md-nav__link">
    <span class="md-ellipsis">
      
        Searching
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Searching">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-is-searching" class="md-nav__link">
    <span class="md-ellipsis">
      
        What is Searching?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#searchfilter" class="md-nav__link">
    <span class="md-ellipsis">
      
        SearchFilter
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#search-lookup-expressions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Search Lookup Expressions
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ordering" class="md-nav__link">
    <span class="md-ellipsis">
      
        Ordering
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Ordering">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-is-ordering" class="md-nav__link">
    <span class="md-ellipsis">
      
        What is Ordering?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#orderingfilter" class="md-nav__link">
    <span class="md-ellipsis">
      
        OrderingFilter
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pagination" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pagination
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pagination">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-is-pagination" class="md-nav__link">
    <span class="md-ellipsis">
      
        What is Pagination?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pagenumberpagination" class="md-nav__link">
    <span class="md-ellipsis">
      
        PageNumberPagination
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#limitoffsetpagination" class="md-nav__link">
    <span class="md-ellipsis">
      
        LimitOffsetPagination
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cursorpagination" class="md-nav__link">
    <span class="md-ellipsis">
      
        CursorPagination
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-by-step-secure-book-api" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step-by-Step: Secure Book API
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step-by-Step: Secure Book API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-update-book-model" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 1: Update Book Model
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-update-book-serializer" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 2: Update Book Serializer
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-create-filter" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 3: Create Filter
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-4-update-book-viewset" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 4: Update Book ViewSet
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-5-test-secure-book-api" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 5: Test Secure Book API
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-by-step-secure-task-api" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step-by-Step: Secure Task API
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step-by-Step: Secure Task API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-update-task-model" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 1: Update Task Model
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-update-task-serializer" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 2: Update Task Serializer
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-create-task-filter" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 3: Create Task Filter
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-4-update-task-viewset" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 4: Update Task ViewSet
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-5-test-secure-task-api" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 5: Test Secure Task API
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#userprofile-api" class="md-nav__link">
    <span class="md-ellipsis">
      
        UserProfile API
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="UserProfile API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-create-userprofile-model" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 1: Create UserProfile Model
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-create-userprofile-serializer" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 2: Create UserProfile Serializer
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-create-userprofile-viewset" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 3: Create UserProfile ViewSet
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#throttling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Throttling
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Throttling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configure-throttling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configure Throttling
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-throttling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Custom Throttling
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exception-handling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exception Handling
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Exception Handling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-is-exception-handling" class="md-nav__link">
    <span class="md-ellipsis">
      
        What is Exception Handling?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#basic-exception-handler" class="md-nav__link">
    <span class="md-ellipsis">
      
        Basic Exception Handler
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handling-authentication-errors" class="md-nav__link">
    <span class="md-ellipsis">
      
        Handling Authentication Errors
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handling-validation-errors" class="md-nav__link">
    <span class="md-ellipsis">
      
        Handling Validation Errors
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handling-jwt-token-errors" class="md-nav__link">
    <span class="md-ellipsis">
      
        Handling JWT Token Errors
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#production-vs-development-error-messages" class="md-nav__link">
    <span class="md-ellipsis">
      
        Production vs Development Error Messages
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#complete-example" class="md-nav__link">
    <span class="md-ellipsis">
      
        Complete Example
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-response-format" class="md-nav__link">
    <span class="md-ellipsis">
      
        Error Response Format
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing-exception-handler" class="md-nav__link">
    <span class="md-ellipsis">
      
        Testing Exception Handler
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      
        Best Practices
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-authenticated-apis" class="md-nav__link">
    <span class="md-ellipsis">
      
        Testing Authenticated APIs
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercises" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exercises
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Exercises">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercise-1-complete-secure-book-api" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exercise 1: Complete Secure Book API
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exercise-2-userprofile-api" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exercise 2: UserProfile API
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exercise-3-task-filtering" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exercise 3: Task Filtering
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#add-ons" class="md-nav__link">
    <span class="md-ellipsis">
      
        Add-ons
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Add-ons">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#add-on-1-custom-jwt-claims" class="md-nav__link">
    <span class="md-ellipsis">
      
        Add-on 1: Custom JWT Claims
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-on-2-rate-limiting" class="md-nav__link">
    <span class="md-ellipsis">
      
        Add-on 2: Rate Limiting
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-on-3-permission-mixins" class="md-nav__link">
    <span class="md-ellipsis">
      
        Add-on 3: Permission Mixins
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#common-errors-and-solutions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Common Errors and Solutions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Common Errors and Solutions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#error-1-rest_frameworkexceptionsauthenticationfailed-given-token-not-valid-for-any-token-type" class="md-nav__link">
    <span class="md-ellipsis">
      
        Error 1: rest_framework.exceptions.AuthenticationFailed: Given token not valid for any token type
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-2-rest_frameworkexceptionspermissiondenied-you-do-not-have-permission-to-perform-this-action" class="md-nav__link">
    <span class="md-ellipsis">
      
        Error 2: rest_framework.exceptions.PermissionDenied: You do not have permission to perform this action
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-3-djangocontribauthmodelsuserdoesnotexist-user-matching-query-does-not-exist" class="md-nav__link">
    <span class="md-ellipsis">
      
        Error 3: django.contrib.auth.models.User.DoesNotExist: User matching query does not exist
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-4-django_filtersexceptionsfieldlookuperror-unsupported-lookup-icontains-for-charfield" class="md-nav__link">
    <span class="md-ellipsis">
      
        Error 4: django_filters.exceptions.FieldLookupError: Unsupported lookup 'icontains' for CharField
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-5-rest_frameworkexceptionsvalidationerror-refresh-this-field-is-required" class="md-nav__link">
    <span class="md-ellipsis">
      
        Error 5: rest_framework.exceptions.ValidationError: {'refresh': ['This field is required.']}
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-6-djangocoreexceptionsfielderror-related-field-got-invalid-lookup-icontains" class="md-nav__link">
    <span class="md-ellipsis">
      
        Error 6: django.core.exceptions.FieldError: Related Field got invalid lookup: icontains
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-7-rest_frameworkexceptionsnotfound-invalid-page" class="md-nav__link">
    <span class="md-ellipsis">
      
        Error 7: rest_framework.exceptions.NotFound: Invalid page.
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-8-djangodbutilsintegrityerror-not-null-constraint-failed-api_taskowner_id" class="md-nav__link">
    <span class="md-ellipsis">
      
        Error 8: django.db.utils.IntegrityError: NOT NULL constraint failed: api_task.owner_id
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-9-rest_frameworkexceptionsmethodnotallowed-method-patch-not-allowed" class="md-nav__link">
    <span class="md-ellipsis">
      
        Error 9: rest_framework.exceptions.MethodNotAllowed: Method 'PATCH' not allowed
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-10-django_filtersexceptionsfielderror-metafields-contains-fields-that-are-not-defined-on-this-filterset" class="md-nav__link">
    <span class="md-ellipsis">
      
        Error 10: django_filters.exceptions.FieldError: Meta.fields contains fields that are not defined on this FilterSet
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#general-debugging-tips-for-level-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        General Debugging Tips for Level 2
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-steps" class="md-nav__link">
    <span class="md-ellipsis">
      
        Next Steps
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="LEVEL_3_ADVANCED.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Level 3 - Advanced
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="LEVEL_4_SCALABLE.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Level 4 - Scalable
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="LEVEL_5_EXPERT.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Level 5 - Expert
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Tools & Extras
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Tools & Extras
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="CURL_GUIDE.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    cURL Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="POSTGRESQL_SETUP.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    PostgreSQL Setup
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="level-2-intermediate-authentication-permissions-querysets">Level 2: Intermediate - Authentication, Permissions &amp; Querysets<a class="headerlink" href="#level-2-intermediate-authentication-permissions-querysets" title="Permanent link">&para;</a></h1>
<h2 id="goal">Goal<a class="headerlink" href="#goal" title="Permanent link">&para;</a></h2>
<p>Build secure APIs with robust authentication, permissions, filtering, searching, ordering, and pagination. By the end of this level, you'll be able to create production-ready, secure REST APIs.</p>
<h2 id="note-on-examples">Note on Examples<a class="headerlink" href="#note-on-examples" title="Permanent link">&para;</a></h2>
<p>This guide uses <strong>Task API</strong> as the primary example throughout explanation sections for consistency with Level 1. Complete step-by-step implementations are provided for both <strong>Task API</strong> (user-owned, private data) and <strong>Book API</strong> (can be public or user-owned) to show different use cases:</p>
<ul>
<li><strong>Task API examples</strong>: Used in explanations (permissions, filtering, searching, etc.) - represents private, user-owned data</li>
<li><strong>Book API examples</strong>: Used in complete step-by-step section - represents content that can be public or user-owned</li>
<li><strong>Both examples</strong>: Help you understand different scenarios and patterns</li>
</ul>
<p>You can apply all concepts to any model (Task, Book, Product, Post, etc.).</p>
<h2 id="class-based-views-cbv-approach">Class-Based Views (CBV) Approach<a class="headerlink" href="#class-based-views-cbv-approach" title="Permanent link">&para;</a></h2>
<p><strong>This guide follows the Class-Based Views (CBV) approach</strong> throughout, which is the recommended and modern way to build DRF APIs:</p>
<ul>
<li>✅ <strong>ViewSets</strong> (<code>ModelViewSet</code>, <code>ReadOnlyViewSet</code>) - For CRUD operations</li>
<li>✅ <strong>Generic Views</strong> (<code>CreateAPIView</code>, <code>ListAPIView</code>, etc.) - For specific operations</li>
<li>✅ <strong>APIView</strong> - For custom logic when needed</li>
<li>❌ <strong>Function-based views</strong> (<code>@api_view</code>) - Only used when absolutely necessary</li>
</ul>
<p><strong>Why Class-Based Views?</strong>
- <strong>Reusable</strong>: Easy to extend and customize
- <strong>DRY</strong>: Less code duplication
- <strong>Built-in features</strong>: Authentication, permissions, filtering work automatically
- <strong>Industry standard</strong>: Most DRF projects use CBV
- <strong>Better organization</strong>: Clear separation of concerns</p>
<p>All examples in this guide use class-based views unless explicitly noted otherwise.</p>
<h2 id="table-of-contents">Table of Contents<a class="headerlink" href="#table-of-contents" title="Permanent link">&para;</a></h2>
<ol>
<li><a href="#class-based-views-cbv-approach">Class-Based Views (CBV) Approach</a></li>
<li><a href="#django-authentication-system">Django Authentication System</a></li>
<li><a href="#drf-authentication-classes">DRF Authentication Classes</a></li>
<li><a href="#jwt-authentication-setup">JWT Authentication Setup</a></li>
<li><a href="#permissions">Permissions</a></li>
<li><a href="#filtering">Filtering</a></li>
<li><a href="#searching">Searching</a></li>
<li><a href="#ordering">Ordering</a></li>
<li><a href="#pagination">Pagination</a></li>
<li><a href="#step-by-step-secure-book-api">Step-by-Step: Secure Book API</a></li>
<li><a href="#step-by-step-secure-task-api">Step-by-Step: Secure Task API</a></li>
<li><a href="#userprofile-api">UserProfile API</a></li>
<li><a href="#throttling">Throttling</a></li>
<li><a href="#exception-handling">Exception Handling</a></li>
<li><a href="#testing-authenticated-apis">Testing Authenticated APIs</a></li>
<li><a href="#exercises">Exercises</a></li>
<li><a href="#common-errors-and-solutions">Common Errors and Solutions</a></li>
<li><a href="#add-ons">Add-ons</a></li>
</ol>
<h2 id="django-authentication-system">Django Authentication System<a class="headerlink" href="#django-authentication-system" title="Permanent link">&para;</a></h2>
<h3 id="why-authentication">Why Authentication?<a class="headerlink" href="#why-authentication" title="Permanent link">&para;</a></h3>
<p><strong>The Problem</strong>: Without authentication, anyone can access your API and modify data. This is a security risk!</p>
<p><strong>Real-world analogy</strong>: 
- <strong>No authentication</strong> = House with no locks (anyone can enter)
- <strong>With authentication</strong> = House with keys (only authorized people enter)</p>
<p><strong>Why it matters</strong>:
- <strong>Security</strong>: Protect user data
- <strong>Personalization</strong>: Show users only their data
- <strong>Accountability</strong>: Track who did what
- <strong>Access control</strong>: Limit what users can do</p>
<h3 id="understanding-django-users">Understanding Django Users<a class="headerlink" href="#understanding-django-users" title="Permanent link">&para;</a></h3>
<p>Django comes with a built-in User model that handles user accounts:</p>
<p><strong>What is a User model?</strong>
- Represents a person using your application
- Stores login credentials (username, password)
- Tracks user information (email, name)
- Manages permissions and access levels</p>
<p><strong>Why use Django's User model?</strong>
- <strong>Ready-made</strong>: No need to build from scratch
- <strong>Secure</strong>: Password hashing built-in
- <strong>Tested</strong>: Used by millions of applications
- <strong>Flexible</strong>: Can be extended for custom needs</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.auth.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">User</span>

<span class="c1"># User fields</span>
<span class="n">user</span><span class="o">.</span><span class="n">username</span>      <span class="c1"># Username</span>
<span class="n">user</span><span class="o">.</span><span class="n">email</span>         <span class="c1"># Email address</span>
<span class="n">user</span><span class="o">.</span><span class="n">password</span>      <span class="c1"># Hashed password (never access directly)</span>
<span class="n">user</span><span class="o">.</span><span class="n">first_name</span>    <span class="c1"># First name</span>
<span class="n">user</span><span class="o">.</span><span class="n">last_name</span>     <span class="c1"># Last name</span>
<span class="n">user</span><span class="o">.</span><span class="n">is_staff</span>      <span class="c1"># Admin access (can access Django admin)</span>
<span class="n">user</span><span class="o">.</span><span class="n">is_active</span>     <span class="c1"># Account status (False = disabled account)</span>
<span class="n">user</span><span class="o">.</span><span class="n">is_superuser</span>  <span class="c1"># Superuser (all permissions)</span>
<span class="n">user</span><span class="o">.</span><span class="n">date_joined</span>   <span class="c1"># When user account was created</span>
</code></pre></div>

<p><strong>Explanation of key fields</strong>:
- <strong><code>username</code></strong>: Unique identifier for login
- <strong><code>email</code></strong>: User's email address
- <strong><code>password</code></strong>: Stored as hash (never plain text)
- <strong><code>is_staff</code></strong>: Can access Django admin panel
- <strong><code>is_active</code></strong>: If False, user cannot login
- <strong><code>is_superuser</code></strong>: Has all permissions automatically</p>
<h3 id="creating-users">Creating Users<a class="headerlink" href="#creating-users" title="Permanent link">&para;</a></h3>
<p><strong>Why multiple methods?</strong>
- Different methods serve different purposes
- Some hash passwords (secure), others don't (insecure)
- Always use methods that hash passwords!</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># In Django shell: python manage.py shell</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.auth.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">User</span>

<span class="c1"># Method 1: create_user (recommended - hashes password)</span>
<span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span>
    <span class="n">username</span><span class="o">=</span><span class="s1">&#39;john&#39;</span><span class="p">,</span>
    <span class="n">email</span><span class="o">=</span><span class="s1">&#39;john@example.com&#39;</span><span class="p">,</span>
    <span class="n">password</span><span class="o">=</span><span class="s1">&#39;securepassword123&#39;</span>
<span class="p">)</span>
</code></pre></div>

<p><strong>Why <code>create_user</code>?</strong>
- <strong>Password hashing</strong>: Converts password to secure hash (can't be reversed)
- <strong>Validation</strong>: Checks username/email format
- <strong>Default values</strong>: Sets sensible defaults (is_active=True)
- <strong>Security</strong>: Never store plain text passwords!</p>
<p><strong>What is password hashing?</strong>
- Plain password: <code>"mypassword123"</code> ❌ (stored as-is, anyone can read)
- Hashed password: <code>"pbkdf2_sha256$..."</code> ✅ (one-way encryption, can't be reversed)
- When user logs in, Django hashes their input and compares with stored hash</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Method 2: create_superuser</span>
<span class="n">admin</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_superuser</span><span class="p">(</span>
    <span class="n">username</span><span class="o">=</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span>
    <span class="n">email</span><span class="o">=</span><span class="s1">&#39;admin@example.com&#39;</span><span class="p">,</span>
    <span class="n">password</span><span class="o">=</span><span class="s1">&#39;admin123&#39;</span>
<span class="p">)</span>
</code></pre></div>

<p><strong>Why <code>create_superuser</code>?</strong>
- Creates user with admin privileges (<code>is_staff=True</code>, <code>is_superuser=True</code>)
- Can access Django admin panel
- Has all permissions by default
- Use for site administrators</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Method 3: Using User.objects.create (not recommended - password not hashed)</span>
</code></pre></div>

<p><strong>Why NOT use <code>User.objects.create</code>?</strong>
- <strong>Security risk</strong>: Password stored in plain text!
- No validation
- No password hashing
- <strong>Never use this for passwords!</strong></p>
<h3 id="custom-user-model">Custom User Model<a class="headerlink" href="#custom-user-model" title="Permanent link">&para;</a></h3>
<p><strong>Why create a custom user model?</strong></p>
<p><strong>The Problem</strong>: Django's default User model has limited fields (username, email, password). What if you need:
- Phone numbers
- Profile pictures
- Bio/description
- Custom fields</p>
<p><strong>The Solution</strong>: Extend Django's User model with your own fields.</p>
<p><strong>When to use custom user model?</strong>
- <strong>Production apps</strong>: Almost always
- <strong>Need extra fields</strong>: Phone, avatar, bio, etc.
- <strong>Different login</strong>: Email instead of username
- <strong>Before first migration</strong>: Must set before creating database</p>
<p><strong>Why before first migration?</strong>
- Changing user model after migration is very difficult
- Requires database restructuring
- Can cause data loss
- <strong>Always decide early!</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># api/models.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.auth.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">AbstractUser</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.db</span><span class="w"> </span><span class="kn">import</span> <span class="n">models</span>

<span class="k">class</span><span class="w"> </span><span class="nc">CustomUser</span><span class="p">(</span><span class="n">AbstractUser</span><span class="p">):</span>
    <span class="n">phone_number</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">bio</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">avatar</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ImageField</span><span class="p">(</span><span class="n">upload_to</span><span class="o">=</span><span class="s1">&#39;avatars/&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">created_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">username</span>
</code></pre></div>

<p><strong>Explanation</strong>:
- <strong><code>AbstractUser</code></strong>: Base class with all default User fields (username, email, password, etc.)
- <strong>Extend it</strong>: Add your custom fields
- <strong>Inherits everything</strong>: All User functionality still works
- <strong>Add custom fields</strong>: Phone, bio, avatar, etc.</p>
<p><strong>Update settings.py:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># core/settings.py</span>
<span class="n">AUTH_USER_MODEL</span> <span class="o">=</span> <span class="s1">&#39;api.CustomUser&#39;</span>
</code></pre></div>

<p><strong>What this does</strong>:
- Tells Django to use your custom user model
- Replaces default User model everywhere
- Must be set before first migration!</p>
<p><strong>Important</strong>: Set this before your first migration! Once migrations are created, changing is very difficult.</p>
<h2 id="drf-authentication-classes">DRF Authentication Classes<a class="headerlink" href="#drf-authentication-classes" title="Permanent link">&para;</a></h2>
<h3 id="authentication-vs-authorization">Authentication vs Authorization<a class="headerlink" href="#authentication-vs-authorization" title="Permanent link">&para;</a></h3>
<p><strong>These are two different but related concepts:</strong></p>
<ul>
<li><strong>Authentication</strong>: Who are you? (Identity)</li>
<li>Verifies user's identity</li>
<li>"Are you really John?"</li>
<li>
<p>Examples: Login, password check, token verification</p>
</li>
<li>
<p><strong>Authorization</strong>: What can you do? (Permissions)</p>
</li>
<li>Determines what user can access</li>
<li>"Can John edit this book?"</li>
<li>Examples: Admin only, owner only, read-only</li>
</ul>
<p><strong>Real-world analogy</strong>:
- <strong>Authentication</strong> = Showing ID at entrance (proving who you are)
- <strong>Authorization</strong> = Security guard checking if you have access to VIP area (what you can do)</p>
<p><strong>Why both?</strong>
- Authentication without authorization = Everyone can do everything
- Authorization without authentication = Can't identify users
- <strong>Need both</strong> for secure APIs!</p>
<p><strong>The Flow</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="mf">1.</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="n">sends</span><span class="w"> </span><span class="n">credentials</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="n">Authentication</span><span class="w"> </span><span class="p">(</span><span class="n">who</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">you</span><span class="err">?</span><span class="p">)</span>
<span class="mf">2.</span><span class="w"> </span><span class="kr">If</span><span class="w"> </span><span class="n">authenticated</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="n">Check</span><span class="w"> </span><span class="n">permissions</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="n">Authorization</span><span class="w"> </span><span class="p">(</span><span class="n">what</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">do</span><span class="err">?</span><span class="p">)</span>
<span class="mf">3.</span><span class="w"> </span><span class="kr">If</span><span class="w"> </span><span class="n">authorized</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="n">Allow</span><span class="w"> </span><span class="n">access</span>
<span class="mf">4.</span><span class="w"> </span><span class="kr">If</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">authorized</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="n">Deny</span><span class="w"> </span><span class="n">access</span><span class="w"> </span><span class="p">(</span><span class="mf">403</span><span class="w"> </span><span class="kr">For</span><span class="n">bidden</span><span class="p">)</span>
</code></pre></div>

<h3 id="drf-authentication-types">DRF Authentication Types<a class="headerlink" href="#drf-authentication-types" title="Permanent link">&para;</a></h3>
<h4 id="1-session-authentication">1. Session Authentication<a class="headerlink" href="#1-session-authentication" title="Permanent link">&para;</a></h4>
<p><strong>What is Session Authentication?</strong></p>
<p>Uses Django's session framework. Stores authentication state on the server.</p>
<p><strong>How it works</strong>:
1. User logs in with username/password
2. Server creates a session (stored in database/cache)
3. Server sends session ID in cookie to browser
4. Browser sends cookie with each request
5. Server checks session to identify user</p>
<p><strong>Why use it?</strong>
- <strong>Simple</strong>: Built into Django
- <strong>Secure</strong>: Session stored server-side
- <strong>Good for</strong>: Web apps (same domain)
- <strong>Automatic</strong>: Browser handles cookies</p>
<p><strong>Limitations</strong>:
- <strong>Same-origin only</strong>: Doesn't work well with mobile apps
- <strong>Cookie-based</strong>: Requires browser cookie support
- <strong>Server storage</strong>: Needs database/cache for sessions</p>
<p><strong>When to use</strong>:
- Web applications (React, Vue on same domain)
- Traditional web apps
- When you control both frontend and backend</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># core/settings.py</span>
<span class="n">REST_FRAMEWORK</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;DEFAULT_AUTHENTICATION_CLASSES&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s1">&#39;rest_framework.authentication.SessionAuthentication&#39;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Why this configuration?</strong>
- Sets default authentication for all views
- Can override per-view if needed
- Multiple authentication classes can be used (tries each until one works)</p>
<h4 id="2-token-authentication">2. Token Authentication<a class="headerlink" href="#2-token-authentication" title="Permanent link">&para;</a></h4>
<p>Simple token-based authentication. Good for client-server setups.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Install</span>
pip<span class="w"> </span>install<span class="w"> </span>djangorestframework-simplejwt
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1"># core/settings.py</span>
<span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># ...</span>
    <span class="s1">&#39;rest_framework&#39;</span><span class="p">,</span>
    <span class="s1">&#39;rest_framework_simplejwt&#39;</span><span class="p">,</span>  <span class="c1"># Add this</span>
<span class="p">]</span>

<span class="n">REST_FRAMEWORK</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;DEFAULT_AUTHENTICATION_CLASSES&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s1">&#39;rest_framework_simplejwt.authentication.JWTAuthentication&#39;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="3-jwt-authentication-recommended">3. JWT Authentication (Recommended)<a class="headerlink" href="#3-jwt-authentication-recommended" title="Permanent link">&para;</a></h4>
<p><strong>What is JWT?</strong></p>
<p><strong>JWT</strong> = JSON Web Token</p>
<p><strong>How it works</strong>:
1. User logs in with username/password
2. Server creates a JWT token (contains user info)
3. Server sends token to client
4. Client stores token (localStorage, memory)
5. Client sends token with each request in header
6. Server verifies token and extracts user info</p>
<p><strong>Why JWT is popular</strong>:
- <strong>Stateless</strong>: No server-side storage needed
- <strong>Scalable</strong>: Works across multiple servers
- <strong>Mobile-friendly</strong>: Works with mobile apps
- <strong>Industry standard</strong>: Used by major companies
- <strong>Self-contained</strong>: Token has all user info</p>
<p><strong>JWT Structure</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="n">Header</span><span class="o">.</span><span class="n">Payload</span><span class="o">.</span><span class="n">Signature</span>

<span class="n">Example</span><span class="p">:</span>
<span class="n">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9</span><span class="o">.</span><span class="n">eyJ1c2VyX2lkIjoxfQ</span><span class="o">.</span><span class="n">signature</span>
</code></pre></div>

<p><strong>Parts</strong>:
- <strong>Header</strong>: Algorithm and token type
- <strong>Payload</strong>: User data (ID, username, etc.)
- <strong>Signature</strong>: Ensures token wasn't tampered with</p>
<p><strong>Why stateless matters</strong>:
- <strong>Session auth</strong>: Server stores session → needs database lookup
- <strong>JWT auth</strong>: Token contains info → no database lookup needed
- <strong>Result</strong>: Faster, more scalable</p>
<p><strong>Security considerations</strong>:
- Tokens expire (access token: 1 hour, refresh token: 1 day)
- Tokens can be blacklisted if compromised
- Always use HTTPS in production (tokens in headers)</p>
<p><strong>When to use JWT</strong>:
- ✅ Mobile apps (iOS, Android)
- ✅ Single Page Applications (SPA)
- ✅ Microservices
- ✅ APIs used by multiple clients
- ❌ Not ideal for traditional server-rendered apps</p>
<h2 id="jwt-authentication-setup">JWT Authentication Setup<a class="headerlink" href="#jwt-authentication-setup" title="Permanent link">&para;</a></h2>
<h3 id="step-1-install-package">Step 1: Install Package<a class="headerlink" href="#step-1-install-package" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code>pip<span class="w"> </span>install<span class="w"> </span>djangorestframework-simplejwt
pip<span class="w"> </span>freeze<span class="w"> </span>&gt;<span class="w"> </span>requirements.txt
</code></pre></div>

<h3 id="step-2-add-to-installed_apps">Step 2: Add to INSTALLED_APPS<a class="headerlink" href="#step-2-add-to-installed_apps" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># core/settings.py</span>
<span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># ...</span>
    <span class="s1">&#39;rest_framework&#39;</span><span class="p">,</span>
    <span class="s1">&#39;rest_framework_simplejwt&#39;</span><span class="p">,</span>
    <span class="s1">&#39;api&#39;</span><span class="p">,</span>
<span class="p">]</span>
</code></pre></div>

<h3 id="step-3-configure-jwt-settings">Step 3: Configure JWT Settings<a class="headerlink" href="#step-3-configure-jwt-settings" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># core/settings.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">timedelta</span>

<span class="n">REST_FRAMEWORK</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;DEFAULT_AUTHENTICATION_CLASSES&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s1">&#39;rest_framework_simplejwt.authentication.JWTAuthentication&#39;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="s1">&#39;DEFAULT_PERMISSION_CLASSES&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s1">&#39;rest_framework.permissions.IsAuthenticated&#39;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">}</span>

<span class="n">SIMPLE_JWT</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;ACCESS_TOKEN_LIFETIME&#39;</span><span class="p">:</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="mi">60</span><span class="p">),</span>
    <span class="s1">&#39;REFRESH_TOKEN_LIFETIME&#39;</span><span class="p">:</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
    <span class="s1">&#39;ROTATE_REFRESH_TOKENS&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="s1">&#39;BLACKLIST_AFTER_ROTATION&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="s1">&#39;UPDATE_LAST_LOGIN&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="s1">&#39;ALGORITHM&#39;</span><span class="p">:</span> <span class="s1">&#39;HS256&#39;</span><span class="p">,</span>
    <span class="s1">&#39;SIGNING_KEY&#39;</span><span class="p">:</span> <span class="n">SECRET_KEY</span><span class="p">,</span>
    <span class="s1">&#39;AUTH_HEADER_TYPES&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Bearer&#39;</span><span class="p">,),</span>
    <span class="s1">&#39;AUTH_HEADER_NAME&#39;</span><span class="p">:</span> <span class="s1">&#39;HTTP_AUTHORIZATION&#39;</span><span class="p">,</span>
    <span class="s1">&#39;USER_ID_FIELD&#39;</span><span class="p">:</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span>
    <span class="s1">&#39;USER_ID_CLAIM&#39;</span><span class="p">:</span> <span class="s1">&#39;user_id&#39;</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Explanation of JWT Settings</strong>:</p>
<ul>
<li><strong><code>ACCESS_TOKEN_LIFETIME</code></strong>: How long access token is valid (60 minutes)</li>
<li><strong>Why short?</strong>: If stolen, expires quickly</li>
<li>
<p><strong>Trade-off</strong>: Security vs convenience</p>
</li>
<li>
<p><strong><code>REFRESH_TOKEN_LIFETIME</code></strong>: How long refresh token is valid (1 day)</p>
</li>
<li><strong>Why longer?</strong>: Used to get new access tokens</li>
<li>
<p><strong>More secure</strong>: Stored more securely, used less often</p>
</li>
<li>
<p><strong><code>ROTATE_REFRESH_TOKENS</code></strong>: Issue new refresh token when used</p>
</li>
<li><strong>Why?</strong>: If old token stolen, it becomes invalid</li>
<li>
<p><strong>Security</strong>: Limits damage from token theft</p>
</li>
<li>
<p><strong><code>BLACKLIST_AFTER_ROTATION</code></strong>: Add old refresh token to blacklist</p>
</li>
<li><strong>Why?</strong>: Prevents reuse of old tokens</li>
<li>
<p><strong>Security</strong>: One-time use tokens</p>
</li>
<li>
<p><strong><code>UPDATE_LAST_LOGIN</code></strong>: Update user's last login time</p>
</li>
<li>
<p><strong>Why?</strong>: Track user activity, security monitoring</p>
</li>
<li>
<p><strong><code>ALGORITHM</code></strong>: How token is signed ('HS256' = HMAC SHA-256)</p>
</li>
<li><strong>Why HS256?</strong>: Fast, secure, widely supported</li>
<li>
<p><strong>Alternative</strong>: RS256 (asymmetric, more secure but slower)</p>
</li>
<li>
<p><strong><code>SIGNING_KEY</code></strong>: Secret key to sign tokens (use Django SECRET_KEY)</p>
</li>
<li><strong>Why secret?</strong>: Anyone with key can create valid tokens</li>
<li>
<p><strong>Security</strong>: Never expose this key!</p>
</li>
<li>
<p><strong><code>AUTH_HEADER_TYPES</code></strong>: Token type in header ('Bearer')</p>
</li>
<li><strong>Why Bearer?</strong>: Standard OAuth2 format</li>
<li>
<p><strong>Usage</strong>: <code>Authorization: Bearer &lt;token&gt;</code></p>
</li>
<li>
<p><strong><code>USER_ID_FIELD</code></strong>: Which User model field to use ('id')</p>
</li>
<li><strong><code>USER_ID_CLAIM</code></strong>: Where to store user ID in token ('user_id')</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="c1">### Step 4: Add JWT URLs</span>

<span class="err">```</span><span class="n">python</span>
<span class="c1"># core/urls.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib</span><span class="w"> </span><span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.urls</span><span class="w"> </span><span class="kn">import</span> <span class="n">path</span><span class="p">,</span> <span class="n">include</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework_simplejwt.views</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">TokenObtainPairView</span><span class="p">,</span>
    <span class="n">TokenRefreshView</span><span class="p">,</span>
    <span class="n">TokenVerifyView</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;admin/&#39;</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;api/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s1">&#39;api.urls&#39;</span><span class="p">)),</span>
    <span class="c1"># JWT endpoints</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;api/token/&#39;</span><span class="p">,</span> <span class="n">TokenObtainPairView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;token_obtain_pair&#39;</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;api/token/refresh/&#39;</span><span class="p">,</span> <span class="n">TokenRefreshView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;token_refresh&#39;</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;api/token/verify/&#39;</span><span class="p">,</span> <span class="n">TokenVerifyView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;token_verify&#39;</span><span class="p">),</span>
<span class="p">]</span>
</code></pre></div>

<h3 id="step-5-create-user-registration-view">Step 5: Create User Registration View<a class="headerlink" href="#step-5-create-user-registration-view" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># api/serializers.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework</span><span class="w"> </span><span class="kn">import</span> <span class="n">serializers</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.auth.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">User</span>

<span class="k">class</span><span class="w"> </span><span class="nc">UserRegistrationSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">write_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">min_length</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
    <span class="n">password_confirm</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">write_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">User</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="s1">&#39;password_confirm&#39;</span><span class="p">,</span> <span class="s1">&#39;first_name&#39;</span><span class="p">,</span> <span class="s1">&#39;last_name&#39;</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;password_confirm&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="n">serializers</span><span class="o">.</span><span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Passwords don&#39;t match&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">validated_data</span><span class="p">):</span>
        <span class="n">validated_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;password_confirm&#39;</span><span class="p">)</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="o">**</span><span class="n">validated_data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">user</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1"># api/views.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework</span><span class="w"> </span><span class="kn">import</span> <span class="n">generics</span><span class="p">,</span> <span class="n">status</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework.response</span><span class="w"> </span><span class="kn">import</span> <span class="n">Response</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework_simplejwt.tokens</span><span class="w"> </span><span class="kn">import</span> <span class="n">RefreshToken</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.auth.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">User</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.serializers</span><span class="w"> </span><span class="kn">import</span> <span class="n">UserRegistrationSerializer</span>

<span class="k">class</span><span class="w"> </span><span class="nc">UserRegistrationView</span><span class="p">(</span><span class="n">generics</span><span class="o">.</span><span class="n">CreateAPIView</span><span class="p">):</span>
    <span class="n">queryset</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">UserRegistrationSerializer</span>
    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Allow anyone to register</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">serializer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_serializer</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="n">serializer</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(</span><span class="n">raise_exception</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">serializer</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="c1"># Generate tokens</span>
        <span class="n">refresh</span> <span class="o">=</span> <span class="n">RefreshToken</span><span class="o">.</span><span class="n">for_user</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Response</span><span class="p">({</span>
            <span class="s1">&#39;user&#39;</span><span class="p">:</span> <span class="n">serializer</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
            <span class="s1">&#39;refresh&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">refresh</span><span class="p">),</span>
            <span class="s1">&#39;access&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">refresh</span><span class="o">.</span><span class="n">access_token</span><span class="p">),</span>
        <span class="p">},</span> <span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_201_CREATED</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1"># api/urls.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.urls</span><span class="w"> </span><span class="kn">import</span> <span class="n">path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># ... other URLs ...</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;register/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">UserRegistrationView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;register&#39;</span><span class="p">),</span>
<span class="p">]</span>
</code></pre></div>

<h3 id="step-6-test-jwt-authentication">Step 6: Test JWT Authentication<a class="headerlink" href="#step-6-test-jwt-authentication" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Register user</span>
curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:8000/api/register/<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{</span>
<span class="s1">    &quot;username&quot;: &quot;testuser&quot;,</span>
<span class="s1">    &quot;email&quot;: &quot;test@example.com&quot;,</span>
<span class="s1">    &quot;password&quot;: &quot;testpass123&quot;,</span>
<span class="s1">    &quot;password_confirm&quot;: &quot;testpass123&quot;</span>
<span class="s1">  }&#39;</span>

<span class="c1"># Get token</span>
curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:8000/api/token/<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{&quot;username&quot;: &quot;testuser&quot;, &quot;password&quot;: &quot;testpass123&quot;}&#39;</span>

<span class="c1"># Use token</span>
<span class="nv">TOKEN</span><span class="o">=</span><span class="s2">&quot;your_access_token_here&quot;</span>
curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>http://localhost:8000/api/tasks/
</code></pre></div>

<h2 id="permissions">Permissions<a class="headerlink" href="#permissions" title="Permanent link">&para;</a></h2>
<h3 id="what-are-permissions">What are Permissions?<a class="headerlink" href="#what-are-permissions" title="Permanent link">&para;</a></h3>
<p><strong>Permissions</strong> determine what authenticated users can do.</p>
<p><strong>Why Permissions?</strong>
- <strong>Security</strong>: Not all users should do everything
- <strong>Data protection</strong>: Users should only see/edit their own data
- <strong>Role-based access</strong>: Admins can do more than regular users
- <strong>Compliance</strong>: Meet security requirements</p>
<p><strong>Real-world analogy</strong>:
- <strong>No permissions</strong> = Everyone has master key (bad!)
- <strong>With permissions</strong> = Different keys for different access levels (good!)</p>
<p><strong>Permission Levels</strong>:
1. <strong>Public</strong>: Anyone can access (AllowAny)
2. <strong>Authenticated</strong>: Must be logged in (IsAuthenticated)
3. <strong>Owner</strong>: Can only access own data (IsOwnerOrReadOnly)
4. <strong>Admin</strong>: Only staff can access (IsAdminUser)</p>
<h3 id="built-in-permission-classes">Built-in Permission Classes<a class="headerlink" href="#built-in-permission-classes" title="Permanent link">&para;</a></h3>
<h4 id="1-allowany">1. AllowAny<a class="headerlink" href="#1-allowany" title="Permanent link">&para;</a></h4>
<p><strong>What it does</strong>: Anyone can access, no authentication required.</p>
<p><strong>Why use it?</strong>
- Public data (blog posts, product listings)
- Registration/login endpoints
- Public APIs
- When you want maximum accessibility</p>
<p><strong>Security note</strong>: Use carefully! Only for truly public data.</p>
<p><strong>When to use</strong>:
- ✅ Public blog posts
- ✅ Product catalogs
- ✅ Public user profiles
- ❌ User data
- ❌ Admin functions</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework.permissions</span><span class="w"> </span><span class="kn">import</span> <span class="n">AllowAny</span>

<span class="k">class</span><span class="w"> </span><span class="nc">TaskViewSet</span><span class="p">(</span><span class="n">viewsets</span><span class="o">.</span><span class="n">ModelViewSet</span><span class="p">):</span>
    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">AllowAny</span><span class="p">]</span>
    <span class="c1"># ...</span>
</code></pre></div>

<p><strong>Note</strong>: In this example, we use <code>TaskViewSet</code>, but the same pattern applies to any ViewSet (Book, Product, etc.).</p>
<h4 id="2-isauthenticated">2. IsAuthenticated<a class="headerlink" href="#2-isauthenticated" title="Permanent link">&para;</a></h4>
<p><strong>What it does</strong>: User must be logged in (authenticated) to access.</p>
<p><strong>Why use it?</strong>
- <strong>Protect data</strong>: Only logged-in users can access
- <strong>User-specific content</strong>: Show personalized data
- <strong>Account required</strong>: Force users to create accounts
- <strong>Security</strong>: Basic protection for most endpoints</p>
<p><strong>When to use</strong>:
- ✅ User's own tasks/books
- ✅ User profiles
- ✅ Private data
- ✅ Any endpoint requiring user identity</p>
<p><strong>What happens if not authenticated?</strong>
- Returns <code>401 Unauthorized</code>
- Client must login first
- Token/session required</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework.permissions</span><span class="w"> </span><span class="kn">import</span> <span class="n">IsAuthenticated</span>

<span class="k">class</span><span class="w"> </span><span class="nc">TaskViewSet</span><span class="p">(</span><span class="n">viewsets</span><span class="o">.</span><span class="n">ModelViewSet</span><span class="p">):</span>
    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">IsAuthenticated</span><span class="p">]</span>
    <span class="c1"># ...</span>
</code></pre></div>

<p><strong>Why this configuration?</strong>
- Applies to all actions (list, create, retrieve, update, delete)
- Can override per-action if needed
- Most common permission for user data</p>
<p><strong>Note</strong>: This is the most common permission for user-owned resources like tasks, where users should only see their own data.</p>
<h4 id="3-isadminuser">3. IsAdminUser<a class="headerlink" href="#3-isadminuser" title="Permanent link">&para;</a></h4>
<p>User must be staff/admin.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework.permissions</span><span class="w"> </span><span class="kn">import</span> <span class="n">IsAdminUser</span>

<span class="k">class</span><span class="w"> </span><span class="nc">TaskViewSet</span><span class="p">(</span><span class="n">viewsets</span><span class="o">.</span><span class="n">ModelViewSet</span><span class="p">):</span>
    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">IsAdminUser</span><span class="p">]</span>
    <span class="c1"># ...</span>
</code></pre></div>

<p><strong>Note</strong>: Use this for admin-only endpoints. For user data like tasks, you typically want <code>IsAuthenticated</code> instead.</p>
<h4 id="4-isauthenticatedorreadonly">4. IsAuthenticatedOrReadOnly<a class="headerlink" href="#4-isauthenticatedorreadonly" title="Permanent link">&para;</a></h4>
<p><strong>What it does</strong>: 
- <strong>Authenticated users</strong>: Can do everything (read, create, update, delete)
- <strong>Unauthenticated users</strong>: Can only read (GET requests)</p>
<p><strong>Why use it?</strong>
- <strong>Public viewing</strong>: Anyone can see data
- <strong>Protected editing</strong>: Only logged-in users can modify
- <strong>Common pattern</strong>: Blog posts, comments, products
- <strong>User engagement</strong>: Encourage registration to participate</p>
<p><strong>Real-world example</strong>:
- Blog: Anyone can read posts, only logged-in users can comment
- Products: Anyone can browse, only logged-in users can add to cart
- Comments: Anyone can read, only logged-in users can post</p>
<p><strong>When to use</strong>:
- ✅ Public content with user contributions
- ✅ Read-mostly APIs
- ✅ When you want public access but protected writes
- ❌ Private/sensitive data</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework.permissions</span><span class="w"> </span><span class="kn">import</span> <span class="n">IsAuthenticatedOrReadOnly</span>

<span class="k">class</span><span class="w"> </span><span class="nc">TaskViewSet</span><span class="p">(</span><span class="n">viewsets</span><span class="o">.</span><span class="n">ModelViewSet</span><span class="p">):</span>
    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">IsAuthenticatedOrReadOnly</span><span class="p">]</span>
    <span class="c1"># ...</span>
</code></pre></div>

<p><strong>What this means</strong>:
- <code>GET /api/tasks/</code> → Anyone can access ✅
- <code>POST /api/tasks/</code> → Must be authenticated ✅
- <code>PUT /api/tasks/1/</code> → Must be authenticated ✅
- <code>DELETE /api/tasks/1/</code> → Must be authenticated ✅</p>
<p><strong>Note</strong>: For private user data like personal tasks, you'd typically use <code>IsAuthenticated</code> instead. This permission is better for public content.</p>
<h3 id="custom-permissions">Custom Permissions<a class="headerlink" href="#custom-permissions" title="Permanent link">&para;</a></h3>
<h4 id="isownerorreadonly">IsOwnerOrReadOnly<a class="headerlink" href="#isownerorreadonly" title="Permanent link">&para;</a></h4>
<p>Only the owner can edit/delete, others can read.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># api/permissions.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework</span><span class="w"> </span><span class="kn">import</span> <span class="n">permissions</span>

<span class="k">class</span><span class="w"> </span><span class="nc">IsOwnerOrReadOnly</span><span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">BasePermission</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Custom permission to only allow owners to edit/delete objects.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">has_object_permission</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">view</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="c1"># Read permissions for any request</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="ow">in</span> <span class="n">permissions</span><span class="o">.</span><span class="n">SAFE_METHODS</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="c1"># Write permissions only to the owner</span>
        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">owner</span> <span class="o">==</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
</code></pre></div>

<p><strong>Use in views:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># api/views.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.permissions</span><span class="w"> </span><span class="kn">import</span> <span class="n">IsOwnerOrReadOnly</span>

<span class="k">class</span><span class="w"> </span><span class="nc">TaskViewSet</span><span class="p">(</span><span class="n">viewsets</span><span class="o">.</span><span class="n">ModelViewSet</span><span class="p">):</span>
    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">IsAuthenticated</span><span class="p">,</span> <span class="n">IsOwnerOrReadOnly</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">perform_create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">serializer</span><span class="p">):</span>
        <span class="n">serializer</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">owner</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
</code></pre></div>

<p><strong>Why this works for tasks:</strong>
- Users can read all tasks (or filter to their own in <code>get_queryset()</code>)
- Users can only edit/delete their own tasks
- Perfect for user-owned resources like tasks, notes, etc.</p>
<h3 id="permission-at-view-level">Permission at View Level<a class="headerlink" href="#permission-at-view-level" title="Permanent link">&para;</a></h3>
<p><strong>Why different permissions per action?</strong>
- <strong>List/Retrieve</strong>: Maybe public (AllowAny) or authenticated (IsAuthenticated)
- <strong>Create</strong>: Usually requires authentication
- <strong>Update/Delete</strong>: Usually requires ownership (IsOwnerOrReadOnly)</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Different permissions for different actions</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TaskViewSet</span><span class="p">(</span><span class="n">viewsets</span><span class="o">.</span><span class="n">ModelViewSet</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_permissions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">action</span> <span class="o">==</span> <span class="s1">&#39;create&#39;</span><span class="p">:</span>
            <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">IsAuthenticated</span><span class="p">]</span>  <span class="c1"># Must be logged in to create</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">action</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="s1">&#39;partial_update&#39;</span><span class="p">,</span> <span class="s1">&#39;destroy&#39;</span><span class="p">]:</span>
            <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">IsAuthenticated</span><span class="p">,</span> <span class="n">IsOwnerOrReadOnly</span><span class="p">]</span>  <span class="c1"># Must own to edit</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">IsAuthenticated</span><span class="p">]</span>  <span class="c1"># Must be logged in to view</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">permission</span><span class="p">()</span> <span class="k">for</span> <span class="n">permission</span> <span class="ow">in</span> <span class="n">permission_classes</span><span class="p">]</span>
</code></pre></div>

<p><strong>Explanation</strong>:
- <strong><code>create</code></strong>: Anyone authenticated can create tasks
- <strong><code>update/delete</code></strong>: Only task owner can modify
- <strong><code>list/retrieve</code></strong>: Authenticated users can view (you might filter to own tasks in <code>get_queryset()</code>)</p>
<p><strong>Alternative for private tasks</strong> (users only see their own):</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">TaskViewSet</span><span class="p">(</span><span class="n">viewsets</span><span class="o">.</span><span class="n">ModelViewSet</span><span class="p">):</span>
    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">IsAuthenticated</span><span class="p">]</span>  <span class="c1"># Same for all actions</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Users only see their own tasks</span>
        <span class="k">return</span> <span class="n">Task</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">owner</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
</code></pre></div>

<h2 id="filtering">Filtering<a class="headerlink" href="#filtering" title="Permanent link">&para;</a></h2>
<h3 id="what-is-filtering">What is Filtering?<a class="headerlink" href="#what-is-filtering" title="Permanent link">&para;</a></h3>
<p><strong>Filtering</strong> allows clients to request specific subsets of data based on criteria.</p>
<p><strong>The Problem</strong>: Without filtering, clients get ALL data, even if they only need a subset.</p>
<p><strong>Example</strong>:
- Without filtering: <code>GET /api/tasks/</code> → Returns all tasks (10,000 tasks) ❌
- With filtering: <code>GET /api/tasks/?completed=false</code> → Returns only incomplete tasks ✅</p>
<p><strong>Why Filtering?</strong>
- <strong>Performance</strong>: Return only needed data (faster queries)
- <strong>User experience</strong>: Users find what they're looking for
- <strong>Bandwidth</strong>: Less data transferred
- <strong>Database efficiency</strong>: Queries only relevant records</p>
<p><strong>Real-world analogy</strong>:
- <strong>No filtering</strong> = Library with no organization (find book by searching all shelves)
- <strong>With filtering</strong> = Library with sections (go directly to "Fiction" section)</p>
<p><strong>Common Filter Types</strong>:
- <strong>Exact match</strong>: <code>?completed=true</code> (completed exactly equals true)
- <strong>Contains</strong>: <code>?title__icontains=django</code> (title contains "django")
- <strong>Boolean</strong>: <code>?completed=false</code> (filter by boolean field)
- <strong>Date range</strong>: <code>?created_after=2024-01-01</code> (created after date)</p>
<h3 id="install-django-filter">Install django-filter<a class="headerlink" href="#install-django-filter" title="Permanent link">&para;</a></h3>
<p><strong>Why django-filter?</strong>
- Makes filtering easy and powerful
- Supports complex filters
- Works seamlessly with DRF
- Handles edge cases</p>
<div class="codehilite"><pre><span></span><code>pip<span class="w"> </span>install<span class="w"> </span>django-filter
</code></pre></div>

<h3 id="configure-in-settingspy">Configure in settings.py<a class="headerlink" href="#configure-in-settingspy" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># core/settings.py</span>
<span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># ...</span>
    <span class="s1">&#39;django_filters&#39;</span><span class="p">,</span>
    <span class="s1">&#39;rest_framework&#39;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">REST_FRAMEWORK</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;DEFAULT_FILTER_BACKENDS&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s1">&#39;django_filters.rest_framework.DjangoFilterBackend&#39;</span><span class="p">,</span>
        <span class="s1">&#39;rest_framework.filters.SearchFilter&#39;</span><span class="p">,</span>
        <span class="s1">&#39;rest_framework.filters.OrderingFilter&#39;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="basic-filtering">Basic Filtering<a class="headerlink" href="#basic-filtering" title="Permanent link">&para;</a></h3>
<p><strong>How it works</strong>:
1. Client adds query parameters to URL: <code>?completed=false</code>
2. Django Filter intercepts request
3. Applies filters to queryset
4. Returns filtered results</p>
<p><strong>Why <code>filter_backends</code>?</strong>
- Tells DRF which filtering system to use
- Can use multiple backends (filtering + searching + ordering)
- Each backend handles different aspects</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># api/views.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django_filters.rest_framework</span><span class="w"> </span><span class="kn">import</span> <span class="n">DjangoFilterBackend</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework</span><span class="w"> </span><span class="kn">import</span> <span class="n">viewsets</span><span class="p">,</span> <span class="n">filters</span>

<span class="k">class</span><span class="w"> </span><span class="nc">TaskViewSet</span><span class="p">(</span><span class="n">viewsets</span><span class="o">.</span><span class="n">ModelViewSet</span><span class="p">):</span>
    <span class="n">queryset</span> <span class="o">=</span> <span class="n">Task</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">TaskSerializer</span>
    <span class="n">filter_backends</span> <span class="o">=</span> <span class="p">[</span><span class="n">DjangoFilterBackend</span><span class="p">]</span>  <span class="c1"># Enable filtering</span>
    <span class="n">filterset_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;completed&#39;</span><span class="p">,</span> <span class="s1">&#39;created_at&#39;</span><span class="p">]</span>  <span class="c1"># Which fields can be filtered</span>
</code></pre></div>

<p><strong>Explanation</strong>:
- <strong><code>filter_backends</code></strong>: List of filtering systems to use
- <strong><code>filterset_fields</code></strong>: Simple list of fields that can be filtered
- <strong>Exact match</strong>: <code>?completed=false</code> finds tasks where completed exactly equals False</p>
<p><strong>Usage:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Filter by completed status</span>
curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>http://localhost:8000/api/tasks/?completed<span class="o">=</span><span class="nb">false</span>
</code></pre></div>

<p><strong>What happens</strong>:
- URL parameter <code>completed=false</code>
- Django Filter finds tasks where <code>completed</code> field equals False
- Returns only incomplete tasks</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Filter by multiple fields (if you have date field)</span>
curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span><span class="s2">&quot;http://localhost:8000/api/tasks/?completed=false&amp;created_at=2024-01-01&quot;</span>
</code></pre></div>

<p><strong>What happens</strong>:
- Both filters applied: <code>completed=false</code> AND <code>created_at=2024-01-01</code>
- Returns tasks matching BOTH criteria
- Filters are combined with AND logic</p>
<h3 id="advanced-filtering-with-filterset">Advanced Filtering with FilterSet<a class="headerlink" href="#advanced-filtering-with-filterset" title="Permanent link">&para;</a></h3>
<p><strong>Why use FilterSet instead of <code>filterset_fields</code>?</strong>
- <strong>Advanced lookups</strong>: <code>icontains</code>, <code>gte</code>, <code>lte</code>, etc.
- <strong>Custom field names</strong>: <code>created_after</code> instead of <code>created_at__gte</code>
- <strong>More control</strong>: Complex filtering logic
- <strong>Better UX</strong>: User-friendly filter names</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># api/filters.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">django_filters</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Task</span>

<span class="k">class</span><span class="w"> </span><span class="nc">TaskFilter</span><span class="p">(</span><span class="n">django_filters</span><span class="o">.</span><span class="n">FilterSet</span><span class="p">):</span>
    <span class="c1"># Filter by title containing text (case-insensitive)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">django_filters</span><span class="o">.</span><span class="n">CharFilter</span><span class="p">(</span><span class="n">lookup_expr</span><span class="o">=</span><span class="s1">&#39;icontains&#39;</span><span class="p">)</span>

    <span class="c1"># Filter by date range</span>
    <span class="n">created_after</span> <span class="o">=</span> <span class="n">django_filters</span><span class="o">.</span><span class="n">DateFilter</span><span class="p">(</span><span class="n">field_name</span><span class="o">=</span><span class="s1">&#39;created_at&#39;</span><span class="p">,</span> <span class="n">lookup_expr</span><span class="o">=</span><span class="s1">&#39;gte&#39;</span><span class="p">)</span>
    <span class="n">created_before</span> <span class="o">=</span> <span class="n">django_filters</span><span class="o">.</span><span class="n">DateFilter</span><span class="p">(</span><span class="n">field_name</span><span class="o">=</span><span class="s1">&#39;created_at&#39;</span><span class="p">,</span> <span class="n">lookup_expr</span><span class="o">=</span><span class="s1">&#39;lte&#39;</span><span class="p">)</span>

    <span class="c1"># Filter by completed status</span>
    <span class="n">completed</span> <span class="o">=</span> <span class="n">django_filters</span><span class="o">.</span><span class="n">BooleanFilter</span><span class="p">()</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Task</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;completed&#39;</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;created_after&#39;</span><span class="p">,</span> <span class="s1">&#39;created_before&#39;</span><span class="p">]</span>
</code></pre></div>

<p><strong>Explanation</strong>:
- <strong><code>title</code></strong>: <code>?title=django</code> finds tasks with "django" in title (case-insensitive)
- <strong><code>created_after</code></strong>: <code>?created_after=2024-01-01</code> finds tasks created on or after date
- <strong><code>created_before</code></strong>: <code>?created_before=2024-12-31</code> finds tasks created before date
- <strong><code>completed</code></strong>: <code>?completed=false</code> finds incomplete tasks</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># api/views.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.filters</span><span class="w"> </span><span class="kn">import</span> <span class="n">TaskFilter</span>

<span class="k">class</span><span class="w"> </span><span class="nc">TaskViewSet</span><span class="p">(</span><span class="n">viewsets</span><span class="o">.</span><span class="n">ModelViewSet</span><span class="p">):</span>
    <span class="n">queryset</span> <span class="o">=</span> <span class="n">Task</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">TaskSerializer</span>
    <span class="n">filterset_class</span> <span class="o">=</span> <span class="n">TaskFilter</span>  <span class="c1"># Use FilterSet instead of filterset_fields</span>
</code></pre></div>

<p><strong>Usage:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Filter by title containing &quot;django&quot;</span>
curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span><span class="s2">&quot;http://localhost:8000/api/tasks/?title=django&quot;</span>

<span class="c1"># Filter by date range</span>
curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span><span class="s2">&quot;http://localhost:8000/api/tasks/?created_after=2024-01-01&amp;created_before=2024-12-31&quot;</span>

<span class="c1"># Combine filters</span>
curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span><span class="s2">&quot;http://localhost:8000/api/tasks/?completed=false&amp;title=important&quot;</span>
</code></pre></div>

<h2 id="searching">Searching<a class="headerlink" href="#searching" title="Permanent link">&para;</a></h2>
<h3 id="what-is-searching">What is Searching?<a class="headerlink" href="#what-is-searching" title="Permanent link">&para;</a></h3>
<p><strong>Searching</strong> allows users to find data by searching across multiple fields with a single query.</p>
<p><strong>Difference from Filtering</strong>:
- <strong>Filtering</strong>: Exact matches on specific fields (<code>?author=John</code>)
- <strong>Searching</strong>: Partial matches across multiple fields (<code>?search=john</code> finds in title, author, description)</p>
<p><strong>Why Searching?</strong>
- <strong>User-friendly</strong>: Users don't need to know exact field names
- <strong>Flexible</strong>: Search across multiple fields at once
- <strong>Common pattern</strong>: Search boxes in web apps
- <strong>Better UX</strong>: "Search for anything" vs "Filter by specific field"</p>
<p><strong>Real-world analogy</strong>:
- <strong>Filtering</strong> = Library catalog with specific fields (author, genre, year)
- <strong>Searching</strong> = Google search (type anything, finds matches anywhere)</p>
<h3 id="searchfilter">SearchFilter<a class="headerlink" href="#searchfilter" title="Permanent link">&para;</a></h3>
<p><strong>How it works</strong>:
1. User types search term: <code>?search=django</code>
2. DRF searches across specified fields
3. Returns records matching search term in ANY field
4. Uses case-insensitive partial matching by default</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># api/views.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework</span><span class="w"> </span><span class="kn">import</span> <span class="n">viewsets</span><span class="p">,</span> <span class="n">filters</span>

<span class="k">class</span><span class="w"> </span><span class="nc">TaskViewSet</span><span class="p">(</span><span class="n">viewsets</span><span class="o">.</span><span class="n">ModelViewSet</span><span class="p">):</span>
    <span class="n">queryset</span> <span class="o">=</span> <span class="n">Task</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">TaskSerializer</span>
    <span class="n">filter_backends</span> <span class="o">=</span> <span class="p">[</span><span class="n">filters</span><span class="o">.</span><span class="n">SearchFilter</span><span class="p">]</span>  <span class="c1"># Enable searching</span>
    <span class="n">search_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;desc&#39;</span><span class="p">]</span>  <span class="c1"># Fields to search in</span>
</code></pre></div>

<p><strong>Explanation</strong>:
- <strong><code>SearchFilter</code></strong>: DRF's built-in search backend (no extra package needed)
- <strong><code>search_fields</code></strong>: List of fields to search in
- <strong>Default behavior</strong>: Case-insensitive, partial matching
- <strong>OR logic</strong>: Matches if search term found in ANY field</p>
<p><strong>Usage:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Search in title and description</span>
curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span><span class="s2">&quot;http://localhost:8000/api/tasks/?search=django&quot;</span>
</code></pre></div>

<p><strong>What happens</strong>:
- Searches for "django" in <code>title</code> and <code>desc</code> fields
- Returns tasks where ANY field contains "django"
- Case-insensitive: "Django", "DJANGO", "django" all match
- Partial match: "Learn Django REST Framework" matches "django"</p>
<h3 id="search-lookup-expressions">Search Lookup Expressions<a class="headerlink" href="#search-lookup-expressions" title="Permanent link">&para;</a></h3>
<p><strong>Advanced search patterns:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">TaskViewSet</span><span class="p">(</span><span class="n">viewsets</span><span class="o">.</span><span class="n">ModelViewSet</span><span class="p">):</span>
    <span class="n">search_fields</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;^title&#39;</span><span class="p">,</span>      <span class="c1"># Starts with (e.g., &quot;Learn&quot; matches &quot;Learn Django&quot;)</span>
        <span class="s1">&#39;=title&#39;</span><span class="p">,</span>      <span class="c1"># Exact match (e.g., &quot;Learn Django&quot; only)</span>
        <span class="s1">&#39;@desc&#39;</span><span class="p">,</span>       <span class="c1"># Full text search (PostgreSQL only)</span>
        <span class="s1">&#39;$title&#39;</span><span class="p">,</span>      <span class="c1"># Regex search (advanced)</span>
    <span class="p">]</span>
</code></pre></div>

<p><strong>When to use each:</strong>
- <strong><code>^title</code></strong>: When you want tasks starting with specific text
- <strong><code>=title</code></strong>: When you need exact match
- <strong><code>@desc</code></strong>: PostgreSQL full-text search (most powerful, database-specific)
- <strong><code>$title</code></strong>: Complex pattern matching (use sparingly)</p>
<p><strong>Most common</strong>: Just use field name without prefix for simple case-insensitive search.</p>
<h2 id="ordering">Ordering<a class="headerlink" href="#ordering" title="Permanent link">&para;</a></h2>
<h3 id="what-is-ordering">What is Ordering?<a class="headerlink" href="#what-is-ordering" title="Permanent link">&para;</a></h3>
<p><strong>Ordering</strong> controls the sequence in which results are returned.</p>
<p><strong>The Problem</strong>: Without ordering, results come in unpredictable order (usually database insertion order).</p>
<p><strong>Why Ordering?</strong>
- <strong>User experience</strong>: Show most relevant/newest first
- <strong>Consistency</strong>: Same query always returns same order
- <strong>Flexibility</strong>: Let users choose sort order
- <strong>Default behavior</strong>: Set sensible default (newest first, alphabetical, etc.)</p>
<p><strong>Real-world analogy</strong>:
- <strong>No ordering</strong> = Bookshelf with random order
- <strong>With ordering</strong> = Bookshelf organized by date (newest first) or alphabetically</p>
<h3 id="orderingfilter">OrderingFilter<a class="headerlink" href="#orderingfilter" title="Permanent link">&para;</a></h3>
<p><strong>How it works</strong>:
1. Client specifies order: <code>?ordering=-created_at</code>
2. DRF sorts queryset by specified field
3. <code>-</code> prefix means descending (newest first)
4. No prefix means ascending (oldest first)</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># api/views.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework</span><span class="w"> </span><span class="kn">import</span> <span class="n">viewsets</span><span class="p">,</span> <span class="n">filters</span>

<span class="k">class</span><span class="w"> </span><span class="nc">TaskViewSet</span><span class="p">(</span><span class="n">viewsets</span><span class="o">.</span><span class="n">ModelViewSet</span><span class="p">):</span>
    <span class="n">queryset</span> <span class="o">=</span> <span class="n">Task</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">TaskSerializer</span>
    <span class="n">filter_backends</span> <span class="o">=</span> <span class="p">[</span><span class="n">filters</span><span class="o">.</span><span class="n">OrderingFilter</span><span class="p">]</span>  <span class="c1"># Enable ordering</span>
    <span class="n">ordering_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;completed&#39;</span><span class="p">,</span> <span class="s1">&#39;created_at&#39;</span><span class="p">,</span> <span class="s1">&#39;updated_at&#39;</span><span class="p">]</span>  <span class="c1"># Allowed fields</span>
    <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-created_at&#39;</span><span class="p">]</span>  <span class="c1"># Default ordering (newest first)</span>
</code></pre></div>

<p><strong>Explanation</strong>:
- <strong><code>OrderingFilter</code></strong>: DRF's built-in ordering backend
- <strong><code>ordering_fields</code></strong>: Which fields users can sort by (security: prevents sorting by sensitive fields)
- <strong><code>ordering</code></strong>: Default order if user doesn't specify
- <strong><code>-</code> prefix</strong>: Descending order (newest/highest first)
- <strong>No prefix</strong>: Ascending order (oldest/lowest first)</p>
<p><strong>Usage:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Order by title (ascending: A-Z)</span>
curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span><span class="s2">&quot;http://localhost:8000/api/tasks/?ordering=title&quot;</span>
</code></pre></div>

<p><strong>What happens</strong>: Tasks sorted alphabetically by title (A to Z)</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Order by created_at (descending: newest first)</span>
curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span><span class="s2">&quot;http://localhost:8000/api/tasks/?ordering=-created_at&quot;</span>
</code></pre></div>

<p><strong>What happens</strong>: Tasks sorted by creation date, newest first (most recent at top)</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Multiple fields: First by completed status, then by created_at (descending)</span>
curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span><span class="s2">&quot;http://localhost:8000/api/tasks/?ordering=completed,-created_at&quot;</span>
</code></pre></div>

<p><strong>What happens</strong>: 
1. First sorts by completed (False first, then True)
2. Within same completion status, sorts by created_at (newest first)
3. Useful for showing incomplete tasks first, then completed</p>
<h2 id="pagination">Pagination<a class="headerlink" href="#pagination" title="Permanent link">&para;</a></h2>
<h3 id="what-is-pagination">What is Pagination?<a class="headerlink" href="#what-is-pagination" title="Permanent link">&para;</a></h3>
<p><strong>Pagination</strong> splits large result sets into smaller "pages" of data.</p>
<p><strong>The Problem</strong>: Without pagination, returning 10,000 records causes:
- <strong>Slow response</strong>: Large JSON payload
- <strong>High memory</strong>: Server/client must handle all data
- <strong>Poor UX</strong>: User overwhelmed with data
- <strong>Database load</strong>: Fetching all records at once</p>
<p><strong>Why Pagination?</strong>
- <strong>Performance</strong>: Faster responses (only fetch what's needed)
- <strong>User experience</strong>: Manageable chunks of data
- <strong>Scalability</strong>: Works with millions of records
- <strong>Bandwidth</strong>: Less data transferred
- <strong>Mobile-friendly</strong>: Smaller payloads for mobile networks</p>
<p><strong>Real-world analogy</strong>:
- <strong>No pagination</strong> = Dumping entire library catalog on one page
- <strong>With pagination</strong> = Showing 10 books per page with "Next" button</p>
<p><strong>Common Pagination Types</strong>:
1. <strong>Page Number</strong>: <code>?page=2</code> (most common, user-friendly)
2. <strong>Limit/Offset</strong>: <code>?limit=20&amp;offset=40</code> (flexible, good for APIs)
3. <strong>Cursor</strong>: <code>?cursor=abc123</code> (best for large datasets, stable)</p>
<h3 id="pagenumberpagination">PageNumberPagination<a class="headerlink" href="#pagenumberpagination" title="Permanent link">&para;</a></h3>
<p><strong>How it works</strong>:
1. Client requests page: <code>?page=2</code>
2. Server calculates which records to return (records 11-20 for page 2)
3. Returns page data + metadata (total count, next/previous links)
4. Client can navigate to next/previous pages</p>
<p><strong>Why Page Number?</strong>
- <strong>User-friendly</strong>: Easy to understand ("Go to page 2")
- <strong>Simple</strong>: Just specify page number
- <strong>Good for</strong>: Web UIs, predictable navigation
- <strong>Limitation</strong>: Can be slow with very large datasets (offset calculation)</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># core/settings.py</span>
<span class="n">REST_FRAMEWORK</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;DEFAULT_PAGINATION_CLASS&#39;</span><span class="p">:</span> <span class="s1">&#39;rest_framework.pagination.PageNumberPagination&#39;</span><span class="p">,</span>
    <span class="s1">&#39;PAGE_SIZE&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>  <span class="c1"># Records per page</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Explanation</strong>:
- <strong><code>DEFAULT_PAGINATION_CLASS</code></strong>: Applies to all list endpoints
- <strong><code>PAGE_SIZE</code></strong>: How many records per page
- <strong>Can override</strong>: Per-view if needed</p>
<p><strong>Response format:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">  </span><span class="c1">// Total number of records</span>
<span class="w">    </span><span class="nt">&quot;next&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;http://localhost:8000/api/tasks/?page=2&quot;</span><span class="p">,</span><span class="w">  </span><span class="c1">// URL for next page</span>
<span class="w">    </span><span class="nt">&quot;previous&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">  </span><span class="c1">// URL for previous page (null if on first page)</span>
<span class="w">    </span><span class="nt">&quot;results&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="err">...</span><span class="p">]</span><span class="w">  </span><span class="c1">// Actual data (10 records)</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Why this format?</strong>
- <strong><code>count</code></strong>: Total records (for progress indicators: "Showing 1-10 of 100")
- <strong><code>next</code></strong>: Direct link to next page (convenient for clients)
- <strong><code>previous</code></strong>: Direct link to previous page
- <strong><code>results</code></strong>: Actual data array</p>
<p><strong>Usage:</strong></p>
<div class="codehilite"><pre><span></span><code>curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span><span class="s2">&quot;http://localhost:8000/api/tasks/?page=2&quot;</span>
</code></pre></div>

<p><strong>What happens</strong>: Returns records 11-20 (page 2, assuming 10 per page)</p>
<p><strong>Example response:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;next&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;http://localhost:8000/api/tasks/?page=3&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;previous&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;http://localhost:8000/api/tasks/?page=1&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;results&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Task 11&quot;</span><span class="p">,</span><span class="w"> </span><span class="err">...</span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Task 12&quot;</span><span class="p">,</span><span class="w"> </span><span class="err">...</span><span class="p">},</span>
<span class="w">        </span><span class="err">...</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="limitoffsetpagination">LimitOffsetPagination<a class="headerlink" href="#limitoffsetpagination" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># api/pagination.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework.pagination</span><span class="w"> </span><span class="kn">import</span> <span class="n">LimitOffsetPagination</span>

<span class="k">class</span><span class="w"> </span><span class="nc">BookLimitOffsetPagination</span><span class="p">(</span><span class="n">LimitOffsetPagination</span><span class="p">):</span>
    <span class="n">default_limit</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">limit_query_param</span> <span class="o">=</span> <span class="s1">&#39;limit&#39;</span>
    <span class="n">offset_query_param</span> <span class="o">=</span> <span class="s1">&#39;offset&#39;</span>
    <span class="n">max_limit</span> <span class="o">=</span> <span class="mi">100</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1"># api/views.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.pagination</span><span class="w"> </span><span class="kn">import</span> <span class="n">BookLimitOffsetPagination</span>

<span class="k">class</span><span class="w"> </span><span class="nc">BookViewSet</span><span class="p">(</span><span class="n">viewsets</span><span class="o">.</span><span class="n">ModelViewSet</span><span class="p">):</span>
    <span class="n">pagination_class</span> <span class="o">=</span> <span class="n">BookLimitOffsetPagination</span>
    <span class="c1"># ...</span>
</code></pre></div>

<p><strong>Usage:</strong></p>
<div class="codehilite"><pre><span></span><code>curl<span class="w"> </span>http://localhost:8000/api/books/?limit<span class="o">=</span><span class="m">20</span><span class="p">&amp;</span><span class="nv">offset</span><span class="o">=</span><span class="m">40</span>
</code></pre></div>

<h3 id="cursorpagination">CursorPagination<a class="headerlink" href="#cursorpagination" title="Permanent link">&para;</a></h3>
<p>Best for large datasets. Provides stable, consistent pagination.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># api/pagination.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework.pagination</span><span class="w"> </span><span class="kn">import</span> <span class="n">CursorPagination</span>

<span class="k">class</span><span class="w"> </span><span class="nc">BookCursorPagination</span><span class="p">(</span><span class="n">CursorPagination</span><span class="p">):</span>
    <span class="n">page_size</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">ordering</span> <span class="o">=</span> <span class="s1">&#39;-created_at&#39;</span>
    <span class="n">cursor_query_param</span> <span class="o">=</span> <span class="s1">&#39;cursor&#39;</span>
</code></pre></div>

<h2 id="step-by-step-secure-book-api">Step-by-Step: Secure Book API<a class="headerlink" href="#step-by-step-secure-book-api" title="Permanent link">&para;</a></h2>
<p><strong>Note</strong>: This section uses Book API as an example of content that can be public or user-owned. The same patterns apply to Task API or any other model.</p>
<p>Let's upgrade the Book API with authentication and filtering.</p>
<h3 id="step-1-update-book-model">Step 1: Update Book Model<a class="headerlink" href="#step-1-update-book-model" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># api/models.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.db</span><span class="w"> </span><span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.auth.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">User</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Book</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">author</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">published_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">()</span>
    <span class="n">isbn</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">13</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">owner</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;books&#39;</span><span class="p">)</span>
    <span class="n">created_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">updated_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="si">}</span><span class="s2"> by </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">author</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-created_at&#39;</span><span class="p">]</span>
</code></pre></div>

<p><strong>Create migration:</strong></p>
<div class="codehilite"><pre><span></span><code>python<span class="w"> </span>manage.py<span class="w"> </span>makemigrations
python<span class="w"> </span>manage.py<span class="w"> </span>migrate
</code></pre></div>

<h3 id="step-2-update-book-serializer">Step 2: Update Book Serializer<a class="headerlink" href="#step-2-update-book-serializer" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># api/serializers.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework</span><span class="w"> </span><span class="kn">import</span> <span class="n">serializers</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Book</span>

<span class="k">class</span><span class="w"> </span><span class="nc">BookSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
    <span class="n">owner_username</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="s1">&#39;owner.username&#39;</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Book</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;author&#39;</span><span class="p">,</span> <span class="s1">&#39;published_date&#39;</span><span class="p">,</span> <span class="s1">&#39;isbn&#39;</span><span class="p">,</span> <span class="s1">&#39;description&#39;</span><span class="p">,</span> 
                  <span class="s1">&#39;owner&#39;</span><span class="p">,</span> <span class="s1">&#39;owner_username&#39;</span><span class="p">,</span> <span class="s1">&#39;created_at&#39;</span><span class="p">,</span> <span class="s1">&#39;updated_at&#39;</span><span class="p">]</span>
        <span class="n">read_only_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;owner&#39;</span><span class="p">,</span> <span class="s1">&#39;created_at&#39;</span><span class="p">,</span> <span class="s1">&#39;updated_at&#39;</span><span class="p">]</span>
</code></pre></div>

<h3 id="step-3-create-filter">Step 3: Create Filter<a class="headerlink" href="#step-3-create-filter" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># api/filters.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">django_filters</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Book</span>

<span class="k">class</span><span class="w"> </span><span class="nc">BookFilter</span><span class="p">(</span><span class="n">django_filters</span><span class="o">.</span><span class="n">FilterSet</span><span class="p">):</span>
    <span class="n">author</span> <span class="o">=</span> <span class="n">django_filters</span><span class="o">.</span><span class="n">CharFilter</span><span class="p">(</span><span class="n">lookup_expr</span><span class="o">=</span><span class="s1">&#39;icontains&#39;</span><span class="p">)</span>
    <span class="n">published_after</span> <span class="o">=</span> <span class="n">django_filters</span><span class="o">.</span><span class="n">DateFilter</span><span class="p">(</span><span class="n">field_name</span><span class="o">=</span><span class="s1">&#39;published_date&#39;</span><span class="p">,</span> <span class="n">lookup_expr</span><span class="o">=</span><span class="s1">&#39;gte&#39;</span><span class="p">)</span>
    <span class="n">published_before</span> <span class="o">=</span> <span class="n">django_filters</span><span class="o">.</span><span class="n">DateFilter</span><span class="p">(</span><span class="n">field_name</span><span class="o">=</span><span class="s1">&#39;published_date&#39;</span><span class="p">,</span> <span class="n">lookup_expr</span><span class="o">=</span><span class="s1">&#39;lte&#39;</span><span class="p">)</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Book</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;author&#39;</span><span class="p">,</span> <span class="s1">&#39;published_after&#39;</span><span class="p">,</span> <span class="s1">&#39;published_before&#39;</span><span class="p">]</span>
</code></pre></div>

<h3 id="step-4-update-book-viewset">Step 4: Update Book ViewSet<a class="headerlink" href="#step-4-update-book-viewset" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># api/views.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework</span><span class="w"> </span><span class="kn">import</span> <span class="n">viewsets</span><span class="p">,</span> <span class="n">filters</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework.permissions</span><span class="w"> </span><span class="kn">import</span> <span class="n">IsAuthenticatedOrReadOnly</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django_filters.rest_framework</span><span class="w"> </span><span class="kn">import</span> <span class="n">DjangoFilterBackend</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Book</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.serializers</span><span class="w"> </span><span class="kn">import</span> <span class="n">BookSerializer</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.filters</span><span class="w"> </span><span class="kn">import</span> <span class="n">BookFilter</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.permissions</span><span class="w"> </span><span class="kn">import</span> <span class="n">IsOwnerOrReadOnly</span>

<span class="k">class</span><span class="w"> </span><span class="nc">BookViewSet</span><span class="p">(</span><span class="n">viewsets</span><span class="o">.</span><span class="n">ModelViewSet</span><span class="p">):</span>
    <span class="n">queryset</span> <span class="o">=</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">BookSerializer</span>
    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">IsAuthenticatedOrReadOnly</span><span class="p">,</span> <span class="n">IsOwnerOrReadOnly</span><span class="p">]</span>
    <span class="n">filter_backends</span> <span class="o">=</span> <span class="p">[</span><span class="n">DjangoFilterBackend</span><span class="p">,</span> <span class="n">filters</span><span class="o">.</span><span class="n">SearchFilter</span><span class="p">,</span> <span class="n">filters</span><span class="o">.</span><span class="n">OrderingFilter</span><span class="p">]</span>
    <span class="n">filterset_class</span> <span class="o">=</span> <span class="n">BookFilter</span>
    <span class="n">search_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;author&#39;</span><span class="p">,</span> <span class="s1">&#39;description&#39;</span><span class="p">]</span>
    <span class="n">ordering_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;author&#39;</span><span class="p">,</span> <span class="s1">&#39;published_date&#39;</span><span class="p">,</span> <span class="s1">&#39;created_at&#39;</span><span class="p">]</span>
    <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-created_at&#39;</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">perform_create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">serializer</span><span class="p">):</span>
        <span class="n">serializer</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">owner</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
</code></pre></div>

<h3 id="step-5-test-secure-book-api">Step 5: Test Secure Book API<a class="headerlink" href="#step-5-test-secure-book-api" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get token</span>
<span class="nv">TOKEN</span><span class="o">=</span><span class="k">$(</span>curl<span class="w"> </span>-s<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:8000/api/token/<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{&quot;username&quot;: &quot;testuser&quot;, &quot;password&quot;: &quot;testpass123&quot;}&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span><span class="p">|</span><span class="w"> </span>python<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;import sys, json; print(json.load(sys.stdin)[&#39;access&#39;])&quot;</span><span class="k">)</span>

<span class="c1"># Create book (authenticated)</span>
curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:8000/api/books/<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{</span>
<span class="s1">    &quot;title&quot;: &quot;Django for Beginners&quot;,</span>
<span class="s1">    &quot;author&quot;: &quot;John Doe&quot;,</span>
<span class="s1">    &quot;published_date&quot;: &quot;2023-01-15&quot;,</span>
<span class="s1">    &quot;description&quot;: &quot;Learn Django step by step&quot;</span>
<span class="s1">  }&#39;</span>

<span class="c1"># List books (anyone can read)</span>
curl<span class="w"> </span>http://localhost:8000/api/books/

<span class="c1"># Filter by author</span>
curl<span class="w"> </span><span class="s2">&quot;http://localhost:8000/api/books/?author=John&quot;</span>

<span class="c1"># Search</span>
curl<span class="w"> </span><span class="s2">&quot;http://localhost:8000/api/books/?search=django&quot;</span>

<span class="c1"># Order by title</span>
curl<span class="w"> </span><span class="s2">&quot;http://localhost:8000/api/books/?ordering=title&quot;</span>
</code></pre></div>

<h2 id="step-by-step-secure-task-api">Step-by-Step: Secure Task API<a class="headerlink" href="#step-by-step-secure-task-api" title="Permanent link">&para;</a></h2>
<p><strong>Note</strong>: This section focuses on Task API as the primary example (consistent with Level 1). Tasks are typically private, user-owned data, making them perfect for demonstrating authentication and permissions.</p>
<h3 id="step-1-update-task-model">Step 1: Update Task Model<a class="headerlink" href="#step-1-update-task-model" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># api/models.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.db</span><span class="w"> </span><span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.auth.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">User</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Task</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">desc</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">completed</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">owner</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;tasks&#39;</span><span class="p">)</span>
    <span class="n">created_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">updated_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-created_at&#39;</span><span class="p">]</span>
</code></pre></div>

<p><strong>Create migration:</strong></p>
<div class="codehilite"><pre><span></span><code>python<span class="w"> </span>manage.py<span class="w"> </span>makemigrations
python<span class="w"> </span>manage.py<span class="w"> </span>migrate
</code></pre></div>

<h3 id="step-2-update-task-serializer">Step 2: Update Task Serializer<a class="headerlink" href="#step-2-update-task-serializer" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># api/serializers.py</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TaskSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
    <span class="n">owner_username</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="s1">&#39;owner.username&#39;</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Task</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;desc&#39;</span><span class="p">,</span> <span class="s1">&#39;completed&#39;</span><span class="p">,</span> <span class="s1">&#39;owner&#39;</span><span class="p">,</span> <span class="s1">&#39;owner_username&#39;</span><span class="p">,</span> 
                  <span class="s1">&#39;created_at&#39;</span><span class="p">,</span> <span class="s1">&#39;updated_at&#39;</span><span class="p">]</span>
        <span class="n">read_only_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;owner&#39;</span><span class="p">,</span> <span class="s1">&#39;created_at&#39;</span><span class="p">,</span> <span class="s1">&#39;updated_at&#39;</span><span class="p">]</span>
</code></pre></div>

<h3 id="step-3-create-task-filter">Step 3: Create Task Filter<a class="headerlink" href="#step-3-create-task-filter" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># api/filters.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">django_filters</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Task</span>

<span class="k">class</span><span class="w"> </span><span class="nc">TaskFilter</span><span class="p">(</span><span class="n">django_filters</span><span class="o">.</span><span class="n">FilterSet</span><span class="p">):</span>
    <span class="n">completed</span> <span class="o">=</span> <span class="n">django_filters</span><span class="o">.</span><span class="n">BooleanFilter</span><span class="p">()</span>
    <span class="n">created_after</span> <span class="o">=</span> <span class="n">django_filters</span><span class="o">.</span><span class="n">DateFilter</span><span class="p">(</span><span class="n">field_name</span><span class="o">=</span><span class="s1">&#39;created_at&#39;</span><span class="p">,</span> <span class="n">lookup_expr</span><span class="o">=</span><span class="s1">&#39;gte&#39;</span><span class="p">)</span>
    <span class="n">created_before</span> <span class="o">=</span> <span class="n">django_filters</span><span class="o">.</span><span class="n">DateFilter</span><span class="p">(</span><span class="n">field_name</span><span class="o">=</span><span class="s1">&#39;created_at&#39;</span><span class="p">,</span> <span class="n">lookup_expr</span><span class="o">=</span><span class="s1">&#39;lte&#39;</span><span class="p">)</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Task</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;completed&#39;</span><span class="p">,</span> <span class="s1">&#39;created_after&#39;</span><span class="p">,</span> <span class="s1">&#39;created_before&#39;</span><span class="p">]</span>
</code></pre></div>

<h3 id="step-4-update-task-viewset">Step 4: Update Task ViewSet<a class="headerlink" href="#step-4-update-task-viewset" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># api/views.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework</span><span class="w"> </span><span class="kn">import</span> <span class="n">viewsets</span><span class="p">,</span> <span class="n">filters</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework.permissions</span><span class="w"> </span><span class="kn">import</span> <span class="n">IsAuthenticated</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django_filters.rest_framework</span><span class="w"> </span><span class="kn">import</span> <span class="n">DjangoFilterBackend</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Task</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.serializers</span><span class="w"> </span><span class="kn">import</span> <span class="n">TaskSerializer</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.filters</span><span class="w"> </span><span class="kn">import</span> <span class="n">TaskFilter</span>

<span class="k">class</span><span class="w"> </span><span class="nc">TaskViewSet</span><span class="p">(</span><span class="n">viewsets</span><span class="o">.</span><span class="n">ModelViewSet</span><span class="p">):</span>
    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">TaskSerializer</span>
    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">IsAuthenticated</span><span class="p">]</span>
    <span class="n">filter_backends</span> <span class="o">=</span> <span class="p">[</span><span class="n">DjangoFilterBackend</span><span class="p">,</span> <span class="n">filters</span><span class="o">.</span><span class="n">SearchFilter</span><span class="p">,</span> <span class="n">filters</span><span class="o">.</span><span class="n">OrderingFilter</span><span class="p">]</span>
    <span class="n">filterset_class</span> <span class="o">=</span> <span class="n">TaskFilter</span>
    <span class="n">search_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;desc&#39;</span><span class="p">]</span>
    <span class="n">ordering_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;completed&#39;</span><span class="p">,</span> <span class="s1">&#39;created_at&#39;</span><span class="p">]</span>
    <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-created_at&#39;</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Users can only see their own tasks</span>
        <span class="k">return</span> <span class="n">Task</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">owner</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">perform_create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">serializer</span><span class="p">):</span>
        <span class="n">serializer</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">owner</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
</code></pre></div>

<h3 id="step-5-test-secure-task-api">Step 5: Test Secure Task API<a class="headerlink" href="#step-5-test-secure-task-api" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Create task (authenticated)</span>
curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:8000/api/tasks/<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{</span>
<span class="s1">    &quot;title&quot;: &quot;Learn DRF Level 2&quot;,</span>
<span class="s1">    &quot;desc&quot;: &quot;Complete authentication and permissions&quot;,</span>
<span class="s1">    &quot;completed&quot;: false</span>
<span class="s1">  }&#39;</span>

<span class="c1"># List my tasks</span>
curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>http://localhost:8000/api/tasks/

<span class="c1"># Filter by completed</span>
curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span><span class="s2">&quot;http://localhost:8000/api/tasks/?completed=false&quot;</span>

<span class="c1"># Search tasks</span>
curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span><span class="s2">&quot;http://localhost:8000/api/tasks/?search=DRF&quot;</span>
</code></pre></div>

<h2 id="userprofile-api">UserProfile API<a class="headerlink" href="#userprofile-api" title="Permanent link">&para;</a></h2>
<h3 id="step-1-create-userprofile-model">Step 1: Create UserProfile Model<a class="headerlink" href="#step-1-create-userprofile-model" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># api/models.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.db</span><span class="w"> </span><span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.auth.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">User</span>

<span class="k">class</span><span class="w"> </span><span class="nc">UserProfile</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">OneToOneField</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;profile&#39;</span><span class="p">)</span>
    <span class="n">bio</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">phone_number</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">avatar</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ImageField</span><span class="p">(</span><span class="n">upload_to</span><span class="o">=</span><span class="s1">&#39;avatars/&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">website</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">URLField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">created_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">updated_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">username</span><span class="si">}</span><span class="s2">&#39;s Profile&quot;</span>
</code></pre></div>

<h3 id="step-2-create-userprofile-serializer">Step 2: Create UserProfile Serializer<a class="headerlink" href="#step-2-create-userprofile-serializer" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># api/serializers.py</span>
<span class="k">class</span><span class="w"> </span><span class="nc">UserProfileSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="s1">&#39;user.username&#39;</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">EmailField</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="s1">&#39;user.email&#39;</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">UserProfile</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="s1">&#39;bio&#39;</span><span class="p">,</span> <span class="s1">&#39;phone_number&#39;</span><span class="p">,</span> 
                  <span class="s1">&#39;avatar&#39;</span><span class="p">,</span> <span class="s1">&#39;website&#39;</span><span class="p">,</span> <span class="s1">&#39;created_at&#39;</span><span class="p">,</span> <span class="s1">&#39;updated_at&#39;</span><span class="p">]</span>
        <span class="n">read_only_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;created_at&#39;</span><span class="p">,</span> <span class="s1">&#39;updated_at&#39;</span><span class="p">]</span>
</code></pre></div>

<h3 id="step-3-create-userprofile-viewset">Step 3: Create UserProfile ViewSet<a class="headerlink" href="#step-3-create-userprofile-viewset" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># api/views.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework</span><span class="w"> </span><span class="kn">import</span> <span class="n">viewsets</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework.permissions</span><span class="w"> </span><span class="kn">import</span> <span class="n">IsAuthenticated</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">UserProfile</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.serializers</span><span class="w"> </span><span class="kn">import</span> <span class="n">UserProfileSerializer</span>

<span class="k">class</span><span class="w"> </span><span class="nc">UserProfileViewSet</span><span class="p">(</span><span class="n">viewsets</span><span class="o">.</span><span class="n">ModelViewSet</span><span class="p">):</span>
    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">UserProfileSerializer</span>
    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">IsAuthenticated</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">UserProfile</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">perform_create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">serializer</span><span class="p">):</span>
        <span class="n">serializer</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
</code></pre></div>

<h2 id="throttling">Throttling<a class="headerlink" href="#throttling" title="Permanent link">&para;</a></h2>
<h3 id="configure-throttling">Configure Throttling<a class="headerlink" href="#configure-throttling" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># core/settings.py</span>
<span class="n">REST_FRAMEWORK</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;DEFAULT_THROTTLE_CLASSES&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s1">&#39;rest_framework.throttling.AnonRateThrottle&#39;</span><span class="p">,</span>
        <span class="s1">&#39;rest_framework.throttling.UserRateThrottle&#39;</span>
    <span class="p">],</span>
    <span class="s1">&#39;DEFAULT_THROTTLE_RATES&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;anon&#39;</span><span class="p">:</span> <span class="s1">&#39;100/hour&#39;</span><span class="p">,</span>
        <span class="s1">&#39;user&#39;</span><span class="p">:</span> <span class="s1">&#39;1000/hour&#39;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="custom-throttling">Custom Throttling<a class="headerlink" href="#custom-throttling" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># api/throttles.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework.throttling</span><span class="w"> </span><span class="kn">import</span> <span class="n">UserRateThrottle</span>

<span class="k">class</span><span class="w"> </span><span class="nc">BookCreateThrottle</span><span class="p">(</span><span class="n">UserRateThrottle</span><span class="p">):</span>
    <span class="n">rate</span> <span class="o">=</span> <span class="s1">&#39;5/day&#39;</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1"># api/views.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.throttles</span><span class="w"> </span><span class="kn">import</span> <span class="n">BookCreateThrottle</span>

<span class="k">class</span><span class="w"> </span><span class="nc">BookViewSet</span><span class="p">(</span><span class="n">viewsets</span><span class="o">.</span><span class="n">ModelViewSet</span><span class="p">):</span>
    <span class="n">throttle_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">BookCreateThrottle</span><span class="p">]</span>
    <span class="c1"># ...</span>
</code></pre></div>

<h2 id="exception-handling">Exception Handling<a class="headerlink" href="#exception-handling" title="Permanent link">&para;</a></h2>
<h3 id="what-is-exception-handling">What is Exception Handling?<a class="headerlink" href="#what-is-exception-handling" title="Permanent link">&para;</a></h3>
<p><strong>Exception Handling</strong> allows you to customize how errors are returned to clients.</p>
<p><strong>The Problem</strong>: By default, DRF returns errors in its own format. You might want:
- Consistent error format across all endpoints
- More user-friendly error messages
- Additional error details
- Custom error codes</p>
<p><strong>Why Custom Exception Handling?</strong>
- <strong>Consistency</strong>: All errors follow same format
- <strong>User experience</strong>: Clear, helpful error messages
- <strong>Debugging</strong>: Include useful debugging information
- <strong>Security</strong>: Don't expose sensitive details
- <strong>Professional</strong>: Production-ready error responses</p>
<p><strong>Real-world analogy</strong>:
- <strong>Default errors</strong> = Generic error messages (not helpful)
- <strong>Custom errors</strong> = Clear, actionable error messages (helpful)</p>
<h3 id="basic-exception-handler">Basic Exception Handler<a class="headerlink" href="#basic-exception-handler" title="Permanent link">&para;</a></h3>
<p><strong>How it works</strong>:
1. Exception occurs in view
2. DRF calls your custom exception handler
3. Handler processes exception
4. Returns custom error response</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># api/exceptions.py (create this file)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework.views</span><span class="w"> </span><span class="kn">import</span> <span class="n">exception_handler</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework.response</span><span class="w"> </span><span class="kn">import</span> <span class="n">Response</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework</span><span class="w"> </span><span class="kn">import</span> <span class="n">status</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.conf</span><span class="w"> </span><span class="kn">import</span> <span class="n">settings</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">custom_exception_handler</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Custom exception handler for DRF.</span>
<span class="sd">    Returns consistent error format for all exceptions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Call DRF&#39;s default exception handler first</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">exception_handler</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

    <span class="c1"># If DRF handled it, customize the response</span>
    <span class="k">if</span> <span class="n">response</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">custom_response_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;success&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;status_code&#39;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span>
                <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="n">get_error_message</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">exc</span><span class="p">),</span>
                <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">exc</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="n">response</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">custom_response_data</span>

        <span class="c1"># Log error for debugging</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Handle exceptions DRF doesn&#39;t catch</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># For unexpected errors (500)</span>
        <span class="n">custom_response_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;success&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;status_code&#39;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>
                <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;An unexpected error occurred&#39;</span><span class="p">,</span>
                <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span> <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">DEBUG</span> <span class="k">else</span> <span class="s1">&#39;Internal server error&#39;</span><span class="p">,</span>
                <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">exc</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">Response</span><span class="p">(</span><span class="n">custom_response_data</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_500_INTERNAL_SERVER_ERROR</span><span class="p">)</span>

        <span class="c1"># Log unexpected errors</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected error: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">response</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_error_message</span><span class="p">(</span><span class="n">status_code</span><span class="p">,</span> <span class="n">exc</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get user-friendly error message based on status code&quot;&quot;&quot;</span>
    <span class="n">messages</span> <span class="o">=</span> <span class="p">{</span>
        <span class="mi">400</span><span class="p">:</span> <span class="s1">&#39;Invalid request data&#39;</span><span class="p">,</span>
        <span class="mi">401</span><span class="p">:</span> <span class="s1">&#39;Authentication required&#39;</span><span class="p">,</span>
        <span class="mi">403</span><span class="p">:</span> <span class="s1">&#39;Permission denied&#39;</span><span class="p">,</span>
        <span class="mi">404</span><span class="p">:</span> <span class="s1">&#39;Resource not found&#39;</span><span class="p">,</span>
        <span class="mi">405</span><span class="p">:</span> <span class="s1">&#39;Method not allowed&#39;</span><span class="p">,</span>
        <span class="mi">429</span><span class="p">:</span> <span class="s1">&#39;Too many requests&#39;</span><span class="p">,</span>
        <span class="mi">500</span><span class="p">:</span> <span class="s1">&#39;Internal server error&#39;</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">messages</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">status_code</span><span class="p">,</span> <span class="s1">&#39;An error occurred&#39;</span><span class="p">)</span>
</code></pre></div>

<p><strong>Add to settings.py:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># core/settings.py</span>
<span class="n">REST_FRAMEWORK</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># ... other settings ...</span>
    <span class="s1">&#39;EXCEPTION_HANDLER&#39;</span><span class="p">:</span> <span class="s1">&#39;api.exceptions.custom_exception_handler&#39;</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Why this location?</strong>
- Centralized: All errors go through one handler
- Consistent: Same format for all errors
- Maintainable: Update error format in one place</p>
<h3 id="handling-authentication-errors">Handling Authentication Errors<a class="headerlink" href="#handling-authentication-errors" title="Permanent link">&para;</a></h3>
<p><strong>Customize authentication error responses:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># api/exceptions.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework.views</span><span class="w"> </span><span class="kn">import</span> <span class="n">exception_handler</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="n">AuthenticationFailed</span><span class="p">,</span> <span class="n">NotAuthenticated</span><span class="p">,</span> <span class="n">PermissionDenied</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework</span><span class="w"> </span><span class="kn">import</span> <span class="n">status</span>

<span class="k">def</span><span class="w"> </span><span class="nf">custom_exception_handler</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">exception_handler</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">response</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Handle authentication errors specifically</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="p">(</span><span class="n">AuthenticationFailed</span><span class="p">,</span> <span class="n">NotAuthenticated</span><span class="p">)):</span>
            <span class="n">custom_response_data</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;success&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;status_code&#39;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span>
                    <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;Authentication failed. Please provide valid credentials.&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s1">&#39;code&#39;</span><span class="p">:</span> <span class="s1">&#39;authentication_failed&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;hint&#39;</span><span class="p">:</span> <span class="s1">&#39;Make sure you include a valid token in the Authorization header&#39;</span>
                    <span class="p">},</span>
                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">exc</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="n">response</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">custom_response_data</span>

        <span class="c1"># Handle permission errors</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="n">PermissionDenied</span><span class="p">):</span>
            <span class="n">custom_response_data</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;success&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;status_code&#39;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span>
                    <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;You do not have permission to perform this action&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s1">&#39;code&#39;</span><span class="p">:</span> <span class="s1">&#39;permission_denied&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;required_permission&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
                    <span class="p">},</span>
                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">exc</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="n">response</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">custom_response_data</span>

        <span class="c1"># Handle other errors</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">custom_response_data</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;success&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;status_code&#39;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span>
                    <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="n">get_error_message</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">exc</span><span class="p">),</span>
                    <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">exc</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="n">response</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">custom_response_data</span>

    <span class="k">return</span> <span class="n">response</span>
</code></pre></div>

<p><strong>Why handle authentication errors separately?</strong>
- <strong>User-friendly</strong>: Clear message about what went wrong
- <strong>Actionable</strong>: Tells user how to fix it
- <strong>Security</strong>: Doesn't expose sensitive details
- <strong>Consistent</strong>: Same format for all auth errors</p>
<h3 id="handling-validation-errors">Handling Validation Errors<a class="headerlink" href="#handling-validation-errors" title="Permanent link">&para;</a></h3>
<p><strong>Customize validation error format:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># api/exceptions.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="n">ValidationError</span>

<span class="k">def</span><span class="w"> </span><span class="nf">custom_exception_handler</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">exception_handler</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">response</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Handle validation errors</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="n">ValidationError</span><span class="p">):</span>
            <span class="c1"># Format field errors nicely</span>
            <span class="n">formatted_errors</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">field</span><span class="p">,</span> <span class="n">errors</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">errors</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                        <span class="n">formatted_errors</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">errors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">errors</span> <span class="k">else</span> <span class="s1">&#39;Invalid value&#39;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">formatted_errors</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span>

            <span class="n">custom_response_data</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;success&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;status_code&#39;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span>
                    <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;Validation failed&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s1">&#39;code&#39;</span><span class="p">:</span> <span class="s1">&#39;validation_error&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;fields&#39;</span><span class="p">:</span> <span class="n">formatted_errors</span>
                    <span class="p">},</span>
                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">exc</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="n">response</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">custom_response_data</span>

        <span class="c1"># ... handle other errors ...</span>

    <span class="k">return</span> <span class="n">response</span>
</code></pre></div>

<p><strong>Why format validation errors?</strong>
- <strong>Clarity</strong>: Each field error is clear
- <strong>User-friendly</strong>: Easy to understand what's wrong
- <strong>Actionable</strong>: User knows which fields to fix</p>
<h3 id="handling-jwt-token-errors">Handling JWT Token Errors<a class="headerlink" href="#handling-jwt-token-errors" title="Permanent link">&para;</a></h3>
<p><strong>Specific handling for JWT errors:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># api/exceptions.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework_simplejwt.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="n">InvalidToken</span><span class="p">,</span> <span class="n">TokenError</span>

<span class="k">def</span><span class="w"> </span><span class="nf">custom_exception_handler</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">exception_handler</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">response</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Handle JWT token errors</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="p">(</span><span class="n">InvalidToken</span><span class="p">,</span> <span class="n">TokenError</span><span class="p">)):</span>
            <span class="n">error_message</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>

            <span class="c1"># Provide helpful messages based on error</span>
            <span class="k">if</span> <span class="s1">&#39;expired&#39;</span> <span class="ow">in</span> <span class="n">error_message</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="n">message</span> <span class="o">=</span> <span class="s1">&#39;Token has expired. Please refresh your token.&#39;</span>
                <span class="n">code</span> <span class="o">=</span> <span class="s1">&#39;token_expired&#39;</span>
            <span class="k">elif</span> <span class="s1">&#39;invalid&#39;</span> <span class="ow">in</span> <span class="n">error_message</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="n">message</span> <span class="o">=</span> <span class="s1">&#39;Invalid token. Please login again.&#39;</span>
                <span class="n">code</span> <span class="o">=</span> <span class="s1">&#39;token_invalid&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">message</span> <span class="o">=</span> <span class="s1">&#39;Token error. Please login again.&#39;</span>
                <span class="n">code</span> <span class="o">=</span> <span class="s1">&#39;token_error&#39;</span>

            <span class="n">custom_response_data</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;success&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;status_code&#39;</span><span class="p">:</span> <span class="mi">401</span><span class="p">,</span>
                    <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="n">message</span><span class="p">,</span>
                    <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s1">&#39;code&#39;</span><span class="p">:</span> <span class="n">code</span><span class="p">,</span>
                        <span class="s1">&#39;hint&#39;</span><span class="p">:</span> <span class="s1">&#39;Use /api/token/ to get a new token, or /api/token/refresh/ to refresh&#39;</span>
                    <span class="p">},</span>
                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">exc</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="n">response</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">custom_response_data</span>
            <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">=</span> <span class="mi">401</span>

        <span class="c1"># ... handle other errors ...</span>

    <span class="k">return</span> <span class="n">response</span>
</code></pre></div>

<p><strong>Why handle JWT errors specifically?</strong>
- <strong>Clear guidance</strong>: Tells user how to fix token issues
- <strong>Actionable</strong>: Provides endpoint URLs for token refresh
- <strong>User-friendly</strong>: Explains what went wrong</p>
<h3 id="production-vs-development-error-messages">Production vs Development Error Messages<a class="headerlink" href="#production-vs-development-error-messages" title="Permanent link">&para;</a></h3>
<p><strong>Show detailed errors in development, generic in production:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># api/exceptions.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.conf</span><span class="w"> </span><span class="kn">import</span> <span class="n">settings</span>

<span class="k">def</span><span class="w"> </span><span class="nf">custom_exception_handler</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">exception_handler</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">response</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># In development: show detailed errors</span>
        <span class="c1"># In production: show generic errors</span>
        <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
            <span class="n">error_details</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">),</span>
                <span class="s1">&#39;traceback&#39;</span><span class="p">:</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="s1">&#39;__traceback__&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;context&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;view&#39;</span><span class="p">:</span> <span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;view&#39;</span><span class="p">)</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="k">if</span> <span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;view&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="s1">&#39;request_method&#39;</span><span class="p">:</span> <span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;request&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">method</span> <span class="k">if</span> <span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;request&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Production: don&#39;t expose sensitive details</span>
            <span class="n">error_details</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="n">get_error_message</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">exc</span><span class="p">),</span>
                <span class="s1">&#39;code&#39;</span><span class="p">:</span> <span class="n">get_error_code</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span>
            <span class="p">}</span>

        <span class="n">custom_response_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;success&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;status_code&#39;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span>
                <span class="o">**</span><span class="n">error_details</span><span class="p">,</span>
                <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">exc</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="n">response</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">custom_response_data</span>

    <span class="k">return</span> <span class="n">response</span>
</code></pre></div>

<p><strong>Why different messages?</strong>
- <strong>Development</strong>: Detailed errors help debugging
- <strong>Production</strong>: Generic errors protect security
- <strong>Best practice</strong>: Never expose stack traces in production</p>
<h3 id="complete-example">Complete Example<a class="headerlink" href="#complete-example" title="Permanent link">&para;</a></h3>
<p><strong>Full-featured exception handler:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># api/exceptions.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework.views</span><span class="w"> </span><span class="kn">import</span> <span class="n">exception_handler</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework.response</span><span class="w"> </span><span class="kn">import</span> <span class="n">Response</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework</span><span class="w"> </span><span class="kn">import</span> <span class="n">status</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">AuthenticationFailed</span><span class="p">,</span>
    <span class="n">NotAuthenticated</span><span class="p">,</span>
    <span class="n">PermissionDenied</span><span class="p">,</span>
    <span class="n">ValidationError</span><span class="p">,</span>
    <span class="n">NotFound</span><span class="p">,</span>
    <span class="n">MethodNotAllowed</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework_simplejwt.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="n">InvalidToken</span><span class="p">,</span> <span class="n">TokenError</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.conf</span><span class="w"> </span><span class="kn">import</span> <span class="n">settings</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">traceback</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">custom_exception_handler</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Comprehensive exception handler for DRF.</span>
<span class="sd">    Provides consistent, user-friendly error responses.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Call DRF&#39;s default exception handler</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">exception_handler</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

    <span class="c1"># Request object</span>
    <span class="n">request</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;request&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">response</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Customize based on exception type</span>
        <span class="n">error_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;success&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="p">{}</span>
        <span class="p">}</span>

        <span class="c1"># Authentication errors</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="p">(</span><span class="n">AuthenticationFailed</span><span class="p">,</span> <span class="n">NotAuthenticated</span><span class="p">)):</span>
            <span class="n">error_data</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;status_code&#39;</span><span class="p">:</span> <span class="mi">401</span><span class="p">,</span>
                <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;Authentication required&#39;</span><span class="p">,</span>
                <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;code&#39;</span><span class="p">:</span> <span class="s1">&#39;authentication_required&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;hint&#39;</span><span class="p">:</span> <span class="s1">&#39;Include a valid token in Authorization header: Bearer &lt;token&gt;&#39;</span>
                <span class="p">}</span>
            <span class="p">}</span>

        <span class="c1"># Permission errors</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="n">PermissionDenied</span><span class="p">):</span>
            <span class="n">error_data</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;status_code&#39;</span><span class="p">:</span> <span class="mi">403</span><span class="p">,</span>
                <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;Permission denied&#39;</span><span class="p">,</span>
                <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;code&#39;</span><span class="p">:</span> <span class="s1">&#39;permission_denied&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;hint&#39;</span><span class="p">:</span> <span class="s1">&#39;You do not have permission to perform this action&#39;</span>
                <span class="p">}</span>
            <span class="p">}</span>

        <span class="c1"># JWT token errors</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="p">(</span><span class="n">InvalidToken</span><span class="p">,</span> <span class="n">TokenError</span><span class="p">)):</span>
            <span class="n">error_data</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;status_code&#39;</span><span class="p">:</span> <span class="mi">401</span><span class="p">,</span>
                <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;Invalid or expired token&#39;</span><span class="p">,</span>
                <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;code&#39;</span><span class="p">:</span> <span class="s1">&#39;token_error&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;hint&#39;</span><span class="p">:</span> <span class="s1">&#39;Get a new token at /api/token/ or refresh at /api/token/refresh/&#39;</span>
                <span class="p">}</span>
            <span class="p">}</span>

        <span class="c1"># Validation errors</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="n">ValidationError</span><span class="p">):</span>
            <span class="n">formatted_errors</span> <span class="o">=</span> <span class="n">format_validation_errors</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
            <span class="n">error_data</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;status_code&#39;</span><span class="p">:</span> <span class="mi">400</span><span class="p">,</span>
                <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;Validation failed&#39;</span><span class="p">,</span>
                <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;code&#39;</span><span class="p">:</span> <span class="s1">&#39;validation_error&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;fields&#39;</span><span class="p">:</span> <span class="n">formatted_errors</span>
                <span class="p">}</span>
            <span class="p">}</span>

        <span class="c1"># Not found errors</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="n">NotFound</span><span class="p">):</span>
            <span class="n">error_data</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;status_code&#39;</span><span class="p">:</span> <span class="mi">404</span><span class="p">,</span>
                <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;Resource not found&#39;</span><span class="p">,</span>
                <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;code&#39;</span><span class="p">:</span> <span class="s1">&#39;not_found&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;hint&#39;</span><span class="p">:</span> <span class="s1">&#39;The requested resource does not exist&#39;</span>
                <span class="p">}</span>
            <span class="p">}</span>

        <span class="c1"># Method not allowed</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="n">MethodNotAllowed</span><span class="p">):</span>
            <span class="n">error_data</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;status_code&#39;</span><span class="p">:</span> <span class="mi">405</span><span class="p">,</span>
                <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;Method not allowed&#39;</span><span class="p">,</span>
                <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;code&#39;</span><span class="p">:</span> <span class="s1">&#39;method_not_allowed&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;allowed_methods&#39;</span><span class="p">:</span> <span class="n">exc</span><span class="o">.</span><span class="n">allowed_methods</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="s1">&#39;allowed_methods&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="p">[]</span>
                <span class="p">}</span>
            <span class="p">}</span>

        <span class="c1"># Generic error</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">error_data</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;status_code&#39;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span>
                <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="n">get_error_message</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">),</span>
                <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">data</span> <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">DEBUG</span> <span class="k">else</span> <span class="p">{</span><span class="s1">&#39;code&#39;</span><span class="p">:</span> <span class="s1">&#39;error&#39;</span><span class="p">}</span>
            <span class="p">}</span>

        <span class="c1"># Add exception type for debugging</span>
        <span class="n">error_data</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exc</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>

        <span class="c1"># Log error</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Error </span><span class="si">{</span><span class="n">error_data</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">][</span><span class="s1">&#39;status_code&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                <span class="s1">&#39;request_path&#39;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">path</span> <span class="k">if</span> <span class="n">request</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;request_method&#39;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="k">if</span> <span class="n">request</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">exc_info</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">DEBUG</span>
        <span class="p">)</span>

        <span class="n">response</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">error_data</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span>

    <span class="c1"># Handle unexpected errors (500)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">error_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;success&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;status_code&#39;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>
                <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;Internal server error&#39;</span><span class="p">,</span>
                <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;code&#39;</span><span class="p">:</span> <span class="s1">&#39;server_error&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span> <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">DEBUG</span> <span class="k">else</span> <span class="s1">&#39;An unexpected error occurred&#39;</span>
                <span class="p">},</span>
                <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">exc</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1"># Log unexpected errors</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected error: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">Response</span><span class="p">(</span><span class="n">error_data</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">],</span> <span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_500_INTERNAL_SERVER_ERROR</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">response</span>

<span class="k">def</span><span class="w"> </span><span class="nf">format_validation_errors</span><span class="p">(</span><span class="n">errors</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Format DRF validation errors into user-friendly format&quot;&quot;&quot;</span>
    <span class="n">formatted</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">errors</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">field</span><span class="p">,</span> <span class="n">field_errors</span> <span class="ow">in</span> <span class="n">errors</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field_errors</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="c1"># Take first error message</span>
                <span class="n">formatted</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">field_errors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">field_errors</span> <span class="k">else</span> <span class="s1">&#39;Invalid value&#39;</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field_errors</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="c1"># Nested errors</span>
                <span class="n">formatted</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">format_validation_errors</span><span class="p">(</span><span class="n">field_errors</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">formatted</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">field_errors</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">formatted</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_error_message</span><span class="p">(</span><span class="n">status_code</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get user-friendly error message&quot;&quot;&quot;</span>
    <span class="n">messages</span> <span class="o">=</span> <span class="p">{</span>
        <span class="mi">400</span><span class="p">:</span> <span class="s1">&#39;Bad request&#39;</span><span class="p">,</span>
        <span class="mi">401</span><span class="p">:</span> <span class="s1">&#39;Authentication required&#39;</span><span class="p">,</span>
        <span class="mi">403</span><span class="p">:</span> <span class="s1">&#39;Permission denied&#39;</span><span class="p">,</span>
        <span class="mi">404</span><span class="p">:</span> <span class="s1">&#39;Resource not found&#39;</span><span class="p">,</span>
        <span class="mi">405</span><span class="p">:</span> <span class="s1">&#39;Method not allowed&#39;</span><span class="p">,</span>
        <span class="mi">429</span><span class="p">:</span> <span class="s1">&#39;Too many requests&#39;</span><span class="p">,</span>
        <span class="mi">500</span><span class="p">:</span> <span class="s1">&#39;Internal server error&#39;</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">messages</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">status_code</span><span class="p">,</span> <span class="s1">&#39;An error occurred&#39;</span><span class="p">)</span>
</code></pre></div>

<p><strong>Why this comprehensive handler?</strong>
- <strong>Handles all error types</strong>: Authentication, permissions, validation, etc.
- <strong>User-friendly messages</strong>: Clear, actionable error messages
- <strong>Consistent format</strong>: Same structure for all errors
- <strong>Production-ready</strong>: Different messages for dev/prod
- <strong>Logging</strong>: Tracks all errors for debugging</p>
<h3 id="error-response-format">Error Response Format<a class="headerlink" href="#error-response-format" title="Permanent link">&para;</a></h3>
<p><strong>Standard error response structure:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;success&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;error&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;status_code&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">401</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;message&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Authentication required&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;details&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;code&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;authentication_required&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;hint&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Include a valid token in Authorization header&quot;</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AuthenticationFailed&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Why this format?</strong>
- <strong><code>success</code></strong>: Quick check if request succeeded
- <strong><code>error.status_code</code></strong>: HTTP status code
- <strong><code>error.message</code></strong>: Human-readable message
- <strong><code>error.details</code></strong>: Additional information
- <strong><code>error.type</code></strong>: Exception class name (for debugging)</p>
<h3 id="testing-exception-handler">Testing Exception Handler<a class="headerlink" href="#testing-exception-handler" title="Permanent link">&para;</a></h3>
<p><strong>Test your exception handler:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># api/tests.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework.test</span><span class="w"> </span><span class="kn">import</span> <span class="n">APITestCase</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework</span><span class="w"> </span><span class="kn">import</span> <span class="n">status</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.auth.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">User</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ExceptionHandlerTest</span><span class="p">(</span><span class="n">APITestCase</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span>
            <span class="n">username</span><span class="o">=</span><span class="s1">&#39;testuser&#39;</span><span class="p">,</span>
            <span class="n">password</span><span class="o">=</span><span class="s1">&#39;testpass123&#39;</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_authentication_error</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Request without token</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/api/tasks/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">401</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">][</span><span class="s1">&#39;details&#39;</span><span class="p">][</span><span class="s1">&#39;code&#39;</span><span class="p">],</span> <span class="s1">&#39;authentication_required&#39;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_validation_error</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Login first</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">force_authenticate</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>

        <span class="c1"># Invalid data - empty title</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/api/tasks/&#39;</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>  <span class="c1"># Empty title should fail validation</span>
            <span class="s1">&#39;completed&#39;</span><span class="p">:</span> <span class="kc">False</span>
        <span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">400</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;fields&#39;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">][</span><span class="s1">&#39;details&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">][</span><span class="s1">&#39;details&#39;</span><span class="p">][</span><span class="s1">&#39;fields&#39;</span><span class="p">])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_permission_denied</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Login as regular user</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">force_authenticate</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>

        <span class="c1"># Try to access admin-only endpoint (if you have one)</span>
        <span class="c1"># This would return 403 if permission denied</span>
        <span class="c1"># response = self.client.get(&#39;/api/admin/tasks/&#39;)</span>
        <span class="c1"># self.assertEqual(response.status_code, 403)</span>
</code></pre></div>

<p><strong>Why test exception handler?</strong>
- <strong>Verify format</strong>: Ensure errors follow expected format
- <strong>Catch bugs</strong>: Find issues in error handling
- <strong>Documentation</strong>: Shows how errors are returned</p>
<h3 id="best-practices">Best Practices<a class="headerlink" href="#best-practices" title="Permanent link">&para;</a></h3>
<p><strong>1. Consistent Format</strong>
- Use same structure for all errors
- Include status code, message, details
- Make it easy for clients to parse</p>
<p><strong>2. User-Friendly Messages</strong>
- Avoid technical jargon
- Provide actionable hints
- Explain what went wrong</p>
<p><strong>3. Security</strong>
- Don't expose sensitive details in production
- Hide stack traces from users
- Log detailed errors server-side</p>
<p><strong>4. Logging</strong>
- Log all errors for debugging
- Include request context
- Use appropriate log levels</p>
<p><strong>5. Error Codes</strong>
- Use consistent error codes
- Make codes searchable
- Document all error codes</p>
<h2 id="testing-authenticated-apis">Testing Authenticated APIs<a class="headerlink" href="#testing-authenticated-apis" title="Permanent link">&para;</a></h2>
<p>See <a href="CURL_GUIDE.html">CURL_GUIDE.md</a> for detailed examples. Quick reference:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get token</span>
<span class="nv">TOKEN</span><span class="o">=</span><span class="k">$(</span>curl<span class="w"> </span>-s<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:8000/api/token/<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{&quot;username&quot;: &quot;user&quot;, &quot;password&quot;: &quot;pass&quot;}&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>-r<span class="w"> </span><span class="s1">&#39;.access&#39;</span><span class="k">)</span>

<span class="c1"># Use token</span>
curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>http://localhost:8000/api/tasks/

<span class="c1"># Refresh token</span>
curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:8000/api/token/refresh/<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{&quot;refresh&quot;: &quot;your_refresh_token&quot;}&#39;</span>
</code></pre></div>

<h2 id="exercises">Exercises<a class="headerlink" href="#exercises" title="Permanent link">&para;</a></h2>
<h3 id="exercise-1-complete-secure-book-api">Exercise 1: Complete Secure Book API<a class="headerlink" href="#exercise-1-complete-secure-book-api" title="Permanent link">&para;</a></h3>
<ol>
<li>Add owner field to Book model</li>
<li>Implement IsOwnerOrReadOnly permission</li>
<li>Add filtering by author and date range</li>
<li>Add search functionality</li>
<li>Add pagination</li>
<li>Test all endpoints with cURL</li>
</ol>
<h3 id="exercise-2-userprofile-api">Exercise 2: UserProfile API<a class="headerlink" href="#exercise-2-userprofile-api" title="Permanent link">&para;</a></h3>
<ol>
<li>Create UserProfile model</li>
<li>Create UserProfileSerializer and ViewSet</li>
<li>Allow users to view/edit only their own profile</li>
<li>Test with cURL</li>
</ol>
<h3 id="exercise-3-task-filtering">Exercise 3: Task Filtering<a class="headerlink" href="#exercise-3-task-filtering" title="Permanent link">&para;</a></h3>
<ol>
<li>Add priority field to Task model</li>
<li>Create TaskFilter with priority filtering</li>
<li>Add ordering by priority</li>
<li>Test filtering and ordering</li>
</ol>
<h2 id="add-ons">Add-ons<a class="headerlink" href="#add-ons" title="Permanent link">&para;</a></h2>
<h3 id="add-on-1-custom-jwt-claims">Add-on 1: Custom JWT Claims<a class="headerlink" href="#add-on-1-custom-jwt-claims" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># api/serializers.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework_simplejwt.serializers</span><span class="w"> </span><span class="kn">import</span> <span class="n">TokenObtainPairSerializer</span>

<span class="k">class</span><span class="w"> </span><span class="nc">CustomTokenObtainPairSerializer</span><span class="p">(</span><span class="n">TokenObtainPairSerializer</span><span class="p">):</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_token</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">user</span><span class="p">):</span>
        <span class="n">token</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_token</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
        <span class="n">token</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">username</span>
        <span class="n">token</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">email</span>
        <span class="k">return</span> <span class="n">token</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1"># api/views.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework_simplejwt.views</span><span class="w"> </span><span class="kn">import</span> <span class="n">TokenObtainPairView</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.serializers</span><span class="w"> </span><span class="kn">import</span> <span class="n">CustomTokenObtainPairSerializer</span>

<span class="k">class</span><span class="w"> </span><span class="nc">CustomTokenObtainPairView</span><span class="p">(</span><span class="n">TokenObtainPairView</span><span class="p">):</span>
    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">CustomTokenObtainPairSerializer</span>
</code></pre></div>

<h3 id="add-on-2-rate-limiting">Add-on 2: Rate Limiting<a class="headerlink" href="#add-on-2-rate-limiting" title="Permanent link">&para;</a></h3>
<p>Implement different rate limits for different actions.</p>
<h3 id="add-on-3-permission-mixins">Add-on 3: Permission Mixins<a class="headerlink" href="#add-on-3-permission-mixins" title="Permanent link">&para;</a></h3>
<p>Create reusable permission mixins for common patterns.</p>
<h2 id="common-errors-and-solutions">Common Errors and Solutions<a class="headerlink" href="#common-errors-and-solutions" title="Permanent link">&para;</a></h2>
<h3 id="error-1-rest_frameworkexceptionsauthenticationfailed-given-token-not-valid-for-any-token-type">Error 1: <code>rest_framework.exceptions.AuthenticationFailed: Given token not valid for any token type</code><a class="headerlink" href="#error-1-rest_frameworkexceptionsauthenticationfailed-given-token-not-valid-for-any-token-type" title="Permanent link">&para;</a></h3>
<p><strong>Error Message</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nx">rest_framework</span><span class="p">.</span><span class="nx">exceptions</span><span class="p">.</span><span class="nx">AuthenticationFailed</span><span class="p">:</span><span class="w"> </span><span class="nx">Given</span><span class="w"> </span><span class="nx">token</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="nx">valid</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">any</span><span class="w"> </span><span class="nx">token</span><span class="w"> </span><span class="k">type</span>
</code></pre></div>

<p><strong>Why This Happens</strong>:
- Token expired
- Invalid token format
- Token not sent correctly in header
- Wrong token type</p>
<p><strong>How to Fix</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Check token format</span>
<span class="c1"># Should be: Authorization: Bearer &lt;token&gt;</span>
<span class="c1"># NOT: Authorization: &lt;token&gt;</span>
<span class="c1"># NOT: Authorization: Token &lt;token&gt;</span>

<span class="c1"># Correct format</span>
curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>http://localhost:8000/api/tasks/

<span class="c1"># Get new token if expired</span>
curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:8000/api/token/<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{&quot;username&quot;: &quot;user&quot;, &quot;password&quot;: &quot;pass&quot;}&#39;</span>
</code></pre></div>

<p><strong>Prevention</strong>: 
- Always use <code>Bearer</code> prefix for JWT tokens
- Check token expiration
- Refresh token before it expires</p>
<hr />
<h3 id="error-2-rest_frameworkexceptionspermissiondenied-you-do-not-have-permission-to-perform-this-action">Error 2: <code>rest_framework.exceptions.PermissionDenied: You do not have permission to perform this action</code><a class="headerlink" href="#error-2-rest_frameworkexceptionspermissiondenied-you-do-not-have-permission-to-perform-this-action" title="Permanent link">&para;</a></h3>
<p><strong>Error Message</strong>:</p>
<div class="codehilite"><pre><span></span><code>rest_framework.exceptions.PermissionDenied: You do not have permission to perform this action
</code></pre></div>

<p><strong>Why This Happens</strong>:
- User not authenticated (no token/session)
- User authenticated but lacks required permissions
- Permission class too restrictive</p>
<p><strong>How to Fix</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Check if user is authenticated</span>
<span class="c1"># In view, check:</span>
<span class="nb">print</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>  <span class="c1"># Should be User object, not AnonymousUser</span>
<span class="nb">print</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">)</span>  <span class="c1"># Should be True</span>

<span class="c1"># Check permissions</span>
<span class="c1"># Option 1: Make endpoint public (if appropriate)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TaskViewSet</span><span class="p">(</span><span class="n">viewsets</span><span class="o">.</span><span class="n">ModelViewSet</span><span class="p">):</span>
    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">AllowAny</span><span class="p">]</span>  <span class="c1"># Anyone can access (rare for tasks)</span>

<span class="c1"># Option 2: Require authentication (most common for tasks)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TaskViewSet</span><span class="p">(</span><span class="n">viewsets</span><span class="o">.</span><span class="n">ModelViewSet</span><span class="p">):</span>
    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">IsAuthenticated</span><span class="p">]</span>  <span class="c1"># Must be logged in</span>

<span class="c1"># Option 3: Custom permission check in class-based view</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework.views</span><span class="w"> </span><span class="kn">import</span> <span class="n">APIView</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework.response</span><span class="w"> </span><span class="kn">import</span> <span class="n">Response</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework</span><span class="w"> </span><span class="kn">import</span> <span class="n">status</span>

<span class="k">class</span><span class="w"> </span><span class="nc">TaskAPIView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">IsAuthenticated</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">patch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">pk</span><span class="p">):</span>
        <span class="c1"># Check custom permission</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">has_perm</span><span class="p">(</span><span class="s1">&#39;api.change_task&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">Response</span><span class="p">(</span>
                <span class="p">{</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Permission denied&#39;</span><span class="p">},</span> 
                <span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_403_FORBIDDEN</span>
            <span class="p">)</span>
        <span class="c1"># ... rest of logic</span>
</code></pre></div>

<p><strong>Prevention</strong>: 
- Check permission classes in view
- Verify user is authenticated before accessing protected endpoints
- Test with different user roles</p>
<hr />
<h3 id="error-3-djangocontribauthmodelsuserdoesnotexist-user-matching-query-does-not-exist">Error 3: <code>django.contrib.auth.models.User.DoesNotExist: User matching query does not exist</code><a class="headerlink" href="#error-3-djangocontribauthmodelsuserdoesnotexist-user-matching-query-does-not-exist" title="Permanent link">&para;</a></h3>
<p><strong>Error Message</strong>:</p>
<div class="codehilite"><pre><span></span><code>django.contrib.auth.models.User.DoesNotExist: User matching query does not exist
</code></pre></div>

<p><strong>Why This Happens</strong>:
- Trying to get user that doesn't exist
- User ID in token doesn't match any user
- User was deleted but token still valid</p>
<p><strong>How to Fix</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Option 1: Check if user exists</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">user_id</span><span class="p">)</span>
<span class="k">except</span> <span class="n">User</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">Response</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;User not found&#39;</span><span class="p">},</span> <span class="n">status</span><span class="o">=</span><span class="mi">404</span><span class="p">)</span>

<span class="c1"># Option 2: Use get_object_or_404</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.shortcuts</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_object_or_404</span>
<span class="n">user</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">user_id</span><span class="p">)</span>

<span class="c1"># Option 3: Handle in JWT token validation</span>
<span class="c1"># In custom token serializer, verify user exists</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrs</span><span class="p">):</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">authenticate</span><span class="p">(</span><span class="o">**</span><span class="n">attrs</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">user</span><span class="o">.</span><span class="n">is_active</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">serializers</span><span class="o">.</span><span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;User not found or inactive&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">attrs</span>
</code></pre></div>

<p><strong>Prevention</strong>: Always verify user exists before using, especially in token validation.</p>
<hr />
<h3 id="error-4-django_filtersexceptionsfieldlookuperror-unsupported-lookup-icontains-for-charfield">Error 4: <code>django_filters.exceptions.FieldLookupError: Unsupported lookup 'icontains' for CharField</code><a class="headerlink" href="#error-4-django_filtersexceptionsfieldlookuperror-unsupported-lookup-icontains-for-charfield" title="Permanent link">&para;</a></h3>
<p><strong>Error Message</strong>:</p>
<div class="codehilite"><pre><span></span><code>django_filters.exceptions.FieldLookupError: Unsupported lookup &#39;icontains&#39; for CharField
</code></pre></div>

<p><strong>Why This Happens</strong>:
- Using wrong lookup expression in FilterSet
- Lookup not supported for field type
- Typo in lookup expression</p>
<p><strong>How to Fix</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># WRONG - icontains not available in basic filterset_fields</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TaskViewSet</span><span class="p">(</span><span class="n">viewsets</span><span class="o">.</span><span class="n">ModelViewSet</span><span class="p">):</span>
    <span class="n">filterset_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;title__icontains&#39;</span><span class="p">]</span>  <span class="c1"># ❌ Not supported</span>

<span class="c1"># CORRECT - Use FilterSet class</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TaskFilter</span><span class="p">(</span><span class="n">django_filters</span><span class="o">.</span><span class="n">FilterSet</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">django_filters</span><span class="o">.</span><span class="n">CharFilter</span><span class="p">(</span><span class="n">lookup_expr</span><span class="o">=</span><span class="s1">&#39;icontains&#39;</span><span class="p">)</span>  <span class="c1"># ✅</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Task</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span>

<span class="c1"># In ViewSet</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TaskViewSet</span><span class="p">(</span><span class="n">viewsets</span><span class="o">.</span><span class="n">ModelViewSet</span><span class="p">):</span>
    <span class="n">filterset_class</span> <span class="o">=</span> <span class="n">TaskFilter</span>  <span class="c1"># ✅</span>
</code></pre></div>

<p><strong>Prevention</strong>: Use FilterSet class for advanced lookups, not <code>filterset_fields</code>.</p>
<hr />
<h3 id="error-5-rest_frameworkexceptionsvalidationerror-refresh-this-field-is-required">Error 5: <code>rest_framework.exceptions.ValidationError: {'refresh': ['This field is required.']}</code><a class="headerlink" href="#error-5-rest_frameworkexceptionsvalidationerror-refresh-this-field-is-required" title="Permanent link">&para;</a></h3>
<p><strong>Error Message</strong>:</p>
<div class="codehilite"><pre><span></span><code>rest_framework.exceptions.ValidationError: {&#39;refresh&#39;: [&#39;This field is required.&#39;]}
</code></pre></div>

<p><strong>Why This Happens</strong>:
- Trying to refresh token without providing refresh token
- Sending access token instead of refresh token
- Missing refresh token in request</p>
<p><strong>How to Fix</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># WRONG - Using access token</span>
curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:8000/api/token/refresh/<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{&quot;refresh&quot;: &quot;access_token_here&quot;}&#39;</span><span class="w">  </span><span class="c1"># ❌ Wrong token type</span>

<span class="c1"># CORRECT - Use refresh token</span>
curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:8000/api/token/refresh/<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{&quot;refresh&quot;: &quot;refresh_token_here&quot;}&#39;</span><span class="w">  </span><span class="c1"># ✅ Correct</span>

<span class="c1"># Get tokens first</span>
<span class="nv">TOKENS</span><span class="o">=</span><span class="k">$(</span>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:8000/api/token/<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{&quot;username&quot;: &quot;user&quot;, &quot;password&quot;: &quot;pass&quot;}&#39;</span><span class="k">)</span>

<span class="c1"># Extract refresh token</span>
<span class="nv">REFRESH</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="nv">$TOKENS</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>-r<span class="w"> </span><span class="s1">&#39;.refresh&#39;</span><span class="k">)</span>

<span class="c1"># Use refresh token</span>
curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:8000/api/token/refresh/<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s2">&quot;{\&quot;refresh\&quot;: \&quot;</span><span class="nv">$REFRESH</span><span class="s2">\&quot;}&quot;</span>
</code></pre></div>

<p><strong>Prevention</strong>: 
- Store both access and refresh tokens
- Use refresh token only for refreshing
- Don't confuse access and refresh tokens</p>
<hr />
<h3 id="error-6-djangocoreexceptionsfielderror-related-field-got-invalid-lookup-icontains">Error 6: <code>django.core.exceptions.FieldError: Related Field got invalid lookup: icontains</code><a class="headerlink" href="#error-6-djangocoreexceptionsfielderror-related-field-got-invalid-lookup-icontains" title="Permanent link">&para;</a></h3>
<p><strong>Error Message</strong>:</p>
<div class="codehilite"><pre><span></span><code>django.core.exceptions.FieldError: Related Field got invalid lookup: icontains
</code></pre></div>

<p><strong>Why This Happens</strong>:
- Using wrong lookup on ForeignKey field
- Need to use double underscore for related fields</p>
<p><strong>How to Fix</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># WRONG - Can&#39;t use icontains directly on ForeignKey</span>
<span class="n">Task</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">owner__icontains</span><span class="o">=</span><span class="s1">&#39;john&#39;</span><span class="p">)</span>  <span class="c1"># ❌</span>

<span class="c1"># CORRECT - Use double underscore to access related field</span>
<span class="n">Task</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">owner__username__icontains</span><span class="o">=</span><span class="s1">&#39;john&#39;</span><span class="p">)</span>  <span class="c1"># ✅</span>

<span class="c1"># Or in FilterSet</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TaskFilter</span><span class="p">(</span><span class="n">django_filters</span><span class="o">.</span><span class="n">FilterSet</span><span class="p">):</span>
    <span class="n">owner_username</span> <span class="o">=</span> <span class="n">django_filters</span><span class="o">.</span><span class="n">CharFilter</span><span class="p">(</span>
        <span class="n">field_name</span><span class="o">=</span><span class="s1">&#39;owner__username&#39;</span><span class="p">,</span>
        <span class="n">lookup_expr</span><span class="o">=</span><span class="s1">&#39;icontains&#39;</span>
    <span class="p">)</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Task</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;owner_username&#39;</span><span class="p">]</span>
</code></pre></div>

<p><strong>Prevention</strong>: Remember to use <code>__</code> (double underscore) to traverse relationships.</p>
<hr />
<h3 id="error-7-rest_frameworkexceptionsnotfound-invalid-page">Error 7: <code>rest_framework.exceptions.NotFound: Invalid page.</code><a class="headerlink" href="#error-7-rest_frameworkexceptionsnotfound-invalid-page" title="Permanent link">&para;</a></h3>
<p><strong>Error Message</strong>:</p>
<div class="codehilite"><pre><span></span><code>rest_framework.exceptions.NotFound: Invalid page.
</code></pre></div>

<p><strong>Why This Happens</strong>:
- Requesting page number that doesn't exist
- Page number out of range
- Invalid page parameter</p>
<p><strong>How to Fix</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Check total pages first</span>
<span class="c1"># Response includes: {&quot;count&quot;: 100, &quot;next&quot;: &quot;...&quot;, &quot;previous&quot;: &quot;...&quot;}</span>

<span class="c1"># WRONG - Page 999 when only 10 pages exist</span>
<span class="n">curl</span> <span class="o">-</span><span class="n">H</span> <span class="s2">&quot;Authorization: Bearer $TOKEN&quot;</span> \
  <span class="s2">&quot;http://localhost:8000/api/tasks/?page=999&quot;</span>  <span class="c1"># ❌</span>

<span class="c1"># CORRECT - Check count first, then request valid page</span>
<span class="c1"># If count=100 and page_size=10, valid pages are 1-10</span>

<span class="c1"># Handle in frontend</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">fetch</span><span class="p">(</span><span class="s1">&#39;/api/tasks/?page=1&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="n">headers</span><span class="p">:</span> <span class="p">{</span> <span class="s1">&#39;Authorization&#39;</span><span class="p">:</span> <span class="err">`</span><span class="n">Bearer</span> <span class="err">$</span><span class="p">{</span><span class="n">token</span><span class="p">}</span><span class="err">`</span> <span class="p">}</span>
<span class="p">})</span>
<span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
<span class="n">total_pages</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">count</span> <span class="o">/</span> <span class="n">page_size</span><span class="p">)</span>  <span class="c1"># Calculate total pages</span>
<span class="k">if</span> <span class="p">(</span><span class="n">page</span> <span class="o">&gt;</span> <span class="n">total_pages</span><span class="p">)</span> <span class="p">{</span>
    <span class="o">//</span> <span class="n">Show</span> <span class="n">error</span> <span class="ow">or</span> <span class="n">redirect</span> <span class="n">to</span> <span class="n">last</span> <span class="n">page</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Prevention</strong>: 
- Always check <code>count</code> in pagination response
- Calculate total pages: <code>ceil(count / page_size)</code>
- Validate page number before requesting</p>
<hr />
<h3 id="error-8-djangodbutilsintegrityerror-not-null-constraint-failed-api_taskowner_id">Error 8: <code>django.db.utils.IntegrityError: NOT NULL constraint failed: api_task.owner_id</code><a class="headerlink" href="#error-8-djangodbutilsintegrityerror-not-null-constraint-failed-api_taskowner_id" title="Permanent link">&para;</a></h3>
<p><strong>Error Message</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="n">django</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">IntegrityError</span><span class="p">:</span><span class="w"> </span><span class="n">NOT</span><span class="w"> </span><span class="n">NULL</span><span class="w"> </span><span class="n">constraint</span><span class="w"> </span><span class="n">failed</span><span class="p">:</span><span class="w"> </span><span class="n">api_task</span><span class="o">.</span><span class="n">owner_id</span>
</code></pre></div>

<p><strong>Why This Happens</strong>:
- Trying to create object without required ForeignKey
- Owner not set in serializer
- <code>perform_create</code> not setting owner</p>
<p><strong>How to Fix</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># WRONG - Standalone function (not recommended, use CBV instead)</span>
<span class="c1"># This is what NOT to do:</span>
<span class="k">def</span><span class="w"> </span><span class="nf">create_task</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>  <span class="c1"># ❌ Function-based view</span>
    <span class="n">serializer</span> <span class="o">=</span> <span class="n">TaskSerializer</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    <span class="n">serializer</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>  <span class="c1"># ❌ Owner not set!</span>

<span class="c1"># CORRECT - Class-based ViewSet approach (recommended)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TaskViewSet</span><span class="p">(</span><span class="n">viewsets</span><span class="o">.</span><span class="n">ModelViewSet</span><span class="p">):</span>
    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">TaskSerializer</span>
    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">IsAuthenticated</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">perform_create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">serializer</span><span class="p">):</span>
        <span class="n">serializer</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">owner</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>  <span class="c1"># ✅ Owner set automatically</span>

<span class="c1"># Alternative: Set owner in serializer (also class-based)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TaskSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">validated_data</span><span class="p">):</span>
        <span class="n">validated_data</span><span class="p">[</span><span class="s1">&#39;owner&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s1">&#39;request&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">user</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">validated_data</span><span class="p">)</span>
</code></pre></div>

<p><strong>Note</strong>: Always use class-based views (<code>ViewSet</code>, <code>APIView</code>) instead of function-based views. The <code>perform_create()</code> method is part of the class-based ViewSet, not a standalone function.</p>
<p><strong>Prevention</strong>: Always set owner in <code>perform_create</code> or serializer's <code>create</code> method.</p>
<hr />
<h3 id="error-9-rest_frameworkexceptionsmethodnotallowed-method-patch-not-allowed">Error 9: <code>rest_framework.exceptions.MethodNotAllowed: Method 'PATCH' not allowed</code><a class="headerlink" href="#error-9-rest_frameworkexceptionsmethodnotallowed-method-patch-not-allowed" title="Permanent link">&para;</a></h3>
<p><strong>Error Message</strong>:</p>
<div class="codehilite"><pre><span></span><code>rest_framework.exceptions.MethodNotAllowed: Method &#39;PATCH&#39; not allowed
</code></pre></div>

<p><strong>Why This Happens</strong>:
- View doesn't support PATCH method
- Using wrong HTTP method
- ViewSet action not configured</p>
<p><strong>How to Fix</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Check what methods are allowed</span>
<span class="c1"># ViewSet automatically supports: GET, POST, PUT, PATCH, DELETE</span>

<span class="c1"># Option 1: Use ViewSet (recommended - automatic method support)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TaskViewSet</span><span class="p">(</span><span class="n">viewsets</span><span class="o">.</span><span class="n">ModelViewSet</span><span class="p">):</span>  <span class="c1"># ✅ Supports PATCH automatically</span>
    <span class="n">queryset</span> <span class="o">=</span> <span class="n">Task</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">TaskSerializer</span>
    <span class="c1"># PATCH method works automatically, no need to define it</span>

<span class="c1"># Option 2: Use APIView with explicit method (if you need custom logic)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework.views</span><span class="w"> </span><span class="kn">import</span> <span class="n">APIView</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework.response</span><span class="w"> </span><span class="kn">import</span> <span class="n">Response</span>

<span class="k">class</span><span class="w"> </span><span class="nc">TaskAPIView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">patch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">pk</span><span class="p">):</span>  <span class="c1"># ✅ Must explicitly define PATCH method</span>
        <span class="n">task</span> <span class="o">=</span> <span class="n">Task</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
        <span class="n">serializer</span> <span class="o">=</span> <span class="n">TaskSerializer</span><span class="p">(</span><span class="n">task</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">partial</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">serializer</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">serializer</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">serializer</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">serializer</span><span class="o">.</span><span class="n">errors</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>
</code></pre></div>

<p><strong>Prevention</strong>: 
- ✅ <strong>Use ViewSet</strong> for automatic method support (recommended)
- ✅ <strong>Use APIView</strong> only when you need custom logic
- ❌ <strong>Avoid function-based views</strong> - use class-based approach
- Check allowed methods in view</p>
<hr />
<h3 id="error-10-django_filtersexceptionsfielderror-metafields-contains-fields-that-are-not-defined-on-this-filterset">Error 10: <code>django_filters.exceptions.FieldError: Meta.fields contains fields that are not defined on this FilterSet</code><a class="headerlink" href="#error-10-django_filtersexceptionsfielderror-metafields-contains-fields-that-are-not-defined-on-this-filterset" title="Permanent link">&para;</a></h3>
<p><strong>Error Message</strong>:</p>
<div class="codehilite"><pre><span></span><code>django_filters.exceptions.FieldError: Meta.fields contains fields that are not defined on this FilterSet
</code></pre></div>

<p><strong>Why This Happens</strong>:
- Field in <code>Meta.fields</code> not defined in FilterSet
- Typo in field name
- Field doesn't exist in model</p>
<p><strong>How to Fix</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># WRONG - Field &#39;title_contains&#39; not defined</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TaskFilter</span><span class="p">(</span><span class="n">django_filters</span><span class="o">.</span><span class="n">FilterSet</span><span class="p">):</span>
    <span class="c1"># title_contains not defined here!</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Task</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;title_contains&#39;</span><span class="p">]</span>  <span class="c1"># ❌ Field not defined</span>

<span class="c1"># CORRECT - Define field first</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TaskFilter</span><span class="p">(</span><span class="n">django_filters</span><span class="o">.</span><span class="n">FilterSet</span><span class="p">):</span>
    <span class="n">title_contains</span> <span class="o">=</span> <span class="n">django_filters</span><span class="o">.</span><span class="n">CharFilter</span><span class="p">(</span>
        <span class="n">field_name</span><span class="o">=</span><span class="s1">&#39;title&#39;</span><span class="p">,</span>
        <span class="n">lookup_expr</span><span class="o">=</span><span class="s1">&#39;icontains&#39;</span>
    <span class="p">)</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Task</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;title_contains&#39;</span><span class="p">]</span>  <span class="c1"># ✅ Now defined</span>
</code></pre></div>

<p><strong>Prevention</strong>: Always define custom filter fields before listing them in <code>Meta.fields</code>.</p>
<hr />
<h3 id="general-debugging-tips-for-level-2">General Debugging Tips for Level 2<a class="headerlink" href="#general-debugging-tips-for-level-2" title="Permanent link">&para;</a></h3>
<p><strong>1. Check Authentication</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># In view, verify authentication</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;User:&quot;</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Authenticated:&quot;</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Is anonymous:&quot;</span><span class="p">,</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="n">AnonymousUser</span><span class="p">))</span>
</code></pre></div>

<p><strong>2. Test Permissions</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Check what permissions user has</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Permissions:&quot;</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">get_all_permissions</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Is staff:&quot;</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_staff</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Is superuser:&quot;</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_superuser</span><span class="p">)</span>
</code></pre></div>

<p><strong>3. Verify Token</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Decode JWT token to see contents</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework_simplejwt.tokens</span><span class="w"> </span><span class="kn">import</span> <span class="n">AccessToken</span>

<span class="n">token</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">META</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;HTTP_AUTHORIZATION&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">decoded</span> <span class="o">=</span> <span class="n">AccessToken</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Token payload:&quot;</span><span class="p">,</span> <span class="n">decoded</span><span class="o">.</span><span class="n">payload</span><span class="p">)</span>
</code></pre></div>

<p><strong>4. Test Filters</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Test each filter separately</span>
curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span><span class="s2">&quot;http://localhost:8000/api/tasks/?completed=false&quot;</span>
curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span><span class="s2">&quot;http://localhost:8000/api/tasks/?search=django&quot;</span>
curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span><span class="s2">&quot;http://localhost:8000/api/tasks/?ordering=-created_at&quot;</span>
</code></pre></div>

<p><strong>5. Check Pagination</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Verify pagination settings</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rest_framework.pagination</span><span class="w"> </span><span class="kn">import</span> <span class="n">PageNumberPagination</span>
<span class="n">pagination</span> <span class="o">=</span> <span class="n">PageNumberPagination</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Page size:&quot;</span><span class="p">,</span> <span class="n">pagination</span><span class="o">.</span><span class="n">page_size</span><span class="p">)</span>
</code></pre></div>

<p><strong>6. Common Authentication Issues</strong>
- <strong>Token expired</strong>: Get new token or refresh
- <strong>Wrong header format</strong>: Use <code>Authorization: Bearer &lt;token&gt;</code>
- <strong>Token not sent</strong>: Check request headers
- <strong>User inactive</strong>: Check <code>user.is_active</code></p>
<p><strong>7. Common Permission Issues</strong>
- <strong>Too restrictive</strong>: Check permission classes
- <strong>User not authenticated</strong>: Verify token/session
- <strong>Wrong user</strong>: Check if user owns resource
- <strong>Missing permission</strong>: Verify user has required permission</p>
<h2 id="next-steps">Next Steps<a class="headerlink" href="#next-steps" title="Permanent link">&para;</a></h2>
<p>Congratulations! You've completed Level 2. You now know:</p>
<ul>
<li>✅ Django authentication system</li>
<li>✅ JWT authentication setup</li>
<li>✅ Permissions (built-in and custom)</li>
<li>✅ Filtering, searching, and ordering</li>
<li>✅ Pagination strategies</li>
<li>✅ Building secure APIs</li>
</ul>
<p><strong>Ready for Level 3?</strong> Continue to <a href="LEVEL_3_ADVANCED.html">Level 3: Advanced</a> to learn about relationships, nested serializers, and query optimization!</p>
<hr />
<p><strong>Resources:</strong>
- <a href="https://www.django-rest-framework.org/api-guide/authentication/">DRF Authentication</a>
- <a href="https://www.django-rest-framework.org/api-guide/permissions/">DRF Permissions</a>
- <a href="https://github.com/jazzband/djangorestframework-simplejwt">djangorestframework-simplejwt</a>
- <a href="https://django-filter.readthedocs.io/">django-filter</a></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": ".", "features": ["navigation.sections", "navigation.expand", "navigation.instant", "toc.integrate", "content.code.copy"], "search": "assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.e71a0d61.min.js"></script>
      
    
  </body>
</html>